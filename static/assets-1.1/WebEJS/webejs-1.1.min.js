var WebEJS_GEN;(WebEJS_GEN=WebEJS_GEN||{}).generate_code={addListing:function(t,e,n,a){var o=0;for(const i of e.split("\n"))o+=1,t.push(n+i+" // > "+a+" - line "+o)},appendCodeEnabled:function(t,e){for(const n of e){const e=n.Name.trim(),a=n.Active;t.push("    __pagesEnabled['"+e+"'] = "+a+";")}},appendInitializationCode:function(t,e){for(const n of e){const e=n.Name.trim(),a=n.Code;t.push("  _model.addToInitialization(function() {"),t.push("    if (!__pagesEnabled['"+e+"']) return;"),WebEJS_GEN.generate_code.addListing(t,a,"    ","Initialization page: "+e),t.push("  });\n")}},appendFixedRelationsCode:function(t,e){for(const n of e){const e=n.Name.trim(),a=n.Code;t.push("  _model.addToFixedRelations(function() {"),t.push("    if (!__pagesEnabled['"+e+"']) return;"),WebEJS_GEN.generate_code.addListing(t,a,"    ","Fixed Relations page: "+e),t.push("  });\n")}},appendCustomCode:function(t,e){for(const n of e){if("true"!=n.Active)continue;const e=n.Name.trim(),a=n.Code;WebEJS_GEN.generate_code.addListing(t,a,"  ","Custom code page: "+e),t.push("")}},appendEvolutionEnabled:function(t,e){for(const n of e){const e=n.Name.trim(),a=n.Active;if(t.push("    __pagesEnabled['"+e+"'] = "+a+";"),"ODE_EDITOR"==n.Type){if("Events"in n)for(const e of n.Events.pages){const n=e.Name.trim(),a=e.Active;t.push("    __pagesEnabled['"+n+"'] = "+a+";")}if("Discontinuities"in n)for(const e of n.Discontinuities.pages){const n=e.Name.trim(),a=e.Active;t.push("    __pagesEnabled['"+n+"'] = "+a+";")}if("ErrorHandling"in n)for(const e of n.ErrorHandling.pages){const n=e.Name.trim(),a=e.Active;t.push("    __pagesEnabled['"+n+"'] = "+a+";")}}}},appendEvolutionResetCode:function(t,e){t.push("  _model.addToReset(function() {"),t.push("    _privateOdesList=[];");for(var n=1;n<=e;n++)t.push("    _ODEi_evolution"+n+" = _ODE_evolution"+n+"();"),t.push("    _privateOdesList.push(_ODEi_evolution"+n+");");return t.push("  })\n"),e},appendEvolutionCode:function(t,e,n){n>0&&(t.push("  _model.addToInitialization(function() {"),t.push("    _initializeSolvers();"),t.push("  });"),t.push(""));var a=0;for(const n of e){const e=n.Name.trim();t.push("  _model.addToEvolution(function() {"),t.push("    if (!__pagesEnabled['"+e+"']) return;"),"ODE_EDITOR"==n.Type?(a+=1,t.push("    _ODEi_evolution"+a+".step();")):(pagecode=n.Code,WebEJS_GEN.generate_code.addListing(t,pagecode,"  ","Evolution page: "+e)),t.push("  })\n")}}},(WebEJS_GEN=WebEJS_GEN||{}).generate_model={getModelCode:function(t,e,n){const a=t.model,o=a.variables.pages,i=e?a.evolution.pages:null;var s=0,l=[];if(l.push("function _simulation (_topFrame, _libraryPath, _codebasePath, _inputParameters) {"),WebEJS_GEN.generate_model.__appendInitialCode(l,a,e),WebEJS_GEN.generate_variables.appendDefinition(l,o),e){WebEJS_GEN.generate_variables.appendSerializeCode(l,o);for(const t of i)"ODE_EDITOR"==t.Type&&s++;WebEJS_GEN.generate_ode.appendODEdeclaration(l,s),l.push("  _model.addToReset(function() {"),WebEJS_GEN.generate_code.appendCodeEnabled(l,a.initialization.pages),WebEJS_GEN.generate_code.appendEvolutionEnabled(l,i),WebEJS_GEN.generate_code.appendCodeEnabled(l,a.fixed_relations.pages),l.push("  });\n")}if(WebEJS_GEN.generate_variables.appendReset(l,o),e){l.push("  if (_inputParameters) {"),l.push("    _inputParameters = _model.parseInputParameters(_inputParameters);"),l.push("    if (_inputParameters) _model.addToReset(function() { _model._readParameters(_inputParameters); });"),l.push("  }\n"),s>0&&WebEJS_GEN.generate_ode.appendODEreset(l,s);const e="false"==t.information.RunAlways?"true":"false";l.push("  _model.addToReset(function() {"),WebEJS_GEN.generate_model.__appendModelParametersCode(l,a.evolution,"    ",e),l.push("  });\n")}if(WebEJS_GEN.generate_code.appendCustomCode(l,a.custom.pages),e&&(WebEJS_GEN.generate_code.appendInitializationCode(l,a.initialization.pages),WebEJS_GEN.generate_code.appendEvolutionCode(l,i,s),l.push("  _model.addToFixedRelations(function() { _isPaused = _model.isPaused(); _isPlaying = _model.isPlaying(); });\n"),WebEJS_GEN.generate_code.appendFixedRelationsCode(l,a.fixed_relations.pages),l.push("  // Intentionally repeated"),l.push("  _model.addToFixedRelations(function() { _isPaused = _model.isPaused(); _isPlaying = _model.isPlaying(); });\n"),s>0)){var r=[];for(const t of i)"ODE_EDITOR"==t.Type&&r.push(t);WebEJS_GEN.generate_ode.appendODEcode(l,r,o,!0)}l.push("  _model._fontResized = function(iBase,iSize,iDelta) {"),l.push("    _view._fontResized(iBase,iSize,iDelta);"),l.push("  }; // end of _fontResized\n");const c=t.view,d=WebEJS_GEN.generate_variables.getVariableList(o);WebEJS_GEN.generate_view.appendCreationCode(l,c,d,e),e&&WebEJS_GEN.generate_model.__appendModelParametersCode(l,a.evolution,"  ",""),l.push("  _createView(); // this includes _model.reset()"),l.push("  return _model;"),l.push("}\n");const u=e?t.description.pages:[];return{model:l.join("\n"),view:WebEJS_GEN.generate_view.getTreeCode(c.Tree,u,d,e,n)}},__appendInitialCode:function(t,e,n){t.push(WebEJS_GEN.generate_model.__INITIAL_CODE),n&&(WebEJS_GEN.generate_model.__addElementsCode(t,e),t.push(WebEJS_GEN.generate_model.__FULLMODEL_ADDITIONAL_CODE))},__appendModelParametersCode:function(t,e,n,a){var o=!1;for(const t of e.pages)if("true"==t.Active){o=!0;break}const i=e.information;o?(t.push(n+"_model.setAutoplay("+i.Autoplay+");"),a&&t.push(n+"_model.setPauseOnPageExit("+a+");")):t.push(n+"_model.setAutoplay(false);"),i.FPS.trim()?t.push(n+"_model.setFPS("+i.FPS+");"):t.push(n+"_model.setFPS(10);"),i.SPD.trim()?t.push(n+"_model.setStepsPerDisplay("+i.SPD+");"):t.push(n+"_model.setStepsPerDisplay(1);")},__getElementInfo:function(t,e){for(const n of e)if("elements"in n)for(const e of n.elements)if(e.classname==t)return e;return console.error("-----\x3e>>>> ERROR IN GENERATING MODEL ELEMENTS"),console.error("  : classname not supported: "+t),null},addElementsScriptCode:function(t,e,n){const a=n.elements.list;if(a.length<=0)return;const o=sMainGUI.getSystemInformation("model_elements");{const n=[];for(const t of a){const e=WebEJS_GEN.generate_model.__getElementInfo(t.Classname,o);if(e)for(const t of e.js)n.includes(t)||n.push(t)}for(const a of n)t.push("    <script src='"+e+a+"'><\/script>")}},__addElementsCode:function(t,e){const n=e.elements.list;if(n.length<=0)return;const a=sMainGUI.getSystemInformation("model_elements");for(const e of n){const n=WebEJS_GEN.generate_model.__getElementInfo(e.Classname,a);if(n){const a=n.source_code.replaceAll("{{NAME}}",e.Name);t.push("  "+a)}}},__INITIAL_CODE:"\n  var _model = EJSS_CORE.createAnimationLMS();\n  var _view;\n  var _isPlaying = false;\n  var _isPaused = true;\n  var _isEPub = false;\n  var _isMobile = (navigator===undefined) ? false : navigator.userAgent.match(/iPhone|iPad|iPod|Android|BlackBerry|Opera Mini|IEMobile/i);\n\n  var _stringProperties = {};\n  var _tools = {\n    showInputDialog : EJSS_INTERFACE.BoxPanel.showInputDialog,\n    showOkDialog : EJSS_INTERFACE.BoxPanel.showOkDialog,\n    showOkCancelDialog : EJSS_INTERFACE.BoxPanel.showOkCancelDialog,\n    downloadText: EJSS_TOOLS.File.downloadText,\n    uploadText: function(action) { EJSS_TOOLS.File.uploadText(_model,action); } \n  };\n\n  function _play()  { _isPaused = false; _isPlaying = true;  _model.play();  }\n  function _pause() { _isPaused = true;  _isPlaying = false; _model.pause(); }\n  function _step()  { _pause();  _model.step(); }\n  function _reset() { _model.reset();  _isPaused = _model.isPaused(); _isPlaying = _model.isPlaying(); }\n  _model._play  = _play;\n  _model._pause = _pause;\n  _model._step  = _step;\n  _model._reset = _reset;",__FULLMODEL_ADDITIONAL_CODE:"\n  function _update() { _model.update(); }\n  function _initialize() { _model.initialize(); }\n  function _setFPS(_fps) { _model.setFPS(_fps); }\n  function _setDelay(_delay) { _model.setDelay(_delay); }\n  function _setStepsPerDisplay(_spd) { _model.setStepsPerDisplay(_spd); }\n  function _setUpdateView(_updateView) { _model.setUpdateView(_updateView); }\n  function _setAutoplay(_auto) { _model.setAutoplay(_auto); }\n  function _println(_message) { console.log(_message); }\n  function _breakAfterThisPage() { _model.setShouldBreak(true); }\n  function _resetSolvers() { if (_model.resetSolvers) _model.resetSolvers(); }\n  function _saveText(name,type,content) { if (_model.saveText) _model.saveText(name,type,content); }\n  function _saveState(name) { if (_model.saveState) _model.saveState(name); }\n  function _saveImage(name,panelname) { if (_model.saveImage) _model.saveImage(name,panelname); }\n  function _readState(url,type) { if (_model.readState) _model.readState(url,type); }\n  function _readText(url,type,varname) { if (_model.readText) _model.readText(url,type,varname); }\n  // Is this still needed if we don't have locales???\n  function _getStringProperty(propertyName) {\n    var _value = _stringProperties[propertyName];\n    if (_value===undefined) return propertyName;\n    else return _value;\n  }\n\n  var __pagesEnabled = [];\n  function _setPageEnabled(pageName,enabled) { __pagesEnabled[pageName] = enabled; }\n"},(WebEJS_GEN=WebEJS_GEN||{}).generate_ode={appendODEdeclaration:function(t,e){const n=[];if(e>0){t.push("  var _privateOdesList;");for(var a=1;a<=e;a++)t.push("  var _ODEi_evolution"+a+";"),1==a?n.push("_ODEi_evolution"+a):n.push(",_ODEi_evolution"+a),t.push("  var _userEvents"+a+" = [];\n")}t.push("  _model.getOdes = function() { return ["+n.join("")+"]; }\n"),t.push("  _model.removeEvents = function(){");for(a=1;a<=e;a++)t.push("    _userEvents"+a+" = [];");t.push("  }\n")},appendODEreset:function(t,e){t.push("  _model.addToReset(function() {"),t.push("    _privateOdesList=[];");for(var n=1;n<=e;n++)t.push("    _ODEi_evolution"+n+" = _ODE_evolution"+n+"();"),t.push("    _privateOdesList.push(_ODEi_evolution"+n+");");t.push("  });\n")},appendODEcode:function(t,e,n,a){if(a){t.push(WebEJS_GEN.generate_ode.INIT_SOLVER_PIECE),t.push("  _getODE = function (_odeName) {");var o=1;for(const n of e)t.push("    if (_odeName=='"+n.Name+"') return _ODEi_evolution"+o+";"),o++;t.push("    return null;"),t.push("  }"),t.push(WebEJS_GEN.generate_ode.GET_EVENT_SOLVER_PIECE),o=1;for(const a of e){const e=WebEJS_GEN.generate_ode.oneODE(a,o,n);e.appendCode(t),e.appendHistoricFunctionsCode(t),o++}}else for(const n of e)for(const e of n.Equations)e.state.trim()&&t.push("  function _historic_"+e.state+"(__time) {}")},oneODE:function(t,e,n){var a={};a.odePage=t,a.pageIndex=e,a.indepVar=t.IndependentVariable,a.eqnList=[],a.followedByDerivative=[];for(const e of t.Equations){var o=e.state.trim(),i=e.rate.trim();if(o.length<=0||i.length<=0)continue;i.endsWith(";")&&(i=i.slice(0,-1));const t=o.indexOf("[");var s=!0;if(t<0&&(s=WebEJS_GEN.generate_variables.isArrayOfDouble(n,o)),s)if(t<0){WebEJS_GEN.generate_variables.isArrayOfDouble(n,i)?a.eqnList.push({state:o,index:"__i",rate:i+"[__i]"}):a.eqnList.push({state:o,index:"__i",rate:i})}else{const t=[];for(const e of o.split(/\s+|\[|\]/))e&&t.push(e);const e=t.shift();t.len<=0?a.eqnList.push({state:e,rate:i}):a.eqnList.push({state:e,index:t.shift(),rate:i})}else a.eqnList.push({state:o,rate:i})}if(a.eqnList.length>0)for(var l=a.eqnList[0].rate,r=1;r<a.eqnList.length;r++){const t=a.eqnList[r];var c=t.state;"index"in t&&(c+="["+t.index+"]"),c==l&&a.followedByDerivative.push(a.eqnList[r-1]),l=t.state}if(t.Method.toLowerCase().indexOf("verlet")>=0)for(r=0;r<a.eqnList.length-1;r+=2)a.followedByDerivative.includes(a.eqnList[r])||alert("ODE error! Verlet order not respected in ODE page : "+t.Name);function d(t,e){return t in a.odePage&&a.odePage[t]?a.odePage[t]:e}return a.appendHistoricFunctionsCode=function(t){const e="_ODEi_evolution"+a.pageIndex;var n="0";for(const o of a.eqnList){const a=o.state;if(t.push("  function _historic_"+a+"(__time) {"),"index"in o){const o=a+".length";t.push("    var __beginIndex = "+n+";"),t.push("    return "+e+".getEventSolver().getStateHistory().interpolate(__time,new Array("+o+"),__beginIndex,"+o+");"),t.push("  }\n"),n+=" + "+o}else t.push("    var __index = "+n+";"),t.push("    return "+e+".getEventSolver().getStateHistory().interpolate(__time,_index);"),t.push("  }\n"),n+=" + 1 "}},a.appendCode=function(t){const e=a.odePage.Name,n="false"==a.odePage.ForceSynchronization,o=a.__setStateFromVariablesTemplate(!1),i=n?a.__setStateFromVariablesTemplate(!0):o,s=a.__getVariablesFromStateTemplate(!1),l=a.__getVariablesFromStateTemplate(!0),r="Events"in a.odePage?a.odePage.Events.pages:[],c="Discontinuities"in a.odePage?a.odePage.Discontinuities.pages:[];t.push("  function _ODE_evolution"+a.pageIndex+"() {"),t.push("    var __odeSelf = {};"),t.push("    var __eventSolver;"),t.push("    var __solverClass = _getEngineSolverClass('"+a.odePage.Method+"');"),t.push("    var __state=[];");for(var u=1;u<=r.length;u++)t.push("    var _ODE_evolution"+a.pageIndex+"_Event"+u+";");for(u=1;u<=c.length;u++)t.push("    var _ODE_evolution"+a.pageIndex+"_Discontinuity"+u+";");a.odePage.ErrorHandling.pages.length<=0&&t.push("    var __ignoreErrors=false;"),t.push("    var __mustInitialize=true;"),t.push("    var __isEnabled=true;"),t.push("    var __mustUserReinitialize=false;"),n&&t.push("    var __mustReinitialize=true;\n");for(const e of a.eqnList)"index"in e&&t.push("    var _"+e.state+"Length;");t.push("\n    __odeSelf._getOdeVars = function (){ return "+a.__getVarsNames()+"; }\n"),t.push("    __odeSelf.setSolverClass = function(__aSolverClass) {"),t.push("      __solverClass = __aSolverClass;"),t.push("      __instantiateSolver();"),t.push("    }\n"),t.push("    function __instantiateSolver() {"),t.push("      __state=[];");for(const e of a.eqnList)"index"in e&&t.push("      _"+e.state+"Length = "+e.state+".length;");t.push("      __pushState();"),t.push("      __eventSolver = EJSS_ODE_SOLVERS.interpolatorEventSolver(__solverClass(),__odeSelf);"),t.push("      __mustInitialize = true;"),t.push("    }\n"),t.push("    __odeSelf.setEnabled = function(_enabled) { __isEnabled = _enabled; }\n"),t.push("    __odeSelf.getIndependentVariableValue = function() { return __eventSolver.getIndependentVariableValue(); }\n"),t.push("    __odeSelf.getInternalStepSize = function() { return __eventSolver.getInternalStepSize(); }\n"),t.push("    __odeSelf.isAccelerationIndependentOfVelocity = function() { return "+a.odePage.AccelerationIndependentOfVelocity+"; }\n"),t.push("    __odeSelf.initializeSolver = function() {"),t.push("      if (__arraysChanged()) { __instantiateSolver(); __odeSelf.initializeSolver(); return; }"),t.push("      __pushState();");const p=d("Increment","0").trim(),m=d("InternalStep","").trim(),g=d("MemoryLength","").trim(),h=d("MaximumStep","").trim(),f=a.odePage.MaximumNumberOfSteps.trim();m?t.push("      __eventSolver.initialize("+m+");"):t.push("      __eventSolver.initialize("+p+");"),t.push("      __eventSolver.setBestInterpolation("+a.odePage.UseBestInterpolation+");"),g&&t.push("      __eventSolver.setHistoryLength("+g+");"),h&&t.push("      __eventSolver.setMaximumInternalStepSize("+h+");"),f&&t.push("      __eventSolver.setMaximumInternalSteps("+f+");"),t.push("      __eventSolver.removeAllEvents();");for(u=1;u<=r.length;u++){const e=r[u-1];t.push("      if (__pagesEnabled['"+e.Name+"']) __eventSolver.addEvent(_ODE_evolution"+a.pageIndex+"_Event"+u+"());")}for(u=1;u<=c.length;u++){const e=c[u-1];t.push("      if (__pagesEnabled['"+e.Name+"']) __eventSolver.addDiscontinuity(_ODE_evolution"+a.pageIndex+"_Discontinuity"+u+"());")}t.push("      for (k in _userEvents"+a.pageIndex+") {__eventSolver.addEvent(_userEvents"+a.pageIndex+"[k]);}"),"ZenoEffect"in a.odePage&&a.odePage.ZenoEffect.Code&&t.push("      __eventSolver.addZenoEffectListener(__odeSelf);"),t.push("      __eventSolver.setEstimateFirstStep("+a.odePage.EstimateFirstStep+");"),t.push("      __eventSolver.setEnableExceptions(false);");const b=a.odePage.AbsoluteTolerance.trim();var v="";if(b){var E=d("MaximumStep",null);v="setTolerances("+b+","+(E=E?E.trim():b)+")"}v&&t.push("      __eventSolver."+v+";"),n&&t.push("      __mustReinitialize = true;"),t.push("      __mustInitialize = false;"),t.push("    }\n"),t.push("    function __pushState() {"),t.push(i.replaceAll("{{PREFIX}}","      ").replaceAll("{{STATE_STR}}","__state")),t.push("    }\n"),t.push("    function __arraysChanged () {");for(var _=0;_<a.eqnList.length;_++){const e=a.eqnList[_];if("index"in e){const n=e.state;t.push("      if (_"+n+"Length != "+n+".length) return true;")}}if(t.push("      return false;"),t.push("    }\n"),t.push("    __odeSelf.getEventSolver = function() {"),t.push("      return __eventSolver;"),t.push("    }\n"),t.push("    __odeSelf.resetSolver = function() {"),t.push("      __mustUserReinitialize = true;"),t.push("    }\n"),t.push("    __odeSelf.automaticResetSolver = function() {"),n&&t.push("      __mustReinitialize = true;"),t.push("    }\n"),t.push("    function __errorAction () {"),a.odePage.ErrorHandling.pages.length>0){n&&(t.push("      // Make sure the solver is reinitialized;"),t.push("      __mustReinitialize = true;")),t.push("      var _errorCode = __eventSolver.getErrorCode();");for(const n of a.odePage.ErrorHandling.pages){const a=n.Name,o=n.Type,i=n.Code,s=n.Comment;t.push("      if (__pagesEnabled['"+a+"']) {"),"ANY_ERROR"==o?t.push("        { // For any error: "+s):t.push("        if (__eventSolver.getErrorCode()==EJSS_ODE_SOLVERS.ERROR."+o+") { // "+s),WebEJS_GEN.generate_code.addListing(t,i,"          ","ErrorHandler for "+e+" - "+a),t.push("        }"),t.push("      }")}}else t.push("      if (__ignoreErrors) return;"),t.push("      console.log (__eventSolver.getErrorMessage());"),t.push("      if (window.confirm('Numerical solver error. Continue the simulation?')) __ignoreErrors = true;"),t.push("      else _pause();"),n&&(t.push("      // Make sure the solver is reinitialized;"),t.push("      __mustReinitialize = true;"));t.push("    }\n"),t.push("    __odeSelf.step = function() { return __privateStep(false); }\n"),t.push("    __odeSelf.solverStep = function() { return __privateStep(true); }\n"),t.push("    function __privateStep(__takeMaximumStep) {"),t.push("      if (!__isEnabled) return 0;"),t.push("      if ("+p+"===0) return 0;"),t.push("      if (__mustInitialize) __odeSelf.initializeSolver();"),t.push("      if (__arraysChanged()) { __instantiateSolver(); __odeSelf.initializeSolver(); }"),t.push("      __eventSolver.setStepSize("+p+");"),m?t.push("      __eventSolver.setInternalStepSize("+m+");"):t.push("      __eventSolver.setInternalStepSize("+p+");"),g&&t.push("      __eventSolver.setHistoryLength("+g+");"),h&&t.push("      __eventSolver.setMaximumInternalStepSize("+h+");"),f&&t.push("      __eventSolver.setMaximumInternalSteps("+f+");");const S=d("EventMaximumStep","").trim();if(S&&t.push("      __eventSolver.setMaximumEventStep("+S+");"),v&&t.push("      __eventSolver."+v+";"),t.push("      __pushState();"),t.push("      if (__mustUserReinitialize) {"),t.push("        __eventSolver.userReinitialize();"),t.push("        __mustUserReinitialize = false;"),n&&t.push("        __mustReinitialize = false;"),t.push("        if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();"),t.push("      }"),n?(t.push("      else if (__mustReinitialize) {"),t.push("        __eventSolver.reinitialize();"),t.push("        __mustReinitialize = false;"),t.push("        if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();"),t.push("      }")):(t.push("      __eventSolver.reinitialize(); // force synchronization: inefficient!"),t.push("      if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();")),t.push("      var __stepTaken = __takeMaximumStep ? __eventSolver.maxStep() : __eventSolver.step();"),t.push(s.replaceAll("{{STATE_STR}}","__state").replaceAll("{{PREFIX}}","      ")),t.push("      // Check for error"),t.push("      if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();"),t.push("      return __stepTaken;"),t.push("    }\n"),t.push("    __odeSelf.getState = function() { return __state; }\n"),"DelayList"in a.odePage&&a.odePage.DelayList&&a.odePage.DelayList.trim()){t.push("    __odeSelf.setStateHistory = function(_history) { }; // deliberately left empty\n"),t.push("    __odeSelf.getDelays = function(__aState) {"),t.push(l.replaceAll("{{STATE_STR}}","__aState").replaceAll("{{PREFIX}}","      ")),t.push("      return ["+a.odePage.DelayList+"];"),t.push("    }\n"),t.push("    __odeSelf.getMaximumDelay = function() {");const n=a.odePage.DelayMaximum.trim();n?t.push("      return "+n+";"):(t.push("      var _delaysArray = __odeSelf.getDelays(__state);"),t.push("      var _maximum = Number.POSITIVE_INFINITY;"),t.push("      for (var _i=0,_n=_delaysArray.length; _i<_n; _i++) _maximum = Math.max(_maximum,Math.abs(_delaysArray[_i]));"),t.push("      return _maximum;")),t.push("    }\n"),t.push("    __odeSelf.getInitialConditionDiscontinuities = function() {"),t.push("      return ["+a.odePage.DelayAddDiscont+"];"),t.push("    }\n"),t.push("    function _userDefinedInitialCondition(_time) {"),t.push("      // In case it uses the independent variable"),t.push("      var "+a.indepVar+" = _time;"),a.odePage.DelayInitialCondition.Code.trim()?WebEJS_GEN.generate_code.addListing(t,a.odePage.DelayInitialCondition.Code,"      ","Delay initial conditions page: "+e):(t.push("      return []; // > Error? Delay initial conditions page NOT SET: "+e),alert("DDE error! Initial conditions for DDE not set in page "+e)),t.push("    }\n"),t.push("    __odeSelf.getInitialCondition = function(_time, _state) {"),t.push("      var _userDelayInitCond = _userDefinedInitialCondition(_time);"),t.push("      if (_userDelayInitCond!==null) {"),t.push("        for (var _i=0, _n=_state.length-1; _i<_n; _i++) _state[_i] = _userDelayInitCond[_i];"),t.push("        _state[_state.length-1] = _time;"),t.push("      }"),t.push("    }\n")}t.push("    __odeSelf.getRate = function(_aState,_aRate) {"),a.odePage.PreliminaryCode.Code.trim()?(t.push("      _aRate[_aRate.length-1] = 0.0; // In case the prelim code returns"),t.push("      var __index=-1; // so that it can be used in preliminary code"),t.push(l.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","      ")),t.push("      // Preliminary code: "+a.odePage.PreliminaryCode.Comment),WebEJS_GEN.generate_code.addListing(t,a.odePage.PreliminaryCode.Code,"      ","Preliminary code for ODE "+e)):t.push(l.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","      ")),a.__computeRateCode(t,"Rate for ODE: "+e),t.push("    } //end of getRate\n"),"ZenoEffect"in a.odePage&&a.odePage.ZenoEffect.Code.trim()&&(t.push("    // Implementation of org.opensourcephysics.numerics.ZenoEffectListener"),t.push("    __odeSelf.zenoEffectAction = function(_anEvent, _aState) {"),t.push(s.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","      ")),WebEJS_GEN.generate_code.addListing(t,a.odePage.ZenoEffect.Code,"        ","Zeno code for ODE."+e),t.push(o.replaceAll("{{PREFIX}}","      ").replaceAll("{{STATE_STR}}","_aState")),t.push("        return "+a.odePage.ZenoEffect.StopAfterEffect+";"),t.push("      }\n")),t.push(WebEJS_GEN.generate_ode.BLOCKLY_ADD_EVENT_PIECE.replaceAll("{{EXTRACT_VARIABLES_A_STATE}}",l.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","          ")).replaceAll("{{EXTRACT_VARIABLES_STATE}}",s.replaceAll("{{STATE_STR}}","__state").replaceAll("{{PREFIX}}","          ")).replaceAll("{{UPDATE_VARIABLES_STATE}}",o.replaceAll("{{PREFIX}}","          ").replaceAll("{{STATE_STR}}","__state")).replaceAll("{{PAGE_INDEX}}",a.pageIndex));for(u=0;u<r.length;u++){const n=r[u];t.push("    _ODE_evolution"+a.pageIndex+"_Event"+(u+1)+" = function() {"),t.push("      var _eventSelf = {};"),t.push("      _eventSelf.getTypeOfEvent = function() { return EJSS_ODE_SOLVERS.EVENT_TYPE."+n.EventType+"; }"),t.push("      _eventSelf.getRootFindingMethod = function() { return EJSS_ODE_SOLVERS.EVENT_METHOD."+n.Method+"; }"),t.push("      _eventSelf.getMaxIterations = function() { return "+n.Iterations+"; }"),"Tolerance"in n&&n.Tolerance&&n.Tolerance.trim()?t.push("      _eventSelf.getTolerance = function() { return "+n.Tolerance+"; }"):t.push("      _eventSelf.getTolerance = function() { return "+b+"; }\n"),t.push("      _eventSelf.evaluate = function(_aState) {"),t.push(l.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","        ")),WebEJS_GEN.generate_code.addListing(t,n.ZeroCondition,"        ","Event zero-condition for page "+e),t.push("      }\n"),t.push("      _eventSelf.action = function() {"),t.push(s.replaceAll("{{STATE_STR}}","__state").replaceAll("{{PREFIX}}","        ")),t.push("        var _returnValue = __userDefinedAction();"),t.push(o.replaceAll("{{PREFIX}}","        ").replaceAll("{{STATE_STR}}","__state")),t.push("        return _returnValue;"),t.push("      }\n"),t.push("      function __userDefinedAction() {"),WebEJS_GEN.generate_code.addListing(t,n.Action,"        ","Event action for page "+e),t.push("        return "+n.StopAtEvent+";"),t.push("      }"),t.push("      return _eventSelf;"),t.push("    } // End of event\n")}for(u=0;u<c.length;u++){const n=c[u];t.push("    _ODE_evolution"+a.pageIndex+"_Discontinuity"+(u+1)+" = function() {"),t.push("      var _discontinuitySelf = {};\n"),"Tolerance"in n&&n.Tolerance?t.push("      _discontinuitySelf.getTolerance = function() { return "+n.Tolerance+"; }\n"):t.push("      _discontinuitySelf.getTolerance = function() { return "+b+"; }\n"),t.push("      _discontinuitySelf.evaluate = function(_aState) {"),t.push(l.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","      ")),WebEJS_GEN.generate_code.addListing(t,n.ZeroCondition,"        ","Discontinity zero-condition for page "+e),t.push("      }\n"),t.push("      _discontinuitySelf.action = function() {"),t.push(s.replaceAll("{{STATE_STR}}","__state").replaceAll("{{PREFIX}}","        ")),t.push("        var _returnValue = __userDefinedAction();"),t.push(o.replaceAll("{{PREFIX}}","        ").replaceAll("{{STATE_STR}}","__state")),t.push("        return _returnValue;"),t.push("      }\n"),t.push("      function __userDefinedAction() {"),WebEJS_GEN.generate_code.addListing(t,n.Action.trim(),"        ","Discontinuity action for page "+e),t.push("        return "+n.StopAtDiscontinuity+";"),t.push("      }\n"),t.push("      return _discontinuitySelf;"),t.push("    } // End of discontinuity\n")}t.push("    __instantiateSolver();"),t.push("    return __odeSelf;"),t.push("  }\n")},a.__getVarsNames=function(){for(var t="[",e=0;e<a.eqnList.length;e++){const n=a.eqnList[e].state;t+=0==e?"'"+n+"'":",'"+n+"'"}return a.eqnList.length>0?t+=",'"+a.indepVar+"']":t+="'"+a.indepVar+"']",t},a.__computeRateCode=function(t,e){t.push("      // Compute the rate"),t.push("      var __cRate=0;");const n=["__i"];for(var o=!1,i=0;i<a.eqnList.length;i++){if(o){o=!1;continue}const s=a.eqnList[i],l=s.state,r=" // "+e+" : "+l,c=s.rate;if("index"in s){const d=s.index.trim();if(n.includes(d)||(t.push("      var "+d+";"),n.push(d)),a.followedByDerivative.includes(s)){const n=a.eqnList[i+1],s=n.state,u=n.rate;t.push("      for ("+d+"=0;"+d+"<_"+l+"Length;"+d+"++) { // These two alternate in the state"),t.push("        _aRate[__cRate++] = Array.isArray("+c+") ? "+c+"["+d+"] : "+c+";"+r),t.push("        _aRate[__cRate++] = Array.isArray("+u+") ? "+u+"["+d+"] : "+u+"; // "+e+" :"+s),t.push("      }"),o=!0}else t.push("      for ("+d+"=0;"+d+"<_"+l+"Length;"+d+"++) {"),t.push("        _aRate[__cRate++] = Array.isArray("+c+") ? "+c+"["+d+"] : "+c+";"+r),t.push("      }")}else t.push("      _aRate[__cRate++] = "+c+";"+r)}t.push("      _aRate[__cRate++] = 1; // independent variable"),t.push("      return _aRate;")},a.__setStateFromVariablesTemplate=function(t){const e=[];e.push("{{PREFIX}}// Copy our variables to {{STATE_STR}}[]"),e.push("{{PREFIX}}var __j=0;"),e.push("{{PREFIX}}var __n=0;"),e.push("{{PREFIX}}var __cIn=0;");for(var n=!1,o=0;o<a.eqnList.length;o++){if(n){n=!1;continue}const i=a.eqnList[o],s=i.state;if("index"in i)if(a.followedByDerivative.includes(i)){const i=a.eqnList[o+1].state;t&&(e.push("{{PREFIX}}if (!__mustReinitialize)"),e.push("{{PREFIX}}  for (__j=0,__n=__cIn; __j<_"+s+"Length; __j++)"),e.push("{{PREFIX}}    if ({{STATE_STR}}[__n++]!="+s+"[__j] || {{STATE_STR}}[__n++]!="+i+"[__j]) { __mustReinitialize = true; break; }")),e.push("{{PREFIX}}for (__j=0; __j<_"+s+"Length; __j++) { // These two alternate in the state"),e.push("{{PREFIX}}   {{STATE_STR}}[__cIn++] = "+s+"[__j];"),e.push("{{PREFIX}}   {{STATE_STR}}[__cIn++] = "+i+"[__j];"),e.push("{{PREFIX}}}"),n=!0}else t&&(e.push("{{PREFIX}}if (!__mustReinitialize)"),e.push("{{PREFIX}}  for (__j=0,__n=__cIn; __j<_"+s+"Length; __j++)"),e.push("{{PREFIX}}     if ({{STATE_STR}}[__n++]!="+s+"[__j]) { __mustReinitialize = true; break; }")),e.push("{{PREFIX}}  for (__j=0;__j<_"+s+"Length; __j++) {"),e.push("{{PREFIX}}    {{STATE_STR}}[__cIn++] = "+s+"[__j];"),e.push("{{PREFIX}}  }");else t&&e.push("{{PREFIX}}if ({{STATE_STR}}[__cIn]!="+s+") __mustReinitialize = true;"),e.push("{{PREFIX}}{{STATE_STR}}[__cIn++] = "+s+";")}return t&&e.push("{{PREFIX}}if ({{STATE_STR}}[__cIn]!="+a.indepVar+") __mustReinitialize = true;"),e.push("{{PREFIX}}{{STATE_STR}}[__cIn++] = "+a.indepVar+";"),e.join("\n")},a.__getVariablesFromStateTemplate=function(t){const e=[];e.push("{{PREFIX}}// Extract our variables from {{STATE_STR}}"),e.push("{{PREFIX}}var __i=0;"),e.push("{{PREFIX}}var __cOut=0;");for(var n=!1,o=0;o<a.eqnList.length;o++){if(n){n=!1;continue}const i=a.eqnList[o],s=i.state;if("index"in i)if(t&&e.push("{{PREFIX}}var "+s+" = [];"),a.followedByDerivative.includes(i)){const i=a.eqnList[o+1].state;t&&e.push("{{PREFIX}}var "+i+" = [];"),e.push("{{PREFIX}}for (__i=0; __i<_"+s+"Length; __i++) { // These two alternate in the state"),e.push("{{PREFIX}}  "+s+"[__i] = {{STATE_STR}}[__cOut++];"),e.push("{{PREFIX}}  "+i+"[__i] = {{STATE_STR}}[__cOut++];"),e.push("{{PREFIX}}}"),n=!0}else e.push("{{PREFIX}}for (__i=0;__i<_"+s+"Length; __i++) {"),e.push("{{PREFIX}}  "+s+"[__i] = {{STATE_STR}}[__cOut++];"),e.push("{{PREFIX}}}");else t?e.push("{{PREFIX}}var "+s+" = {{STATE_STR}}[__cOut++];"):e.push("{{PREFIX}}"+s+" = {{STATE_STR}}[__cOut++];")}return t?e.push("{{PREFIX}}var "+a.indepVar+" = {{STATE_STR}}[__cOut++];"):e.push("{{PREFIX}}"+a.indepVar+" = {{STATE_STR}}[__cOut++];"),e.join("\n")},a},INIT_SOLVER_PIECE:"\n  function _initializeSolvers() {\n    for (var i=0,n=_privateOdesList.length; i<n; i++) _privateOdesList[i].initializeSolver();\n  }\n\n  function _automaticResetSolvers() {\n    for (var i=0,n=_privateOdesList.length; i<n; i++) _privateOdesList[i].automaticResetSolver();\n  }\n\n  _model.resetSolvers = function() {\n    for (var i=0,n=_privateOdesList.length; i<n; i++) _privateOdesList[i].resetSolver();\n  }\n",GET_EVENT_SOLVER_PIECE:"\n  function _getEventSolver(_odeName) {\n    var ode = _getODE(_odeName);\n    if (ode===null) return null;\n    return ode.getEventSolver();\n  }\n\n  function _getEngineSolverClass(classname) {\n    classname = classname.toLowerCase();\n    if (classname.indexOf('rungekuttafehlberg')>=0) return EJSS_ODE_SOLVERS.cashKarp45;\n    if (classname.indexOf('cash')>=0)   return EJSS_ODE_SOLVERS.cashKarp45;\n    if (classname.indexOf('boga')>=0)   return EJSS_ODE_SOLVERS.bogackiShampine23;\n    if (classname.indexOf('dopri5')>=0) return EJSS_ODE_SOLVERS.doPri5;\n    if (classname.indexOf('dopri8')>=0) return EJSS_ODE_SOLVERS.doPri853;\n    if (classname.indexOf('richa')>=0)  return EJSS_ODE_SOLVERS.eulerRichardson;\n    if (classname.indexOf('euler')>=0)  return EJSS_ODE_SOLVERS.euler;\n    if (classname.indexOf('fehlberg78')>=0) return EJSS_ODE_SOLVERS.fehlberg78;\n    if (classname.indexOf('fehlberg8')>=0)  return EJSS_ODE_SOLVERS.fehlberg8;\n    //if (classname.indexOf('radau')>=0)  return EJSS_ODE_SOLVERS.radau5;\n    if (classname.indexOf('runge')>=0)  return EJSS_ODE_SOLVERS.rungeKutta4;\n    if (classname.indexOf('verlet')>=0) return EJSS_ODE_SOLVERS.velocityVerlet;\n    return EJSS_ODE_SOLVERS.rungeKutta4;\n  }\n\n  function _setSolverClass(_odeName, _engine) {\n    var ode = _getODE(_odeName);\n    if (ode===null) return;\n    if (!_engine.setODE) _engine = _getEngineSolverClass(_engine);\n    if (_engine) ode.setSolverClass(_engine);\n  }\n",BLOCKLY_ADD_EVENT_PIECE:"\n    __odeSelf._addEvent = function(userCondition,userAction,eventType,eventMethod,maxIter,eventTolerance,endAtEvent) {\n    \n      var __User_Event = function (userCondition,userAction,eventType,eventMethod,maxIter,eventTolerance,endAtEvent) {\n        var _eventSelf = {};\n        _eventSelf.getTypeOfEvent = function() { return eventType; }\n        _eventSelf.getRootFindingMethod = function() { return eventMethod; }\n        _eventSelf.getMaxIterations = function() { return maxIter; }\n        _eventSelf.getTolerance = function() { return eventTolerance; }\n\n        _eventSelf.evaluate = function(_aState) {\n{{EXTRACT_VARIABLES_A_STATE}}\n          return eval(userCondition);\n        }\n\n        _eventSelf.action = function() {\n{{EXTRACT_VARIABLES_STATE}}\n          var _returnValue = __userDefinedAction();\n{{UPDATE_VARIABLES_STATE}}\n          return _returnValue;\n        }\n\n        function __userDefinedAction() {\n          if (undefined != functions) eval(functions.toString());\n          eval(userAction);\n          return endAtEvent;\n        }\n\n        return _eventSelf;\n      } // End of event\n     _userEvents{{PAGE_INDEX}}.push(__User_Event(userCondition,userAction,eventType,eventMethod,maxIter,eventTolerance,endAtEvent));\n    }\n"},(WebEJS_GEN=WebEJS_GEN||{}).generate_variables={getVariableList:function(t){var e=[];for(const a of t)if("true"==a.Active)for(const t of a.Variables){const a=t.Name.trim();if(a){var n=a.indexOf("[");n<0?e.push(a):e.push(a.substring(0,n))}}return e},isArrayOfDouble:function(t,e){const n=function(t,e){for(const n of t)if("true"==n.Active)for(const t of n.Variables)if(t.Name==e)return t;return null}(t,e);if(!n)return!1;const a=n.Dimension.replaceAll(" ","");return a&&a.trim().length>0},appendDefinition:function(t,e){function n(t){var e=t.indexOf("[");return e<0?t:t.substring(0,e)}for(const o of e)if("true"==o.Active){const e=o.Name;for(const i of o.Variables){var a=i.Name.trim();a&&(a=n(a),t.push("  var "+a+"; // Model.Variables."+e+"."+a))}t.push("")}},appendSerializeCode:function(t,e){function n(t,e){for(const a of t)if("true"==a.Active)for(const t of a.Variables){const a=t.Name.trim();if(a){var n=a.indexOf("[");if(n<0)e(t,a,"");else{const o=a.substring(0,n),i=a.substring(n+1);e(t,o,(n=i.indexOf("]"))<0?"__i":i.substring(0,n))}}}}t.push("  function _serialize() { return _model.serialize(); }\n"),t.push("  _model._userSerialize = function() {");var a=[];n(e,((t,e,n)=>{a.push(e+" : "+e)})),t.push("    return { "+a.join(", ")+" };"),t.push("  }"),t.push("  function _serializePublic() { return _model.serializePublic(); }\n"),t.push("  _model._userSerializePublic = function() {"),a=[],n(e,((t,e,n)=>{"domain"in t?(t.domain.includes("public")||t.domain.includes("output"))&&a.push(e+" : "+e):a.push(e+" : "+e)})),t.push("    return { "+a.join(", ")+" };"),t.push("  }\n"),t.push("  _model._readParameters = function(json) {"),n(e,((e,n,a)=>{t.push("    if(typeof json."+n+" != 'undefined') "+n+" = json."+n+";")})),t.push("  }\n"),t.push("  _model._readParametersPublic = function(json) {"),n(e,((e,n,a)=>{"domain"in e?(e.domain.includes("public")||e.domain.includes("output"))&&t.push("    if(typeof json."+n+" != 'undefined') "+n+" = json."+n+";"):t.push("    if(typeof json."+n+" != 'undefined') "+n+" = json."+n+";")})),t.push("  }"),t.push(WebEJS_GEN.generate_variables.__FINAL_SERIALIZE_CODE)},appendReset:function(t,e){function n(t){var e=[];for(const n of t.split(/\s+|\[|\]/))n&&e.push(n);return e}function a(t,e,a,o,i,s){if(!s){return t+o+" = new Array("+n(i).shift()+"); "+e}if(s.startsWith("new ")||s.startsWith("["))return t+o+" = "+s+"; "+e;const l=[],r=n(i);l.push(t+o+" = new Array("+r[0]+"); "+e),l.push(t+"(function () {"),prefix="  "+t,accumIndexStr="";var c=null;const d=r.length;if(a)c=a.split(","),l.push(prefix+"var "+a+";");else if(d>1){for(var u="",p=1;p<d;p++)u+=", _i"+p;l.push(prefix+"var _i0"+u+";")}else l.push(prefix+"var _i0;");for(p=0;p<d;p++){const t=r.shift();var m=a?c.shift().trim():"_i"+p;l.push(prefix+"for ("+m+"=0; "+m+"<"+t+"; "+m+"+=1) { "+e),prefix+="  ",accumIndexStr+="["+m+"]",p<d-1?l.push(prefix+o+accumIndexStr+" = [];"):l.push(prefix+o+accumIndexStr+" = "+s+"; "+e)}for(p=0;p<d;p++)prefix=prefix.substring(2),l.push(prefix+"}");return l.push(t+"}());"),l.join("\n")}for(const l of e){if("true"!=l.Active)continue;const e=l.Name;t.push("  _model.addToReset(function() { // Reset of "+e);for(const r of l.Variables){const l=r.Name.trim();if(!l)continue;const c=r.Value.trim(),d=r.Dimension.replaceAll(" ","");var o="// Model.Variables."+e+"."+l;if(d&&d.trim()){var i=l;const r=n(d).length,u=n(i),p=u.length;var s=null;if(p>1){i=u.shift();for(s=u.shift();u.length>0;)s+=", "+u.shift();p-1!=r&&alert("Syntax error: Dimension brackets in variable name "+l+" ("+e+") do not match the dimension "+d)}t.push(a("    ",o,s,i,d,c))}else c&&t.push("    "+l+" = "+c+"; "+o)}t.push("  }); // End of reset of "+e+"\n")}},__FINAL_SERIALIZE_CODE:"\n  function _unserializePublic(json) { return _model.unserializePublic(json); }\n\n  _model._userUnserializePublic = function(json) {\n    _model._readParametersPublic(json);\n    _resetSolvers();\n    _model.update();\n  }\n\n  function _unserialize(json) { return _model.unserialize(json); }\n\n  _model._userUnserialize = function(json) {\n    _model._readParameters(json);\n    _resetSolvers();\n    _model.update();\n  }\n"},(WebEJS_GEN=WebEJS_GEN||{}).generate_view={__getPropertyInfo:function(t,e){for(const n of t)if(n.name==e)return n;return{}},__getElementPropertyList:function(t){const e=t.split("."),n=sMainGUI.getSystemInformation("view_elements_info")[e[0]][e[1]];var a=[];return"properties"in n&&a.push(...n.properties),"parent"in n&&a.push(...WebEJS_GEN.generate_view.__getElementPropertyList(n.parent)),a},_isJSExpressionWithIdentifiers:function(t){try{const n=esprima.parseScript(t,{tokens:!0});for(var e in n.tokens){if("Identifier"==n.tokens[e].type)return!0}}catch(t){}return!1},__getSortedProperties:function(t,e){var n=[],a=[];for(const o of t){const t=o.name,i=WebEJS_GEN.generate_view.__getPropertyInfo(e,t);"types"in i&&("modifiers"in i&&i.modifiers.includes("PREVIOUS")?n.push(o):a.push(o))}return n.push(...a),n},__getMultilineValue:function(t,e){if(t.startsWith("{")&&t.endsWith("}"))return t;if(t=t.replaceAll("\n"," ").replaceAll("\r"," ").trim(),e.includes("String")){const e=t.at(0),n=t.at(-1);'"'!=e&&"'"!=e||(t=t.slice(1)),'"'!=n&&"'"!=n||(t=t.slice(0,-1)),t='"'+t.replaceAll("\\","\\\\").replaceAll('"','\\"')+'"'}return t},__appendDefinition:function(t,e,n,a,o){for(const s of e){var i=!1;const e=sMainGUI.getSystemInformation("view_elements").classnames[s.Type],l=[];if("Properties"in s&&s.Properties.length){const t=WebEJS_GEN.generate_view.__getElementPropertyList(e);for(const e of WebEJS_GEN.generate_view.__getSortedProperties(s.Properties,t)){const n=e.name,r=WebEJS_GEN.generate_view.__getPropertyInfo(t,n),c=e.value;"GraphicsMode"==n&&"Canvas"==c&&(i=True),"types"in r?r.types.includes("Action")||c.startsWith("%")&&c.endsWith("%")||a.includes(c)||WebEJS_GEN.generate_view._isJSExpressionWithIdentifiers(c)||("modifiers"in r&&r.modifiers.includes("MULTILINE")?(text=WebEJS_GEN.generate_view.__getMultilineValue(c,r.types),!o&&r.modifiers.includes("HTML")&&(text=WebEJS_TOOLS.html_tools.convertToAbsolute(text))):text=c.replaceAll("\r"," ").replaceAll("\n"," ").trim(),l.push('      .setProperty("'+n+'",'+text+")")):(console.error("property has no 'types' field !!!"),console.error("prop :"+n+" for element :"+s.Name),console.error("prop_info:"),console.error(r))}}command=i?"    _view._addElement("+e+", '"+s.Name+"', _view."+n+", 'GRAPHICS2D_CANVAS')":"    _view._addElement("+e+", '"+s.Name+"', _view."+n+")",l.length?(t.push(command),l.push("      ;"),t.push(l.join("\n"))):t.push(command+";"),"Children"in s&&WebEJS_GEN.generate_view.__appendDefinition(t,s.Children,s.Name,a,o)}return t.join("\n")},__appendLinks:function(t,e,n,a){for(const s of e){const e=sMainGUI.getSystemInformation("view_elements").classnames[s.Type],l=s.Name;if("Properties"in s){const r=WebEJS_GEN.generate_view.__getElementPropertyList(e);for(const e of WebEJS_GEN.generate_view.__getSortedProperties(s.Properties,r)){const c=e.name,d=WebEJS_GEN.generate_view.__getPropertyInfo(r,c);var o=e.value.trim();if("types"in d)if(d.types.includes("Action")){if(!a)continue;const e="// Action "+c+" for element "+l;if(o.startsWith("%")&&o.endsWith("%"))o=o.slice(1,-1),t.push("      _view."+l+".setAction('"+c+"', "+o+"); "+e);else{t.push("      _view."+l+".setAction('"+c+"', function(_data, _info) { "+e);var i=0;for(const e of o.split("\n"))i+=1,t.push("        "+e+" // property "+c+" of "+l+": line "+i);t.push("      });")}}else{const e=o.startsWith("%")&&o.endsWith("%");if(e||n.includes(o)){const n="_view."+l+".linkProperty('"+c+"',",a="// linking "+c+" of "+l;e&&(o=o.slice(1,-1));const i="function() { return "+o+"; }, function(_v) { "+o+" = _v; });";t.push("      "+n+" "+i+" "+a)}else if(o=o.replaceAll("\r"," ").replaceAll("\n"," "),WebEJS_GEN.generate_view._isJSExpressionWithIdentifiers(o)){const e="_view."+l+".linkProperty('"+c+"',",n="// linking "+c+" of "+l,a=o.includes("return")?"function() { "+o+"; });":"function() { return "+o+"; });";t.push("      "+e+" "+a+" "+n)}}else console.error("property has no 'types' field !!!"),console.error("prop :"+c+" for element :"+s.Name),console.error("prop_info:"),console.error(d)}}"Children"in s&&WebEJS_GEN.generate_view.__appendLinks(t,s.Children,n,a)}},getTreeCode:function(t,e,n,a,o){const i=[];a||i.push("function _getBase64Image(__base64ImageName) { return __base64ImageName; }\n"),i.push("function _simulationView (_topFrame,_libraryPath,_codebasePath) {"),i.push("  var _view = EJSS_CORE.createView(_topFrame);\n"),i.push("  if (_libraryPath)  _view._setLibraryPath(_libraryPath);"),i.push("  if (_codebasePath) _view._setResourcePath(_codebasePath);\n");var s=0;for(const t of e)"true"==t.External?i.push('  _view._addDescriptionPage("'+t.Name+'","'+t.Code.trim()+'");'):i.push('  _view._addDescriptionPage("'+t.Name+'","_description_'+s+'.html");'),s++;return i.push("\n  _view._reset = function() {"),i.push("    _view._clearAll();"),t.length?WebEJS_GEN.generate_view.__appendDefinition(i,t,"_topFrame",n,o):i.push(WebEJS_GEN.generate_view.__EMPTY_VIEW.replaceAll("{{WEBEJS_ASSETS_FOLDER}}",sMainAssetsURL)),i.push("  }; // end of _view._reset"),i.push("  return _view;"),i.push("}"),i.push(""),i.join("\n")},appendCreationCode:function(t,e,n,a){if(t.push("  function _createView() {"),t.push("    _view = new _simulationView(_topFrame,_libraryPath,_codebasePath);"),t.push("    var _view_super_reset = _view._reset;"),t.push("    _view._reset = function() {"),t.push("      _view_super_reset();"),a){const n=WebEJS_GEN.generate_view.__getElementPropertyList("EJSS_SIMULATION.root");for(const a of e.RootProperties){const e=a.name,i=WebEJS_GEN.generate_view.__getPropertyInfo(n,e);var o=a.value.trim();console.log("Root Property %s has types = %s",i.types),i.types.includes("Action")?o=o.startsWith("%")&&o.endsWith("%")?o.slice(1,-1):"function(_data, _info) { "+o+" }":"modifiers"in i&&i.modifiers.includes("MULTILINE")&&(o=WebEJS_GEN.generate_view.__getMultilineValue(o,i.types));const s="// Root property "+e;t.push("      _view._setRootProperty(_model,'"+e+"', "+o+"); "+s)}}WebEJS_GEN.generate_view.__appendLinks(t,e.Tree,n,a),t.push("    }; // end of new reset"),t.push(""),t.push("    _model.setView(_view);"),t.push("    _model.reset();"),a&&t.push("    _view._enableEPub();"),t.push("  } // end of _createView\n")},__EMPTY_VIEW:'  \n\tvar _model = EJSS_CORE.createAnimationLMS();\n  const EMPTY_HTML = `<span style="text-align: center; color:red; font-size: 2em;">Your view is empty</span>\n        <hr/>\n        <span style="text-align: center; font-size: 1.5em;">To populate your view:</span>\n        <ul>\n            <li style="list-style-type: none; font-size: 1.25em;">\n                1. Select the <span style=\'font-weight: bold; color: rgb(0,128,192);\'>View</span> panel on the top left group of buttons (see figure.)\n            </li>\n            <li style="list-style-type: none; text-align: center;">\n                <img width=\'60%\' src=\'{{WEBEJS_ASSETS_FOLDER}}/WebEJS/EmptyView/ViewButton.png\' />\n            </li>\n            <li style="list-style-type: none;">\n                <span style="font-size: 1.25em;">\n                    2. Drag and drop an element from the <b>Compound</b> or <b>Containers</b> palettes onto the <b>Simulation view</b>.\n                </span>\n                <br/><br/>\n                The image shows the <b>SingleDrawing</b> compound element being dragged onto the simulation view.\n                This creates a nice initial setting for a simulation with a two-dimensional scene.\n            </li>\n            <li style="list-style-type: none;">\n                <img width=\'95%\' src="{{WEBEJS_ASSETS_FOLDER}}/WebEJS/EmptyView/DragAndDrop.png" />\n            </li>\n            <li style="list-style-type: none;">\n                <span style="font-size: 1.25em;">\n                    3. Add and customize elements to fit your needs...\n                </span>\n                <br/><br/> \n                For more information visit <a href="https://www.um.es/fem/EjsWiki/Main/View" target="_blank" rel="noopener noreferrer">the EJS View help</a>.\n            </li>\n        </ul>\n        `;\n    _view._addElement(EJSS_INTERFACE.panel, \'_empty_panel\', _view._topFrame)\n       // .setProperty("Background","#ebe9e9")\n        .setProperty("Html",EMPTY_HTML)\n'},(WebEJS_GEN=WebEJS_GEN||{}).generate=function(t){const e=n("forPackage",!0);function n(e,n){return e in t&&t[e]==n}var a,o=n("useCDN",!0)?sMainAssetsURL:"./",i=o+sMainGUI.getSystemInformation("ejs_library_folder"),s=o+sMainGUI.getSystemInformation("model_elements_folder");if(e)a=null;else{const t=window.location.origin;a=t+sMainGUI.getURLpathFor("")}const l='\n      var _model;\n      var _scorm;\n      window.addEventListener(\'load\',\n        function () {\n          _model = new {{MODEL_NAME}}("_topFrame","{{EJS_LIBRARY_FOLDER}}",{{CODEBASE_FOLDER}});\n\n          if (typeof _isApp !== "undefined" && _isApp) _model.setRunAlways(true);\n          TextResizeDetector.TARGET_ELEMENT_ID = \'_topFrame\';\n          TextResizeDetector.USER_INIT_FUNC = function () {\n            var iBase = TextResizeDetector.addEventListener(function(e,args) {\n                _model._fontResized(args[0].iBase,args[0].iSize,args[0].iDelta);\n                },null);\n            _model._fontResized(iBase);\n          };\n          _model.onload();\n        }, false);';const r=sMainGUI.saveObject(),c=r.information,d=n("separatePage",!0)?function(t){const e=t.Title,n=t.Logo,o=t.Author,s=t.AuthorLogo,l=o.join(", ");var r=t.Copyright.trim();r||(r=l);const c=new Date;var d=[];d.push("    <div id='metadata' class='metadata'>"),d.push("      <br />"),d.push("      <div id='title_author'>"),d.push("        <hr />"),d.push("        <b>Title and author:</b>"),d.push("        <p>"),e&&d.push("          "+e+"<br/>");for(const t of n){const e=WebEJS_TOOLS.isBase64Image(t)||!a?t:a+t;d.push("          <img alt='Logo' src='"+e+"'/>")}d.push("        </p>"),d.push("        <p>");for(const t of s){const e=WebEJS_TOOLS.isBase64Image(t)||!a?t:a+t;d.push("          <img alt='author image' src='"+e+"'/>")}return d.push(l),d.push("        </p>"),d.push("        <hr />"),d.push("      </div>"),d.push("      <p></p>"),d.push("      <div id='copyright_message'>"),d.push("        <div class='cc_left'  style='float:left'>"),d.push("          &#169;"+c.getFullYear()+", "+r+". <br />"),d.push("          Compiled with <a href='https://t.um.es/webejs' target='_blank'>WebEJS : the web version of Easy JavaScript Simulations</a>.<br />"),d.push("          Version 1.0 (240505)"),d.push("        </div>"),d.push("        <div class='cc_right' style='float:right'>"),d.push("          Released under a <a rel='license' target='_blank' href='https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en_US'>"),d.push("          <img alt='Creative Commons Attribution-NonCommercial-ShareAlike' src='"+i+"images/cc_icon.png' />"),d.push("          </a> license."),d.push("        </div>"),d.push("      </div>"),d.push("    </div>"),d.join("\n")}(c):"",u=function(t){var e=[];for(filename of t.information.AuxiliaryFiles)filename.trim().toLowerCase().endsWith(".js")&&(a?e.push("    <script src='"+a+filename+"'><\/script>"):e.push("    <script src='"+filename+"'><\/script>"));return WebEJS_GEN.generate_model.addElementsScriptCode(e,s,t.model),e.join("\n")}(r),p=[i+"css/ejss.css"];for(const t of c.CSSFile.split(";"))t.toLowerCase().endsWith(".css")&&p.push(t);n("type","PWA")&&p.push("manifest.json");var m=WebEJS_GEN.generate_model.getModelCode(r,n("fullModel",!0),e),g=['    <script type="text/javascript">\x3c!--//--\x3e<![CDATA[//>\x3c!--'];g.push(m.model),g.push(m.view),g.push("    //--\x3e<!]]><\/script>");var h=function(t,e,n,a,o){var s=['<?xml version="1.0" encoding="utf-8"?>'];s.push("<!DOCTYPE html>"),s.push('<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">'),s.push("  <head>"),s.push('    <meta charset="utf-8" />'),s.push("    <title>"+t.Title+"</title>"),s.push(t.HTMLHead);for(const t of e)s.push('    <link rel="stylesheet"  type="text/css" href="'+t+'" />');return n&&s.push('\n    <link rel="manifest" href="'+n+'" />'),s.push('\n    <script type=\'text/javascript\'>\x3c!--//--\x3e<![CDATA[//>\x3c!--\n      var gOldOnError = window.onerror;\n      window.onerror = function myErrorHandler(errorMsg, url, lineNumber) {\n        console.log(errorMsg + " (at " + url.toString() + " => line:" + lineNumber + ")" );\n        if (gOldOnError) return gOldOnError(errorMsg, url, lineNumber);\n        return false;\n      }\n    //--\x3e<!]]><\/script>'),s.push('    <script src="'+i+'scripts/textresizedetector.js"><\/script>'),s.push('    <script src="'+i+'ejsS.v1.min.js"><\/script>'),a&&s.push(a),o&&s.push(o),s.push("\n  </head>"),s}(c,p,"",u,g.join("\n"));return h.push("  <body>"),h.push('    <div role="button" id="_topFrame" style="text-align:center"></div>'),d&&h.push(d),h.push('    <script type="text/javascript">\x3c!--//--\x3e<![CDATA[//>\x3c!--'),h.push(l.replaceAll("{{MODEL_NAME}}","_simulation").replaceAll("{{EJS_LIBRARY_FOLDER}}",i).replaceAll("{{CODEBASE_FOLDER}}",a?'"'+a+'"':"null")),n("separatePage",!1)&&h.push("        window.console = window.parent.console;"),h.push("    //--\x3e<!]]><\/script>"),n("extraScripts",!0)&&h.push(options.extraScripts),h.push("  </body>"),h.push("</html>"),h.join("\n")},(WebEJS_GUI=WebEJS_GUI||{}).comm=function(t){var e={};const n=WebEJS_TOOLS.textTools();function a(t,e,n){n?sMainGUI.errorLine(sMainResources.getString(e)+" : "+n):sMainGUI.errorLine(sMainResources.getString(e)),sMainGUI.errorLine(sMainResources.getString("Server message")+" : "+t.responseText),sMessageForm.showWarning("Communication error",t.responseText,"Check out the output area.")}function o(e,n,o,i,s,l){n.session_id=t,$.ajax({type:"POST",url:e,headers:{"X-CSRFToken":sMainCsrfToken},contentType:"application/json; charset=UTF-8",processData:!1,data:JSON.stringify(n),success:o,error:t=>{a(t,i,s),l&&l()}})}function s(){sMainGUI.errorLine(sMainResources.getString("No simulation or file list in the server response!")),sMessageForm.showWarning("Reading error","There are no valid simulation files in the uploaded ZIP!!!","Check out the output area.")}e.disconnect=function(){o("/logout",{},(()=>{console.log("WebEJS disconnected."),window.location="/"}),"Error disconnecting from the server!")},e.getSystemInformation=function(t){o("/system/system_information",{},t,"Error reading system information from server!")};var l=!0;function r(t){const n=!l;if(l=!1,"files"in t){const a=t.files;if("messages"in t&&sMainGUI.displayReadingWarnings(t.messages),a.length>0)return function(t){const n=[];for(i in t)n.push({name:t[i]});sMainSelectChoiceForm.show("Choose simulation from the ZIP",n,t[0],(function(t){sMessageForm.showTemporal("Loading downloaded simulation...",sLocaleFor("Cleaning files..."),"This message should dissapear automatically when done."),o("/simulation/get",{file:t},(t=>{"simulation"in t?sMainGUI.readResponse(t):s()}),"Error selecting file!")}),null,!0,!1,(function(){sMainGUI.logLine(sMainResources.getString("Reading default, empty simulation.")),e.newSimulation()}))}(a);if(n)return sMessageForm.showWarning("Reading warning","There are no valid simulation files in the uploaded ZIP!!!","The files have been saved, and a default, empty simulation will be loaded.",(()=>{if("simulation"in t)return sMainGUI.readResponse(t)}));if("simulation"in t)return sMainGUI.readResponse(t)}else{if("simulation"in t)return sMainGUI.readResponse(t);s()}}e.getSimulation=function(){o("/simulation/get",{},r,"Error reading current simulation!")},e.updateSimulation=function(){o("/simulation/update",{simulation:sMainGUI.saveObject()},(()=>{console.log("Simulation updated to server.")}),"Error updating the simulation in the server!")},e.updateSimulationBeforeLeaving=function(){var e,n;message={simulation:sMainGUI.saveObject(),session_id:t},(e="/simulation/update",n=message,$.ajax({url:e,type:"POST",contentType:"application/json",data:JSON.stringify(n),dataType:"json"})).done((function(e){console.log("Simulation updated to session:"+t)})).fail((function(e,n,a){console.error("Error trying to update simulation for session:"+t,n,a)}))},e.newSimulation=function(){sMessageForm.showTemporal("Loading new simulation...",sLocaleFor("Cleaning files..."),"This message should dissapear automatically when done."),o("/simulation/new",{},(t=>{sMainGUI.readResponse(t),sMainSimulationOptions.setAuthorInfo(sMainWebEJSOptions.getAuthorInfo())}),"Error creating new simulation!")};var c={};return e.uploadUserZIPFile=function(e){!function(e,n,o,i,s,l,r){const c=new FormData;c.append("file",n),c.append("session_id",t),c.append("options",JSON.stringify(o)),$.ajax({method:"POST",type:"POST",url:e,cache:!1,enctype:"multipart/form-data",contentType:!1,processData:!1,data:c,success:i,error:t=>{a(t,s,l),r&&r()}})}("/simulation/upload",e,c,(t=>{sMainGUI.logLine(sMainResources.getString("ZIP file correctly uploaded.")),r(t)}),"Error uploading user's file: ",e)},e.openFromLibrary=function(){sMainLibraryChooser.show((function(t,e){!function(t,e){sMessageForm.showTemporal("Downloading model...",e,"This message should dissapear automatically when done.");var n=c;n.url=encodeURIComponent(t),o("/simulation/download",n,(t=>{sMessageForm.hide(),sMainGUI.logLine(sMainResources.getString("ZIP file correctly downloaded.")),r(t)}),"Error downloading library model: ",e)}(t,e)}))},e.zipSimulation=function(t,e){const a=sMainGUI.saveObject();var i={source:a};if(t){const t={useCDN:!("IncludeLibrary"in a.information&&"true"==a.information.IncludeLibrary),separatePage:!0,fullModel:!0,forPackage:!0};i.generated=WebEJS_GEN.generate(t)}var s=a.information.Title.trim();""==s||null==s?s="YourSimulation":s.endsWith(".")&&(s=s.substring(0,s.length-1)),s=n.sanitizeFilename(s),s=t?"webejs_model_"+s+".zip":"webejs_src_"+s+".zip",sMainFilenameForm.show(s,(t=>{if(!n.isValidFilename(t))return sMainGUI.errorLine(sMainResources.getString("This filename may cause problems")+" : "+t),sMainGUI.errorLine(sMainResources.getString("Please, consider instead: ")+" : "+n.sanitizeFilename(t)),void sMessageForm.showWarning("Filename invalid",t,"Check out the output area.");i.filename=encodeURI(t),o("/output/zip",i,(t=>{sMainGUI.logLine(sMainResources.getString("ZIP simulation file correctly created.")),console.log("Zip ok created"),console.log(t),sMainCheckUnload=!1,window.location=t.url,e&&e()}),"Error creating ZIP simulation file!")}))},e.checkRequiredFile=function(t,e,n){const a=sMainGUI.getURLpathFor(t);var o=new XMLHttpRequest;o.open("GET",a,!0),o.onreadystatechange=function(){4===o.readyState&&(404===o.status?n&&n(t):e&&(t.startsWith("/")||t.startsWith("./")||(t="./"+t),e(t,a)))},o.send()},e.refreshUserFiles=function(t){o("/manager/list",{},(e=>{t(e.listing)}),"Updating user files failed")},e.userFileCommand=function(arguments,t){o("/manager/command",{arguments:arguments},(e=>{t(e.params)}),t,"User file command failed:"+arguments)},e.downloadFileCommand=function(t){const e=t.lastIndexOf("/"),n=e<0?t:t.substring(e+1);sMainFilenameForm.show(n,(e=>{const arguments={command:"Download",path:t,filename:e};o("/manager/command",arguments,(t=>{sMainGUI.logLine(sMainResources.getString("File correctly downloaded "+t.filename)),console.log(t),window.location=t.url}),"User file command failed:"+arguments)}))},$.ajaxSetup({beforeSend:function(t,e){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(e.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",function(t){var e=null;if(document.cookie&&""!=document.cookie)for(var n=document.cookie.split(";"),a=0;a<n.length;a++){var o=$.trim(n[a]);if(o.substring(0,t.length+1)==t+"="){e=decodeURIComponent(o.substring(t.length+1));break}}return e}("csrftoken"))}}),e},(WebEJS_GUI=WebEJS_GUI||{}).main=function(){var t={},e={},n=null,a="",o=[],i=!1,s=!1,l=0;t.getURLpathFor=function(t){return WebEJS_TOOLS.isBase64Image(t)?t:a+t},t.getSystemInformation=function(t){return e[t]},t.getSystemIconURL=function(t){return sMainAssetsURL+"WebEJS/icons/"+t},t.getModelElementsURL=function(){return sMainAssetsURL+e.model_elements_folder},t.getWebEJSLogo=function(){return t.getSystemIconURL("WebEJS_logo.png")},t.getWebEJSLogoImg=function(){return'<img  src="'+sMainGUI.getWebEJSLogo()+'" height="40" class="me-2 d-inline-block align-bottom">'};var r=25,c=50;function d(){return!$("#sPreviewPanel").hasClass("d-none")}function u(t){$("#"+t+"Panel").hasClass("d-none")?($("#"+t+"Panel").removeClass("d-none"),$("#sMainRadioButtons ."+t+"Btn").removeClass("sRadioButtonOff").addClass("sRadioButtonOn"),$("#sMainRadioButtons ."+t+"BtnPlus").prop("disabled",!1),$("#sMainRadioButtons ."+t+"BtnMinus").prop("disabled",!1)):($("#"+t+"Panel").addClass("d-none"),$("#sMainRadioButtons ."+t+"Btn").removeClass("sRadioButtonOn").addClass("sRadioButtonOff"),$("#sMainRadioButtons ."+t+"BtnPlus").prop("disabled",!0),$("#sMainRadioButtons ."+t+"BtnMinus").prop("disabled",!0))}t.showPanel=function(t){if($("#"+t+"Panel").hasClass("d-none")){var e=["sModel","sDescription","sView"],n=e.indexOf(t);for(var a in-1!==n&&e.splice(n,1),e)$("#"+e[a]+"Panel").addClass("d-none"),$("#sMainRadioButtons ."+e[a]+"Btn").removeClass("sRadioButtonOn").addClass("sRadioButtonOff");$("#"+t+"Panel").removeClass("d-none"),$("#sMainRadioButtons ."+t+"Btn").removeClass("sRadioButtonOff").addClass("sRadioButtonOn")}},$("#sMainRadioButtons .sDescriptionBtn").click((()=>{t.showPanel("sDescription")})),$("#sMainRadioButtons .sModelBtn").click((()=>{t.showPanel("sModel")})),$("#sMainRadioButtons .sViewBtn").click((()=>{t.showPanel("sView")})),t.setSimulationOptionsRadio=function(t){t?$("#sMainRadioButtons .sInformationBtn").removeClass("sRadioButtonOff").addClass("sRadioButtonOn"):$("#sMainRadioButtons .sInformationBtn").removeClass("sRadioButtonOn").addClass("sRadioButtonOff")},$("#sMainRadioButtons .sInformationBtn").click((function(){sMainSimulationOptions.toggle()})),$("#sPreviewPanel").css("min-width",c+"vw"),$("#sMainRadioButtons .sPreviewBtn").click((()=>{u("sPreview"),d()&&h.updatePreview()})),$("#sMainRadioButtons .sPreviewBtnPlus").click((()=>{c=Math.min(75,c+25),$("#sPreviewPanel").css("min-width",c+"vw")})),$("#sMainRadioButtons .sPreviewBtnMinus").click((()=>{c=Math.max(25,c-25),$("#sPreviewPanel").css("min-width",c+"vw")})),$("#sOutputPanel").css("min-height",r+"vh"),$("#sMainRadioButtons .sOutputBtn").click((()=>{u("sOutput")})),$("#sMainRadioButtons .sOutputBtnPlus").click((()=>{r=Math.min(75,r+25),$("#sOutputPanel").css("min-height",r+"vh")})),$("#sMainRadioButtons .sOutputBtnMinus").click((()=>{r=Math.max(25,r-25),$("#sOutputPanel").css("min-height",r+"vh")})),$(".sMainMenuAction").click((function(e){const n=e.currentTarget.dataset.action;$(this).tooltip("hide"),t.mainAction(n)}));var p=WebEJS_GUI.descriptionWorkpanel("#sDescriptionPanel"),m=WebEJS_GUI.modelWorkpanel(),g=WebEJS_GUI.viewWorkpanel(),h=WebEJS_GUI.previewArea(),f=WebEJS_GUI.outputArea();function b(){if(null!=n){window.top.document.title=sMainVersionInfo,"reading_messages"in n&&t.addReadingWarnings(n.reading_messages),sMainSimulationOptions.readObject(n.information),p.readObject(n);var e=m.readObject(n);s||alert("WebEJS view not yet ready. You should not see this alert!!!"),(e=e&&g.readObject(n))?(t.logLine(sLocaleFor("File successfully read!")),d()&&h.updatePreview(),o.length<=0?sMessageForm.hide():t.displayReadingWarnings()):(sMessageForm.showHTML("<h5>"+sLocaleFor("File read with errors!")+"</h5>","Error reading file!"),t.errorLine(sLocaleFor("File read with errors!")),h.clearPreview(sLocaleFor("Error reading simulation"))),sMainResources.prepareForTranslation("#sMainWorkpanel"),sMainSimulationOptions.updateDetectedFiles(),sMainFileChooser.reset(),o=[],i=!1}else alert("WebEJS has received no simulation. You should not see this alert!!!")}function v(){!1===s?(l++,f.clear(),f.logLine(sLocaleFor("WebEJS initializing...")+" "+l),window.setTimeout(v,500)):(f.clear(),f.infoLine(sLocaleFor("WebEJS is ready!")),b())}function E(t){i?sMainConfirmationForm.showWarning("The simulation has changed","Proceeding will make you lose the changes!","Proceed",t):t()}return t.getModel=function(){return m},t.getView=function(){return g},t.println=function(t){f.println(t)},t.logLine=function(t){f.logLine(t)},t.infoLine=function(t){f.infoLine(t)},t.warningLine=function(t){f.warningLine(t)},t.errorLine=function(t){f.errorLine(t)},t.setChanged=function(){i=!0},t.displayReadingWarnings=function(e){e&&(o=[],t.addReadingWarnings(e));for(var n="",a=0;a<o.length;a++)n+=o[a];sMessageForm.showWarningHTML("Reading Warnings","<p>"+n+"</p>"),o=[]},t.addReadingWarnings=function(t){for(var e=0;e<t.length;e++){var n=t[e];n="NEWLINE"==n?"<br/>":n.startsWith("RAW:")||n.startsWith("RED:")?'<span class="text-danger">'+n.substring(4)+"</span> ":'<span class="text-primary">'+sMainResources.getString(n)+"</span> ",o.push(n)}},t.saveObject=function(){var t={};return t.information=sMainSimulationOptions.saveObject(),t.description=p.saveObject(),t.model=m.saveObject(),t.view=g.saveObject(),t},t.readResponse=function(e){console.info("Response received:"),console.info(e),n=e.simulation,a=e.url_path,o=[],"messages"in e&&t.addReadingWarnings(e.messages),!1===s?v():b()},t.getDetectedFiles=function(){var t=sMainSimulationOptions.getDetectedFiles();return t.push(...p.getDetectedFiles()),t.push(...m.getDetectedFiles()),t.push(...g.getDetectedFiles()),t},t.isViewEmpty=function(){return g.viewIsEmpty()},t.getTitleForPreview=function(){var t=sMainSimulationOptions.getTitle();return t.trim().length<=0&&(t=sLocaleFor("Simulation")),t},t.reportPreview=function(t){d()&&h.reportPreview(t)},t.mainAction=function(t,e){switch(t){case"New":return void E(sMainComm.newSimulation);case"LoadLocal":return void E((function(){$("#mMainLoadLocalField").click()}));case"OpenLibrary":return void E(sMainComm.openFromLibrary);case"FileManager":return void sMainFileChooser.showManager();case"ZipSource":return void sMainComm.zipSimulation(!1,(function(){i=!1}));case"Search":return void sMessageForm.showHTML("Search option","<h5>Not yet implemented</h5>");case"Run":return void h.runSimulation();case"ZipSimulation":return void sMainComm.zipSimulation(!0);case"Translate":return n=e,void sMainResources.setLocale(n);case"Options":return void sMainWebEJSOptions.show();case"Info":return void window.open(sMainWebEJS_wiki,"_blank");case"Disconnect":return void E((function(){sMainConfirmationForm.show("Disconnection","Sure you want to disconnect?","Disconnect",sMainComm.disconnect)}));case"RefreshPreview":case"SwitchFullmodel":return void h.updatePreview()}var n},sMainComm.getSystemInformation((t=>{e=t,console.log(t),g.buildPalette(e),m.getElementsPanel().buildPalette(e),"ejs_reserved_filenames"in e&&(sMainFileChooser.addToReservedFilenameList(e.ejs_reserved_filenames),delete e.ejs_reserved_filenames),"webejs_reserved_filenames"in e&&(sMainFileChooser.addToReservedFilenameList(e.webejs_reserved_filenames),delete e.webejs_reserved_filenames),s=!0})),t},WebEJS_GUI.optionsWebEJSPanel=function(){var t={};const e=WebEJS_TOOLS.textTools();$("body").append($('\n  <div class="modal modal-dialog-scrollable fade" id="sMainWebEJSOptionsModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img  id="mWebEJSOptionsEditorLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 class="sTranslatable text-primary modal-title">WebEJS options</h5>\n\t\t\t\t</img>\n      \t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n    \t\x3c!------------------  end modal header ---------------\x3e\n      \t\n\t\t\t<div class="modal-body">\n\t\t\t\n\t\t\t\t\x3c!-- begin tab headers --\x3e\n\t\t\t\t<ul class="nav nav-tabs" id="mWebEJSOptionsEditorTabs" role="tablist">\n\t\t\t  \t<li class="nav-item" role="presentation">\n\t     \t\t\t<button class="sTranslatable nav-link active" id="mWebEJSOptionsEditorAspectTab" \n\t\t\t \t\t  \t\tdata-bs-toggle="tab" data-bs-target="#mWebEJSOptionsEditorAspectDiv"  \n\t     \t\t\t  \ttype="button" role="tab" aria-controls="mWebEJSOptionsEditorAspectDiv" aria-selected="true">\n\t     \t\t\t  \tAspect\n\t     \t\t\t </button>\n\t    \t\t</li>\n\t\t\t  \t\x3c!-- li class="nav-item" role="presentation">\n\t     \t\t\t<button class="sTranslatable nav-link " id="mWebEJSOptionsEditorRunningTab" \n\t\t\t\t\t\t \t\tdata-bs-toggle="tab" data-bs-target="#mWebEJSOptionsEditorRunningDiv"  \n\t   \t\t\t\t\t \ttype="button" role="tab" aria-controls="mWebEJSOptionsEditorRunningDiv" aria-selected="false">\n     \t\t\t\t\t Running\n\t     \t\t\t</button>\n\t    \t\t</li>\n\t\t\t  \t<li class="nav-item" role="presentation">\n\t     \t\t\t<button class="sTranslatable nav-link" id="mWebEJSOptionsEditorExportTab" \n\t\t\t \t\t  \t\tdata-bs-toggle="tab" data-bs-target="#mWebEJSOptionsEditorExportDiv"  \n\t     \t\t\t  \ttype="button" role="tab" aria-controls="mWebEJSOptionsEditorExportDiv" aria-selected="false">\n\t     \t\t\t  Export\n\t     \t\t\t</button>\n\t    \t\t</li>\n\t\t\t  \t<li class="nav-item" role="presentation">\n\t     \t\t\t<button class="sTranslatable nav-link" id="mWebEJSOptionsEditorDigitalLibrariesTab" \n\t\t\t \t\t\t \t\tdata-bs-toggle="tab" data-bs-target="#mWebEJSOptionsEditorDigitalLibrariesDiv"  \n\t     \t\t\t  \ttype="button" role="tab" aria-controls="mWebEJSOptionsEditorDigitalLibrariesDiv" aria-selected="false">\n\t     \t\t\t  DL\n\t  \t\t\t\t</button>\n\t    \t\t\t</li--\x3e\n\t\t\t \t\t<li class="nav-item" role="presentation">\n\t    \t\t\t<button class="sTranslatable nav-link" id="mWebEJSOptionsEditorAuthorTab" \n\t\t\t\t\t\t  \tdata-bs-toggle="tab" data-bs-target="#mWebEJSOptionsEditorAuthorDiv"  \n\t     \t\t\t\t  type="button" role="tab" aria-controls="mWebEJSOptionsEditorAuthorDiv" aria-selected="false">\n\t   \t\t\t\t\t Author\n\t   \t\t\t\t</button>\n  \t\t\t\t</li>\n\t\t\t\t</ul> \n\t\t\t\t\x3c!-- end tab headers --\x3e\n\t     \t\t\t\n\t\t\t\t\x3c!-- begin tab content --\x3e\n\t\t\t\t<div class="tab-content" id="mWebEJSOptionsEditorTabsContent">\n\t\t\t \t\t  \n\t\t\t\t\t<div class="tab-pane fade show " id="mWebEJSOptionsEditorRunningDiv" \n\t\t\t \t\t\t  \trole="tabpanel" aria-labelledby="mWebEJSOptionsEditorRunningTab">\n\t\t\t\t \t\t\t\t\n\t\t\t \t\t</div>\n\t\t\t \t\t  \t\n\t\t\t \t\t<div class="tab-pane fade show" id="mWebEJSOptionsEditorExportDiv" \n\t\t\t \t\t\t   role="tabpanel" aria-labelledby="mWebEJSOptionsEditorExportTab">\n\t\t\t\t\t\t\t\n\t\t\t \t\t</div>\n\t\t\t \t\t  \t\n\t\t\t \t\t\x3c!-- begin ASPECT content --\x3e\n\t\t\t \t\t<div class="tab-pane fade show active" id="mWebEJSOptionsEditorAspectDiv" \n\t\t\t \t\t\t   role="tabpanel" aria-labelledby="mWebEJSOptionsEditorAspectTab">\n\t\t\t \t\t\t  \t\t\t\n\t\t\t\t\t\x3c!-----------------------------\n\t\t\t\t\t   Interface\n\t\t\t\t\t  ----------------------------\x3e\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" \n\t\t\t\t\t\t\t\t name="mWebEJSOptionsEditorShorterLabels" id="mWebEJSOptionsEditorShorterLabels">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mWebEJSOptionsEditorShorterLabels">\n\t\t\t\t\t\t\t\tUse short labels\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\n\n            <div class="mt-2 input-group">\n\t\t\t\t\t\t\t\t<span class="sTranslatable input-group-text">Language</span>\n\t\t\t\t\t\t\t\t<select id="mWebEJSOptionsEditorLanguage" class="form-select" disabled>\n\t\t\t\t\t\t\t\t\t<option selected value="en">English</option>\n\t\t\t\t\t\t\t\t\t<option value="es">Espaol</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\x3c!-----------------------------\n\t\t\t\t\t   Preview options\n\t\t\t\t\t  ----------------------------\x3e\n\n            <div class="input-group-text form-check mt-2" id="mWebEJSOptionsEditorShowPreviewSize">\n\t\t\t\t\t  \t<span class="form-check form-check-inline">\n\t\t\t\t\t\t\t\t<label class="inline sTranslatable">Preview size:</label>\n\t\t\t\t\t  \t</span>\n\t\t\t\t\t  \t<span class="form-check form-check-inline">\n\t\t\t\t\t  \t\t<input class="form-check-input" type="radio" \n\t\t\t\t\t \t\t\t\tname="mWebEJSOptionsEditorShowPreviewSize" id="mWebEJSOptionsEditorShowPreviewSizeSmall" value="small">\n\t\t\t\t\t  \t\t<label class="form-check-label sTranslatable" for="mWebEJSOptionsEditorShowPreviewSizeSmall">Small</label>\n\t\t\t\t\t  \t</span>\n\t\t\t\t\t  \t<span class="form-check form-check-inline">\n\t\t\t\t\t  \t\t<input class="form-check-input" type="radio" checked \n\t\t\t\t\t \t\t\t\tname="mWebEJSOptionsEditorShowPreviewSize" id="mWebEJSOptionsEditorShowPreviewSizeMedium" value="medium">\n\t\t\t\t\t  \t\t<label class="form-check-label sTranslatable" for="mWebEJSOptionsEditorShowPreviewSizeMedium">Medium</label>\n\t\t\t\t\t  \t</span>\n\t\t\t\t\t  \t<span class="form-check form-check-inline">\n\t\t\t\t\t  \t\t<input class="form-check-input" type="radio" \n\t\t\t\t\t \t\t\t  name="mWebEJSOptionsEditorShowPreviewSize" id="mWebEJSOptionsEditorShowPreviewSizeLarge" value="large">\n\t\t\t\t\t  \t\t<label class="form-check-label sTranslatable" for="mWebEJSOptionsEditorShowPreviewSizeLarge">Large</label>\n\t\t\t\t\t  \t</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\x3c!-----------------------------\n\t\t\t\t\t   Output options\n\t\t\t\t\t  ----------------------------\x3e\n\n\t\t\t\t\t\t<div class="input-group-text form-check mt-2" id="mWebEJSOptionsEditorShowOutputSize">\n\t\t\t\t\t  \t<span class="form-check form-check-inline">\n\t\t\t\t\t\t\t\t<label class="inline sTranslatable">Output size:</label>\n\t\t\t\t\t  \t</span>\n\t\t\t\t\t  \t<span class="form-check form-check-inline">\n\t\t\t\t\t  \t\t<input class="form-check-input" type="radio" checked\n\t\t\t\t\t \t\t\t\tname="mWebEJSOptionsEditorShowOutputSize" id="mWebEJSOptionsEditorShowOutputSizeSmall" value="small">\n\t\t\t\t\t  \t\t<label class="form-check-label sTranslatable" for="mWebEJSOptionsEditorShowOutputSizeSmall">Small</label>\n\t\t\t\t\t  \t</span>\n\t\t\t\t\t  \t<span class="form-check form-check-inline">\n\t\t\t\t\t  \t\t<input class="form-check-input" type="radio"  \n\t\t\t\t\t \t\t\t\tname="mWebEJSOptionsEditorShowOutputSize" id="mWebEJSOptionsEditorShowOutputSizeMedium" value="medium">\n\t\t\t\t\t  \t\t<label class="form-check-label sTranslatable" for="mWebEJSOptionsEditorShowOutputSizeMedium">Medium</label>\n\t\t\t\t\t  \t</span>\n\t\t\t\t\t  \t<span class="form-check form-check-inline">\n\t\t\t\t\t  \t\t<input class="form-check-input" type="radio" \n\t\t\t\t\t \t\t\t  name="mWebEJSOptionsEditorShowOutputSize" id="mWebEJSOptionsEditorShowOutputSizeLarge" value="large">\n\t\t\t\t\t  \t\t<label class="form-check-label sTranslatable" for="mWebEJSOptionsEditorShowOutputSizeLarge">Large</label>\n\t\t\t\t\t  \t</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t \t\t</div>\n\t\t\t \t\t\x3c!-- end ASPECT content --\x3e\n\t\t\t \t\t\n\t\t\t \t\t<div class="tab-pane fade show" id="mWebEJSOptionsEditorDigitalLibrariesDiv" \n\t\t\t \t\t\t   role="tabpanel" aria-labelledby="mWebEJSOptionsEditorDigitalLibrariesTab">\n\t\t\t \t\t</div>\n\t\n\t\t\t\t \t\t\x3c!-- begin AUTHOR content --\x3e\n\t\t\t \t\t<div class="tab-pane fade show" id="mWebEJSOptionsEditorAuthorDiv" \n\t\t\t \t\t\t   role="tabpanel" aria-labelledby="mWebEJSOptionsEditorAuthorTab">\n\t\t\t \t\t\t   \n\t\t\t \t\t\t<div class="mt-2">\n          \t\t<label for="mWebEJSOptionsEditorAuthorNameValue" class="sTranslatable form-label form-label-sm">Name</label>\n          \t\t<input type="text" class="form-control form-control-sm" name="mWebEJSOptionsEditorAuthorNameValue" id="mWebEJSOptionsEditorAuthorNameValue"\n            \t\tplaceholder="Enter your name here" >\n        \t\t</div>\n\n\t\t\t \t\t\t<div class="input-group mt-2">\n\t            <label class="input-group-text sTranslatable" for="mWebEJSOptionsEditorAuthorIconField" class="form-label">Click to choose a (50x50) image</label>\n\t            <label class="input-group-text bg-white" id="mWebEJSOptionsEditorAuthorIconButton">\n\t              <img id="mWebEJSOptionsEditorAuthorIconImage" height="50">\n\t            </label>\n             <input class="form-control d-none" accept="image/*"  id="mWebEJSOptionsEditorAuthorIconField" type="file">\n           </div>\n\n\t\t\t \t\t\t<div class="mt-2">\n          \t\t<label for="mWebEJSOptionsEditorAuthorAffiliationValue" class="sTranslatable form-label form-label-sm">Affiliation</label>\n          \t\t<input type="text" class="form-control form-control-sm" name="mWebEJSOptionsEditorAuthorAffiliationValue" id="mWebEJSOptionsEditorAuthorAffiliationValue"\n            \t\tplaceholder="Enter your affiliation here" >\n        \t\t</div>\n\t\t\t \t\t\t<div class="mt-2">\n          \t\t<label for="mWebEJSOptionsEditorAuthorContactValue" class="sTranslatable form-label form-label-sm">Contact</label>\n\t\t\t\t\t\t  <textarea class="form-control" id="mWebEJSOptionsEditorAuthorContactValue" rows="5"></textarea>\n        \t\t</div>\n\t\t\t \t\t\t   \n\t\t\t \t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- end tab content --\x3e\n\t\t\t\t\t\n\t\t\t</div>\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" id="mWebEJSOptionsEditorCancelButton" class="sTranslatable btn btn-secondary me-auto" data-dismiss="modal">Done</button>\n        <button type="button" id="mWebEJSOptionsEditorImportButton"     class="sTranslatable btn btn-primary me-auto">Import</button>\n\t\t\t\t<input class="d-none" accept="application/json"  type="file"  name="mWebEJSOptionsEditorField" id="mWebEJSOptionsEditorField" >\n        <button type="button" id="mWebEJSOptionsEditorExportButton"     class="sTranslatable btn btn-primary float-left">Export</button>\n      </div>\n\t    \x3c!------------------  end modal footer ---------------\x3e\n\t\t\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\n\t\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var n=new bootstrap.Modal(document.getElementById("sMainWebEJSOptionsModal"));function a(){$("#mWebEJSOptionsEditorShorterLabels").is(":checked")?($("#sModelVariables-tab .sModelTabLabel").text("Vars"),$("#sModelInitialization-tab .sModelTabLabel").text("Init"),$("#sModelEvolution-tab .sModelTabLabel").text("Evol"),$("#sModelFixedRelations-tab .sModelTabLabel").text("FixRel"),$("#sModelCustom-tab .sModelTabLabel").text("Cstm"),$("#sModelElements-tab .sModelTabLabel").text("Elms")):($("#sModelVariables-tab .sModelTabLabel").text("Variables"),$("#sModelInitialization-tab .sModelTabLabel").text("Initialization"),$("#sModelEvolution-tab .sModelTabLabel").text("Evolution"),$("#sModelFixedRelations-tab .sModelTabLabel").text("Fixed Relations"),$("#sModelCustom-tab .sModelTabLabel").text("Custom"),$("#sModelElements-tab .sModelTabLabel").text("Elements")),sMainResources.updateTranslation(["#sModelVariables-tab","#sModelInitialization-tab","#sModelEvolution-tab","#sModelFixedRelations-tab","#sModelCustom-tab","#sModelElements-tab"])}function o(){switch($("input[name=mWebEJSOptionsEditorShowPreviewSize]:checked").val()){case"small":$("#sPreviewPanel").css("min-width","25vw");break;case"large":$("#sPreviewPanel").css("min-width","75vw");break;default:$("#sPreviewPanel").css("min-width","50vw")}}function i(){switch($("input[name=mWebEJSOptionsEditorShowOutputSize]:checked").val()){case"small":$("#sOutputPanel").css("min-height","25vh");break;case"large":$("#sOutputPanel").css("min-height","75vh");break;default:$("#sOutputPanel").css("min-height","50vh")}}function s(t){n.hide(),sMainGUI.errorLine(sMainResources.getString(t)),sMessageForm.showWarning("Read error","Error: Invalid WebEJS options file","Check out the output area.",(()=>{n.show()}))}return $("#mWebEJSOptionsEditorLogo").attr("src",sMainEjsLogo),$("#mWebEJSOptionsEditorCancelButton").click((function(){n.hide()})),t.show=function(){n.show()},$("#mWebEJSOptionsEditorLanguage").on("change",(function(t){sMainResources.setLocale(this.value)})),$("#mWebEJSOptionsEditorShorterLabels").on("change",a),$("#mWebEJSOptionsEditorShowPreviewSize").on("change",o),$("#mWebEJSOptionsEditorShowOutputSize").on("change",i),$("#mWebEJSOptionsEditorAuthorIconField").change((function(t){$("#mWebEJSOptionsEditorAuthorIconImage").attr("src",URL.createObjectURL(t.target.files[0]))})),t.getAuthorInfo=function(){return info={},info.name=$("#mWebEJSOptionsEditorAuthorNameValue").val(),info.affiliation=$("#mWebEJSOptionsEditorAuthorAffiliationValue").val(),info.contact=$("#mWebEJSOptionsEditorAuthorContactValue").val(),info.logo=WebEJS_TOOLS.getBase64("mWebEJSOptionsEditorAuthorIconImage"),info},$("#mWebEJSOptionsEditorImportButton").on("click",(t=>{$("#mWebEJSOptionsEditorField").click()})),$("#mWebEJSOptionsEditorField").change((function(t){const e=t.target.files[0];if(e&&"application/json"===e.type){const t=new FileReader;t.onload=function(t){try{const e=JSON.parse(t.target.result);"__CONTENT__"in e&&"WEB_EJS_OPTIONS"==e.__CONTENT__?function(t){t=function(t){return"use_short_labels"in t||(t.use_short_labels="false"),"language"in t||(t.language="en"),"preview_size"in t||(t.preview_size="medium"),"output_size"in t||(t.output_size="small"),"author_name"in t||(t.author_name=""),"author_affiliation"in t||(t.author_affiliation=""),"author_contact"in t||(t.author_contact=""),"author_logo"in t||(t.author_logo=""),t}(t),$("#mWebEJSOptionsEditorShorterLabels").prop("checked","true"==t.use_short_labels),a(),$("#mWebEJSOptionsEditorShowPreviewSize input[value="+t.preview_size).prop("checked",!0),o(),$("#mWebEJSOptionsEditorShowOutputSize input[value="+t.output_size).prop("checked",!0),i(),$("#mWebEJSOptionsEditorAuthorNameValue").val(t.author_name),$("#mWebEJSOptionsEditorAuthorAffiliationValue").val(t.author_affiliation),$("#mWebEJSOptionsEditorAuthorContactValue").val(t.author_contact),$("#mWebEJSOptionsEditorAuthorIconImage").attr("src",t.author_logo),sMainGUI.getView().readUserCustomElements(t.user_elements)}(e):s("The selected file is not a WebEJS options file")}catch(t){console.log(t),s("The selected file is not a WebEJS options file")}},t.readAsText(e)}else s("The selected file is not a JSON file");$("#mWebEJSOptionsEditorField").val("")})),$("#mWebEJSOptionsEditorExportButton").on("click",(t=>{n.hide(),sMainFilenameForm.show("WebEJS_options.json",(function(t){n.show();var a=t.trim();if(a.length<=0)return;a=e.sanitizeFilename(t);const o=function(t){return null==t&&(t={}),t.use_short_labels=$("#mWebEJSOptionsEditorShorterLabels").is(":checked")?"true":"false",t.language="en",t.preview_size=$("input[name=mWebEJSOptionsEditorShowPreviewSize]:checked").val(),t.output_size=$("input[name=mWebEJSOptionsEditorShowOutputSize]:checked").val(),t.author_name=$("#mWebEJSOptionsEditorAuthorNameValue").val(),t.author_affiliation=$("#mWebEJSOptionsEditorAuthorAffiliationValue").val(),t.author_contact=$("#mWebEJSOptionsEditorAuthorContactValue").val(),t.author_logo=WebEJS_TOOLS.getBase64("mWebEJSOptionsEditorAuthorIconImage"),t.user_elements=sMainGUI.getView().getUserCustomElements(),t}({__CONTENT__:"WEB_EJS_OPTIONS"}),i=JSON.stringify(o,null,2),s=new Blob([i],{type:"text/plain"});var l=document.createElement("a");l.download=a,l.href=(window.webkitURL||window.URL).createObjectURL(s),l.dataset.downloadurl=["text/plain",l.download,l.href].join(":"),l.click()}))})),t};const sDescriptionIFrameOnLoad=function(t){var e=$("#mDescriptionExternalPageFrame_"+t).contents().find("head");var n='<link href="'+(sMainAssetsURL+sMainGUI.getSystemInformation("ejs_library_folder")+"css/ejss.css")+'" rel="stylesheet" type="text/css" />';e.append(n),sMainSimulationOptions.updateDetectedFiles()};(WebEJS_GUI=WebEJS_GUI||{}).descriptionWorkpanel=function(t){const e=WebEJS_TOOLS.tabbedPanel();var n={},a={};function o(t,e,n){e.find("img").each((function(){var e=$(this).attr("src");e.indexOf("//")<0&&(e.startsWith(n)||(e=n+e),t.push(e))}))}n.getMainPanelSelector=function(){return t},n.getKeyword=function(){return"Description"},n.getPageName=function(){return"Desc Page"},n.getDefaultPageType=function(){return"DESCRIPTION_EDITOR"},n.isPageSecondType=function(t){return t.find(".mDescriptionExternalHTMLFileField").length>0},n.getSecondType=function(){return"DESCRIPTION_VIEWER"},n.getSecondTypeLabel=function(){return"Create a new HTML display page"},n.reportableChange=function(t){sMainGUI.setChanged()},n.readObject=function(a){if("description"in a&&"pages"in a.description){const o=a.description.pages;if(null==o||o.length<=0)n.setNoPages();else{const a=function(t,e){for(var n=[],a=!1,o=0;o<t.length;o++){const i=t[o];i.Locale!=e?(sMainGUI.println(sMainResources.getString("WARNING: Ignoring locale file ("+i.Locale+") description for page: "+i.Name)),a=!0):n.push(i)}return a&&sMainGUI.addReadingWarnings(["The description of this simulation has non-default locale pages.","RED:Locales (translations) are ignored and lost when you save!"]),n}(o,"_default_");$(t).html(e.panelHTML(n,a)),e.initPanel(n,a)}}else n.setNoPages();return!0},n.saveObject=function(){return{pages:e.getAllPagesObject(n)}},n.getDetectedFiles=function(){return e.getAllPagesDetectedFiles(n)},n.setNoPages=function(){$(t).html('<div class="h-100 col-12 mx-auto btn-group-vertical" style="flex-grow:1;"><button class="sDescriptionBtn sPanelNoPageBtn rounded-0 col-12 h-50 active" data-type="'+n.getDefaultPageType()+'" ><h5 class="sTranslatable">Click to create a description page</h5></button><button class="sDescriptionBtn sPanelNoPageBtn rounded-0 col-12 h-50 active" data-type="'+n.getSecondType()+'" ><h5 class="sTranslatable">Click to create an HTML display page</h5></button></div>'),e.initPanel(n,null)},n.pageMainBuilder=function(t,e,n){return"DESCRIPTION_VIEWER"==n||e&&"true"==e.External?function(t,e){var n="",a="";e&&e.Code&&(n=(a=e.Code.trim()).startsWith("./")?sMainGUI.getURLpathFor(a.substring(2)):a);return'<div id="mDescriptionExternalPage_'+t+'" class="d-flex flex-column" style="flex-grow:1"><div class="sCommentPanel" style="flex-basis:0;flex-grow: 0"><div class="h-100 input-group input-group-sm"><span class="sTranslatable input-group-text">Title</span><input type="text" class="sPageCommentField form-control" id="mDescriptionEditorTitle_'+t+'"'+(e&&e.Title?' value="'+e.Title+'"':"")+'></div></div><div class="d-flex flex-column col-12 " style="flex-grow:1"><iframe id="mDescriptionExternalPageFrame_'+t+'" class="mDescriptionIFrame py-0" title="Description page" onload="sDescriptionIFrameOnLoad('+t+')" style="flex-grow:1; overflow: auto;" '+(n.length>0?' src="'+n+'"':"")+'></iframe></div><div class="mFileChooserPanel d-flex flex-row" style="flex-basis:0;flex-grow: 0"><div class="input-group input-group-sm" style="flex-grow: 1;"><span class="sTranslatable input-group-text">HTML File</span><input type="text" class="mDescriptionExternalHTMLFileField form-control" id="mDescriptionExternalHTMLFileField_'+t+'" placeholder="&lt;Type or click the button to the right to select HTML file&gt;" aria-label="Filepath"'+(a.length>0?' value="'+a+'"':"")+'><span class="input-group-text"><i class=" bi bi-file-richtext cFileChooser"  data-field="#mDescriptionExternalHTMLFileField_'+t+'"  style="font-size: 1rem;"></i></span></div></div></div>'}(t,e):'<div class="sCommentPanel" style="flex-basis:0;flex-grow: 0"><div class="h-100 input-group input-group-sm"><span class="sTranslatable sDescriptionBtn input-group-text">Title</span><input type="text" class="sPageCommentField form-control" id="mDescriptionEditorTitle_'+t+'"'+(e&&e.Title?' value="'+e.Title+'"':"")+'></div></div><div id = "mDescriptionInternalPage_'+t+'" class="d-flex flex-column" style="flex-grow:1" ><textarea id="mDescriptionEditorArea_'+t+'" class="suneditor" style="flex-grow:1"></textarea></div>'},n.showUserFileError=function(t){var e="<p>"+sMainResources.getString("The selected file is not included in your simulation list of <i>User files</i>:")+'</p><p class="text-danger">'+t+"</p><p>"+sMainResources.getString("Please, add it before using it.","User file error")+"</p>";sMessageForm.showHTML("User File Error",e)},n.pageInitialization=function(t,o){const s=e.getPageDivHash(t);var l=o?o.Title:e.getPageDivName(n,t);if($("#mDescriptionEditorTitle_"+s).val(l),n.isPageSecondType(t))t.find(".cFileChooser").on("click",(a=>{e.isPageDisabled(n,t)||WebEJS_TOOLS.selectFile(WebEJS_TOOLS.HTML_FORMATS,(function(t,e){$("#mDescriptionExternalHTMLFileField_"+s).val(t),$("#mDescriptionExternalPageFrame_"+s).attr("src",e)}),!0,null)}));else{var r=o?o.Code:"<h1>"+e.getPageDivName(n,t)+"</h1>";a[s]=SUNEDITOR.create(document.getElementById("mDescriptionEditorArea_"+s),{width:"100%",height:250,buttonList:[["undo","redo"],["bold","underline","italic",":t-More Text-default.more_text","strike","subscript","superscript"],["formatBlock","list","fontColor","horizontalRule",":p-More Paragraph-default.more_paragraph","font","fontSize","hiliteColor","textStyle","align","lineHeight","paragraphStyle","blockquote"],["removeFormat"],["outdent","indent"],["link","image",":r-More Rich-default.more_plus","table","video","audio"],["codeView",":v-View-text.View","fullScreen","showBlocks","preview"]]}),a[s].setContents(i(r,1))}},n.disablePage=function(t,o){const i=e.getDivPageByHash(n,t);n.isPageSecondType(i)||(o?a[t].disable():a[t].enable())},n.pageDeleted=function(t){const o=e.getPageDivHash(t);n.isPageSecondType(t)||(a[o]=null)},n.getPageObject=function(t){var o=e.getPageObject(n,t);const s=n.isPageSecondType(e.getDivPageByHash(n,t));var l;return o.Locale="_default_",o.Title=$("#mDescriptionEditorTitle_"+t).val(),o.External=s?"true":"false",o.Code=s?$("#mDescriptionExternalHTMLFileField_"+t).val():(l=a[t].getContents(),"<html>\n<head></head>\n<body>\n"+i(l,0)+"\n</body>\n</html>"),o},n.getPageDetectedFiles=function(t){var i=[];if(n.isPageSecondType(e.getDivPageByHash(n,t))){const e=$("#mDescriptionExternalHTMLFileField_"+t).val().trim();if(e.length>0){i.push(e);const n=e.split("\\").pop().split("/").pop(),a=e.substring(0,e.length-n.length);o(i,$("#mDescriptionExternalPageFrame_"+t).contents(),a)}}else o(i,$(a[t].getContents()),"./");return i};function i(t,e){const n=window.location.origin+sMainGUI.getURLpathFor(""),a=n.length;for(var o=t.toLowerCase(),i="",s=o.indexOf("<img");s>=0;){var l=!0,r=o.indexOf("/>",s);if(r<0&&(l=!1,r=o.indexOf(">",s)),r<0)break;var c=o.substring(s,r),d=c.indexOf('src="')+5,u=s+c.indexOf('"',d);d=s+d;var p=t.substring(d,u);if(0===e)p.startsWith(n)&&(p="./"+p.substring(a));else p.indexOf(":")<0&&(p.startsWith("./")&&(p=p.substring(2)),p=n+p);i+=t.substring(0,d)+p,i+=t.substring(u,r),l||(i+="/"),o=o.substring(r),t=t.substring(r),s=o.indexOf("<img")}return i+=t}return n},(WebEJS_GUI=WebEJS_GUI||{}).modelWorkpanel=function(){var t={},e=WebEJS_GUI.variablesPanel("#sModelVariablesPanel"),n=WebEJS_GUI.codePanel("initialization","#sModelInitializationPanel"),a=WebEJS_GUI.evolutionPanel("#sModelEvolutionMain"),o=WebEJS_GUI.codePanel("fixed_relations","#sModelFixedRelationsPanel"),i=WebEJS_GUI.codePanel("custom","#sModelCustomPanel"),s=WebEJS_GUI.elementsPanel("#sModelElementsPanel");function l(t){$(".sModelContentDiv").each((function(){$(this).index()==t?$(this).removeClass("d-none"):$(this).addClass("d-none")})),$(".sModelTabButton").each((function(){$(this).closest("li").index()==t?$(this).removeClass("bi-circle").addClass("bi-record-circle"):$(this).removeClass("bi-record-circle").addClass("bi-circle")}))}return t.getVariables=function(){return e},t.getCustomCode=function(){return i},t.getElementsPanel=function(){return s},t.saveObject=function(){var t={};return t.variables=e.saveObject(),t.initialization=n.saveObject(),t.evolution=a.saveObject(),t.fixed_relations=o.saveObject(),t.custom=i.saveObject(),t.elements=s.saveObject(),t},t.readObject=function(t){var l;l="model"in t?t.model:{variables:{},initialization:{},evolution:{},fixed_relations:{},custom:{},elements:{}};var r=!0;return r&=e.readObject(l.variables),r&=n.readObject(l.initialization),r&=a.readObject(l.evolution),r&=o.readObject(l.fixed_relations),r&=i.readObject(l.custom),r&=s.readObject(l.elements)},t.getDetectedFiles=function(){return[]},$(".sModelTabButton").click((t=>{l($(t.target).closest("li").index())})),l(0),t},WebEJS_GUI.odeEventsPanel=function(t,e,n){const a=WebEJS_TOOLS.tabbedPanel(),o=a.getPageDivHash(e),i=a.getPageDivName(t,e),s="ODEEventsEditor_"+o,l="m"+s,r="#"+l+"-Panel";var c={},d="",u={pages:[]},p={Code:"",Comment:"",StopAfterEffect:"true"};n&&(d=n.EventMaximumStep,"Events"in n&&"object"==typeof n.Events&&"pages"in n.Events&&(u=n.Events),"ZenoEffect"in n&&"object"==typeof n.ZenoEffect&&"Code"in n.ZenoEffect&&(p=n.ZenoEffect),t.showNumberOfEvents(u.pages.length,e));var m=null,g=null,h={},f={},b=null;function v(){d=$("#"+l+"-ZenoSteps").val(),u={pages:a.getAllPagesObject(c)}}function E(){p={Code:b.getValue(),Comment:$("#"+l+"-ZenoComment").val(),StopAfterEffect:$("#"+l+"-ZenoStopCheckbox").is(":checked")?"true":"false"}}c.getMainPanelSelector=function(){return r},c.getKeyword=function(){return s},c.getPageName=function(){return"Event"},c.getDefaultPageType=function(){return"EVENT_EDITOR"},c.pageDeleted=function(n){const o=a.getPageDivHash(n);delete h[o],delete f[o],t.showNumberOfEvents(a.getPagesCount(c)-1,e)},c.reportableChange=function(e){t.reportableChange(e)},c.getContent=function(t){m&&v(),g&&E(),t.EventMaximumStep=d,t.Events=u,t.ZenoEffect=p};const _={width:Math.min(.9*window.innerWidth,1e3),height:Math.min(.9*window.innerHeight,800)},S={width:Math.min(.7*window.innerWidth,800),height:Math.min(.7*window.innerHeight,600)};return c.show=function(){m?(m.resize(_),m.reposition(),m.front()):function(){const e={content:'<div id="'+l+'-Panel" class="sModelSubpanel h-100 col-12 d-flex flex-column" style="flex-grow:1"></div>',onbeforeclose:function(t){return g&&g.close(),v(),m=null,!0},position:{at:"center",of:"#sMainWorkpanel"},footerToolbar:'<div class="h-100 d-flex flex-row" style="flex-grow:1"><div class="input-group input-group-sm" style="flex-grow:1;"><button type="button" id="'+l+'-ZenoButton"  class="sTranslatable sModelBtn btn btn-outline-secondary">'+sLocaleFor("Zeno effect action")+'</button><span id="'+l+'-ZenoLabel" class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Check events at steps not larger than")+'</span><input type="text" class="ms-1 form-control" id="'+l+'-ZenoSteps"'+sMainNoAutocorrect+' aria-describedby="'+l+'-ZenoLabel"  style="width:4em;" aria-label="'+sLocaleFor("Zeno step")+'"><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+l+'-ZenoSteps"  style="font-size: 1rem;"></i></span></div><button type="button" id="'+l+'-Button" style="flex-grow:0; flex-basis:0;" class="sTranslatable ms-1 input-group-button btn btn-primary float-left">Done</button></div>',callback:function(e){$("#"+l+"-Button").click((function(){e.close()})),$("#"+l+"-ZenoButton").click((function(){g?(g.resize(S),g.reposition(),g.front()):function(){const e={content:'<div class="h-100 col-12 d-flex flex-column" style="flex-grow:1"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col"><span class="sTranslatable sModelBtn input-group-text btn text-decoration-none">'+sLocaleFor("Action")+'</span></div><div class="col input-group"><span class="form-check"><input class="form-check-input" type="checkbox" value="" checked  name="'+l+'-ZenoStopCheckbox" id="'+l+'-ZenoStopCheckbox"><label class="sTranslatable form-check-label" for="'+l+'-ZenoStopCheckbox">'+sLocaleFor("End step after effect")+'</label></span></div></div></div><div class="ace h-100" id="'+l+'-ZenoEditor" style="flex-grow:1"></div></div>',onbeforeclose:function(t){return E(),g=null,!0},position:{at:"center",of:"#sMainWorkpanel"},footerToolbar:'<div class="h-100 d-flex flex-row" style="flex-grow:1"><div class="input-group input-group-sm" style="flex-grow:1;"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Comment")+'</span><input type="text" class="flex flex-grow form-control" id="'+l+'-ZenoComment" placeholder="'+sLocaleFor("Page comment")+'" aria-label="'+sLocaleFor("Page comment")+'"></div><button type="button" id="'+l+'-ZenoCloseButton" style="flex-grow:0; flex-basis:0;" class="sTranslatable ms-1 input-group-button btn btn-primary float-left">Done</button></div>',callback:function(e){$("#"+l+"-ZenoCloseButton").click((function(){g.close()})),b=a.initializeCodeEditor(l+"-ZenoEditor",p.Code,(()=>{t.reportableChange("Zeno Action")}),(()=>{t.nonReportableChange("Zeno Action")})),$("#"+l+"-ZenoStopCheckbox").prop("checked","true"==p.StopAfterEffect),$("#"+l+"-ZenoComment").val(p.Comment),$("#"+l+"-ZenoStopCheckbox").on("change",(()=>{t.reportableChange("Zeno stop")})),$("#"+l+"-ZenoComment").on("change",(()=>{t.reportableChange("Zeno Comment")}))}},n=sMainResources.getString("Zeno effect action for ODE")+" : "+i;g=WebEJS_TOOLS.createJSPanel(n,e,{minimize:"remove"},S)}()})),$("#"+l+"-ZenoSteps").change((function(){t.reportableChange("ODE ZenoSteps")})),$(e).find(".cVariableChooser").on("click",(e=>{t.selectVariable(e,i)})),function(){var t=u.pages;null==t||t.length<=0?c.setNoPages():($(r).html(a.panelHTML(c,t)),a.initPanel(c,t))}()}},n=sMainResources.getString("Events for ODE")+" : "+i;m=WebEJS_TOOLS.createJSPanel(n,e,{minimize:"remove"},_),$("#"+l+"-ZenoSteps").val(d)}()},c.hide=function(){m&&m.close()},c.setNoPages=function(){$(r).html('<button class="sModelBtn sPanelNoPageBtn active" style="flex-grow:1;"><h5 class="sTranslatable">'+sLocaleFor("Click to create a page of")+" "+sLocaleFor("Events")+"</h5></button>"),a.initPanel(c,null)},c.pageInitialization=function(n,o){const i=a.getPageDivHash(n),s=a.getPageDivName(c,n);var r=o?o.ZeroCondition:"return 1.0; // Condition for "+s,d=o?o.Action:"// Action for "+s;h[i]=a.initializeCodeEditor(l+"-ZeroEditor-"+i,r,(()=>{t.reportableChange("Event Zero Condition")}),(()=>{t.nonReportableChange("Event Zero Condition")})),f[i]=a.initializeCodeEditor(l+"-ActionEditor-"+i,d,(()=>{t.reportableChange("Event Action")}),(()=>{t.nonReportableChange("Event Action")})),n.find("input").on("change",(e=>{t.reportableChange("ODE Event change "+e.target.id)})),n.find("select").on("change",(e=>{t.reportableChange("ODE Event change "+e.target.id)})),o&&($("#"+l+"-TypeSelector-"+i+' option[value="'+o.EventType+'"]').attr("selected",!0),$("#"+l+"-IterationsField-"+i).val(o.Iterations),$("#"+l+"-MethodSelector-"+i+' option[value="'+o.Method+'"]').attr("selected",!0),$("#"+l+"-TolField-"+i).val(o.Tolerance),$("#"+l+"-EndCheckbox-"+i).prop("checked","true"==o.StopAtEvent),$("#"+l+"-Comment-"+i).val(o.Comment)),n.find(".cVariableChooser").on("click",(e=>{a.isPageDisabled(c,n)||t.selectVariable(e,a.getPageDivName(c,n))})),t.showNumberOfEvents(a.getPagesCount(c),e)},c.getPageObject=function(t){var e=a.getPageObject(c,t);return e.Action=f[t].getValue(),e.Comment=$("#"+l+"-Comment-"+t).val(),e.EventType=$("#"+l+"-TypeSelector-"+t+" option:selected").val(),e.Iterations=$("#"+l+"-IterationsField-"+t).val(),e.Method=$("#"+l+"-MethodSelector-"+t+" option:selected").val(),e.StopAtEvent=$("#"+l+"-EndCheckbox-"+t).is(":checked")?"true":"false",e.Tolerance=$("#"+l+"-TolField-"+t).val(),e.ZeroCondition=h[t].getValue(),e},c.pageMainBuilder=function(t,e){return'<div class="h-100 d-flex flex-column" style="flex-grow:1"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Type")+'</span><select id="'+l+"-TypeSelector-"+t+'" class="form-select" ><option value="STATE_EVENT">State event</option><option value="CROSSING_EVENT" selected>Zero crossing</option><option value="POSITIVE_EVENT">Positive crossing</option></select></div><div class="col input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Iterations")+'</span><input id="'+l+"-IterationsField-"+t+'" type="text" class="form-control" '+sMainNoAutocorrect+'style="width:4em;" value="100"><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+l+"-IterationsField-"+t+'"  style="font-size: 1rem;"></i></span></div><div class="col input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Method")+'</span><select id="'+l+"-MethodSelector-"+t+'" class="form-select"><option value="BISECTION" selected>BISECTION</option><option value="SECANT">SECANT</option></select></div></div></div><div class="container" style="flex-grow:1;"><div class="row d-flex flex-column" style="height:50%;"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col"><span id="'+l+"-ZeroLabel-"+t+'" class="sTranslatable sModelBtn input-group-text btn text-decoration-none" >'+sLocaleFor("Zero condition")+'</span></div><div class="col input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Tol")+'</span><input id="'+l+"-TolField-"+t+'" type="text" class="form-control" '+sMainNoAutocorrect+'style="width:8em;" value="1.0e-5" ><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+l+"-TolField-"+t+'"  style="font-size: 1rem;"></i></span></div></div></div><div class="ace" id="'+l+"-ZeroEditor-"+t+'" style="flex-grow:1"></div></div><div class="row d-flex flex-column" style="height:50%;"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col"><span class="sTranslatable sModelBtn input-group-text btn text-decoration-none">'+sLocaleFor("Action")+'</span></div><div class="col input-group"><span class="form-check"><input class="form-check-input" type="checkbox" value="" checked  name="'+l+"-EndCheckbox-"+t+'" id="'+l+"-EndCheckbox-"+t+'"><label class="sTranslatable form-check-label" for="'+l+'-EndCheckbox">'+sLocaleFor("End step at event")+'</label></span></div></div></div><div class="ace" id="'+l+"-ActionEditor-"+t+'" style="flex-grow:1"></div></div></div></div>'},c.pageCommentBuilder=function(t,e){return'<div class="input-group input-group-sm dropup drop-start" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="'+l+"-Comment-"+t+'" placeholder="Page comment" aria-label="Page comment"></div>'},c},WebEJS_GUI.odeParametersPanel=function(t,e,n){const a=WebEJS_TOOLS.tabbedPanel(),o=a.getPageDivHash(e),i=a.getPageDivName(t,e),s="m"+("ODEParametersEditor_"+o),l=s+"-DiscontinuitiesDiv",r=s+"-ErrorHandlingDiv";var c={},d="false",u="false",p="false",m="false",g="",h="",f="",b="10000",v="",E="",_="",S="",y="",T={Comment:"",Code:""},C="",O={pages:[]},x={pages:[]};if(n){d=n.AccelerationIndependentOfVelocity,u=n.ForceSynchronization,p=n.UseBestInterpolation,m=n.EstimateFirstStep,g=n.MemoryLength,h=n.InternalStep,f=n.MaximumStep,b=n.MaximumNumberOfSteps,v=n.RelativeTolerance,E=n.Tolerance,_=n.DelayList,S=n.DelayMaximum,y=n.DelayAddDiscont,T=n.DelayInitialCondition,C=n.DirectIncidenceMatrix;const t=n.Discontinuities;t&&"pages"in t&&(O=t);const e=n.ErrorHandling;e&&"pages"in e&&(x=e)}var P=null,w=WebEJS_GUI.odeDiscontinuityEditor(t,l),M=WebEJS_GUI.odeErrorHandlingEditor(t,r),I=null;function L(){d=$("#"+s+"-AccInd").is(":checked")?"true":"false",u=$("#"+s+"-ForceSynchro").is(":checked")?"true":"false",p=$("#"+s+"-BestInter").is(":checked")?"true":"false",m=$("#"+s+"-EstimateFirst").is(":checked")?"true":"false",g=$("#"+s+"-MemoryLength").val(),h=$("#"+s+"-InternalStep").val(),f=$("#"+s+"-MaximumStep").val(),b=$("#"+s+"-MaxNumSteps").val(),v=$("#"+s+"-RelTol").val(),_=$("#"+s+"-Delays").val(),S=$("#"+s+"-MaximumDelay").val(),y=$("#"+s+"-DelayAddDisc").val(),T={Code:I.getValue(),Comment:$("#"+s+"-DelayComment").val()},O={pages:a.getAllPagesObject(w)},x={pages:a.getAllPagesObject(M)}}c.getContent=function(t){P&&L(),t.AccelerationIndependentOfVelocity=d,t.ForceSynchronization=u,t.UseBestInterpolation=p,t.EstimateFirstStep=m,t.MemoryLength=g,t.InternalStep=h,t.MaximumStep=f,t.MaximumNumberOfSteps=b,t.RelativeTolerance=v,t.Tolerance=E,t.DelayList=_,t.DelayMaximum=S,t.DelayAddDiscont=y,t.DelayInitialCondition=T,t.DirectIncidenceMatrix=C,t.Discontinuities=O,t.ErrorHandling=x};const R={width:Math.min(.7*window.innerWidth,800),height:Math.min(.7*window.innerHeight,800)};function F(){return'<div class="sModelSubpanel h-100 col-12 d-flex flex-column"><ul class="nav nav-tabs nav-fill border" role="tablist" ><li class="nav-item" role="presentation"><button class="sTranslatable sModelBtn nav-link active" id="'+s+'-OperationTab" data-bs-toggle="tab" data-bs-target="#'+s+'-OperationDiv"  type="button" role="tab" aria-controls="'+s+'-OperationDiv" aria-selected="true">'+sLocaleFor("Operation")+'</button></li><li class="nav-item" role="presentation"><button class="sTranslatable sModelBtn nav-link" id="'+s+'-DiscontinuitiesTab" data-bs-toggle="tab" data-bs-target="#'+s+'-DiscontinuitiesDiv"  type="button" role="tab" aria-controls="'+s+'-DiscontinuitiesDiv" aria-selected="true">'+sLocaleFor("Discontinuities")+'</button></li><li class="nav-item" role="presentation"><button class="sTranslatable sModelBtn nav-link" id="'+s+'-DDETab" data-bs-toggle="tab" data-bs-target="#'+s+'-DDEDiv"  type="button" role="tab" aria-controls="'+s+'-DDEDiv" aria-selected="true">'+sLocaleFor("DDE")+'</button></li><li class="nav-item" role="presentation"><button class="sTranslatable sModelBtn nav-link" id="'+s+'-ErrorHandlingTab" data-bs-toggle="tab" data-bs-target="#'+s+'-ErrorHandlingDiv"  type="button" role="tab" aria-controls="'+s+'-ErrorHandlingDiv" aria-selected="true">'+sLocaleFor("ErrorHandling")+'</button></li></ul><div class="tab-content h-100 col-12 d-flex flex-column" style="flex-grow:1"><div class="sModelSubpanel tab-pane show active" id="'+s+'-OperationDiv" style="flex-grow:1" role="tabpanel" aria-labelledby="'+s+'-OperationTab"><div class="mt-2 form-check form-switch"><input class="form-check-input" type="checkbox" id="'+s+'-AccInd"><label class="sTranslatable sModelBtn form-check-label" for="'+s+'-AccInd">'+sLocaleFor("Acc Indep of Velocity")+'</label></div><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="'+s+'-ForceSynchro"><label class="sTranslatable sModelBtn form-check-label" for="'+s+'-ForceSynchro">'+sLocaleFor("Force synchronization")+'</label></div><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="'+s+'-BestInter"><label class="sTranslatable sModelBtn form-check-label" for="'+s+'-BestInter">'+sLocaleFor("Use best interpolation")+'</label></div><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="'+s+'-EstimateFirst"><label class="sTranslatable sModelBtn form-check-label" for="'+s+'-EstimateFirst">'+sLocaleFor("Estimate first step")+'</label></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Memory length")+'</span><input id="'+s+'-MemoryLength" type="text" class="form-control" '+sMainNoAutocorrect+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+s+'-MemoryLength"  style="font-size: 1rem;"></i></span></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Internal step size")+'</span><input id="'+s+'-InternalStep" type="text" class="form-control"'+sMainNoAutocorrect+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+s+'-InternalStep"  style="font-size: 1rem;"></i></span></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Maximum step size")+'</span><input id="'+s+'-MaximumStep" type="text" class="form-control" '+sMainNoAutocorrect+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+s+'-MaximumStep"  style="font-size: 1rem;"></i></span></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Max number of steps")+'</span><input id="'+s+'-MaxNumSteps" type="text" class="form-control" '+sMainNoAutocorrect+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+s+'-MaxNumSteps"  style="font-size: 1rem;"></i></span></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Relative tolerance")+'</span><input id="'+s+'-RelTol" type="text" class="form-control" '+sMainNoAutocorrect+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+s+'-RelTol"  style="font-size: 1rem;"></i></span></div></div><div class="sModelSubpanel tab-pane fade" id="'+s+'-DiscontinuitiesDiv" style="flex-grow:1" role="tabpanel" aria-labelledby="'+s+'-DiscontinuitiesTab"></div><div class="sModelSubpanel tab-pane fade" id="'+s+'-DDEDiv" style="flex-grow:1" role="tabpanel" aria-labelledby="'+s+'-DDETab"><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Delays")+'</span><input id="'+s+'-Delays" type="text" class="form-control" '+sMainNoAutocorrect+'></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Maximum delay")+'</span><input id="'+s+'-MaximumDelay" type="text" class="form-control" '+sMainNoAutocorrect+'></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Pre-IC discontinuities")+'</span><input id="'+s+'-DelayAddDisc" type="text" class="form-control" '+sMainNoAutocorrect+'></div><label for="'+s+'-DelayPreInitCode" class="mt-2 sModelBtn form-label">'+sLocaleFor("Code for pre-initial conditions for")+" "+i+'</label><div class="ace" id="'+s+'-DelayPreInitCode" style="height: 150px;"></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Comment")+'</span><input id="'+s+'-DelayComment" type="text" class="form-control" ></div></div><div class="sModelSubpanel tab-pane fade" id="'+s+'-ErrorHandlingDiv" style="flex-grow:1" role="tabpanel" aria-labelledby="'+s+'-ErrorHandlingTab"></div></div></div>'}return c.show=function(){P?(P.resize(R),P.reposition(),P.front()):function(){const e={content:F(),onbeforeclose:function(t){return L(),P=null,!0},position:{at:"center",of:"#sMainWorkpanel"},footerToolbar:'<button type="button" id="'+s+'-CloseButton" class="sTranslatable btn btn-primary float-left">Done</button>',callback:function(e){$("#"+s+"-CloseButton").click((function(){e.close()})),I=a.initializeCodeEditor(s+"-DelayPreInitCode",T.Code,(()=>{t.reportableChange("Delay Pre Init Code Condition")}),(()=>{t.nonReportableChange("Delay Pre Init Code Condition")})),$(e).find("input").on("change",(e=>{t.reportableChange("ODE Parameter change "+e.target.id)})),$(e).find(".cVariableChooser").on("click",(e=>{t.selectVariable(e,i)})),function(){$("#"+s+"-AccInd").prop("checked","true"==d),$("#"+s+"-ForceSynchro").prop("checked","true"==u),$("#"+s+"-BestInter").prop("checked","true"==p),$("#"+s+"-EstimateFirst").prop("checked","true"==m),$("#"+s+"-MemoryLength").val(g),$("#"+s+"-InternalStep").val(h),$("#"+s+"-MaximumStep").val(f),$("#"+s+"-MaxNumSteps").val(b),$("#"+s+"-RelTol").val(v),$("#"+s+"-Delays").val(_),$("#"+s+"-MaximumDelay").val(S),$("#"+s+"-DelayAddDisc").val(y),$("#"+s+"-DelayPreInitCode").val(T.Code),$("#"+s+"-DelayComment").val(T.Comment);var t=O.pages;null==t||t.length<=0?w.setNoPages():($("#"+l).html(a.panelHTML(w,t)),a.initPanel(w,t));null==(t=x.pages)||t.length<=0?M.setNoPages():($("#"+r).html(a.panelHTML(M,t)),a.initPanel(M,t))}()}},n=sMainResources.getString("Parameters for ODE")+" : "+i;P=WebEJS_TOOLS.createJSPanel(n,e,{minimize:"remove"},R)}()},c.hide=function(){P&&P.close()},c},WebEJS_GUI.odeDiscontinuityEditor=function(t,e){const n=WebEJS_TOOLS.tabbedPanel(),a="#"+e;var o={},i={},s={};return o.getMainPanelSelector=function(){return a},o.getKeyword=function(){return"Discontinuity"},o.getPageName=function(){return"Discontinuity Page"},o.getDefaultPageType=function(){return"DISCONTINUITY_EDITOR"},o.pageDeleted=function(t){const e=n.getPageDivHash(t);delete i[e],delete s[e]},o.reportableChange=function(t){sMainGUI.setChanged()},o.setNoPages=function(){$(a).html('<button class="sModelBtn sPanelNoPageBtn h-100 col-12 active" style="flex-grow:1;"><h5 class="sTranslatable">'+sLocaleFor("Click to create a page of")+" "+sLocaleFor("Discontinuity")+"</h5></button>"),n.initPanel(o,null)},o.pageInitialization=function(a,l){const r=n.getPageDivHash(a),c=n.getPageDivName(o,a);var d=l?l.ZeroCondition:"return 1.0; // Condition for "+c,u=l?l.Action:"// Action for "+c;i[r]=n.initializeCodeEditor(e+"-ZeroEditor-"+r,d,(()=>{t.reportableChange("ODE Discontinuity Zero Condition")}),(()=>{t.nonReportableChange("ODE Discontinuity Zero Condition")})),s[r]=n.initializeCodeEditor(e+"-ActionEditor-"+r,u,(()=>{t.reportableChange("Disc Action")}),(()=>{t.nonReportableChange("Disc Action")})),a.find("input").on("change",(e=>{t.reportableChange("ODE Discontinuity change "+e.target.id)})),l&&($("#"+e+"-TolField-"+r).val(l.Tolerance),$("#"+e+"-EndCheckbox-"+r).prop("checked","true"==l.StopAtDiscontinuity),$("#"+e+"-Comment-"+r).val(l.Comment)),a.find(".cVariableChooser").on("click",(e=>{t.selectVariable(e,n.getPageDivName(o,a))}))},o.getPageObject=function(t){var a=n.getPageObject(o,t);return a.Action=s[t].getValue(),a.Comment=$("#"+e+"-Comment-"+t).val(),a.StopAtDiscontinuity=$("#"+e+"-EndCheckbox-"+t).is(":checked")?"true":"false",a.Tolerance=$("#"+e+"-TolField-"+t).val(),a.ZeroCondition=i[t].getValue(),a},o.pageMainBuilder=function(t,n){return'<div class="container h-100 d-flex flex-column" style="flex-grow:1"><div class="row d-flex flex-column" style="height:50%;"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col"><span id="'+e+'-ZeroLabel" class="sTranslatable sModelBtn input-group-text btn text-decoration-none" >'+sLocaleFor("Zero condition")+'</span></div><div class="col input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Tol")+'</span><input id="'+e+"-TolField-"+t+'" type="text" class="form-control" '+sMainNoAutocorrect+'style="width:8em;" value="1.0e-5" ><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+e+"-TolField-"+t+'"  style="font-size: 1rem;"></i></span></div></div></div><div class="ace mt-1" id="'+e+"-ZeroEditor-"+t+'" style="flex-grow:1; min-height:100px;"></div></div><div class="row d-flex flex-column" style="height:50%;"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col"><span class="sTranslatable sModelBtn input-group-text btn text-decoration-none">'+sLocaleFor("Action")+'</span></div><div class="col input-group"><span class="form-check"><input class="form-check-input" type="checkbox" value="" checked  name="'+e+"-EndCheckbox-"+t+'" id="'+e+'-EndCheckbox"><label class="sTranslatable form-check-label" for="'+e+'-EndCheckbox">'+sLocaleFor("End step at discontinuity")+'</label></span></div></div></div><div class="ace mt-1" id="'+e+"-ActionEditor-"+t+'" style="flex-grow:1; min-height:100px;"></div></div></div>'},o.pageCommentBuilder=function(t,n){return'<div class="input-group input-group-sm dropup drop-start" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="'+e+"-Comment-"+t+'" placeholder="Page comment" aria-label="Page comment"></div>'},o},WebEJS_GUI.odeErrorHandlingEditor=function(t,e){const n=WebEJS_TOOLS.tabbedPanel(),a="#"+e;var o={},i={};return o.getMainPanelSelector=function(){return a},o.getKeyword=function(){return"OnError"},o.getPageName=function(){return"On Error Page"},o.getDefaultPageType=function(){return"ERROR_EDITOR"},o.pageDeleted=function(t){const e=n.getPageDivHash(t);delete i[e]},o.reportableChange=function(t){sMainGUI.setChanged()},o.setNoPages=function(){$(a).html('<button class="sModelBtn sPanelNoPageBtn h-100 col-12 active" style="flex-grow:1;"><h5 class="sTranslatable">'+sLocaleFor("Click to create a page of")+" "+sLocaleFor("Error Handling")+"</h5></button>"),n.initPanel(o,null)},o.pageInitialization=function(a,s){const l=n.getPageDivHash(a),r=n.getPageDivName(o,a);var c=s?s.Code:"// Error handling for "+r;i[l]=n.initializeCodeEditor(e+"-Editor-"+l,c,(()=>{t.reportableChange("ODE Error handling")}),(()=>{t.nonReportableChange("ODE Error handling")})),a.find("input").on("change",(e=>{t.reportableChange("ODE Error handling change "+e.target.id)})),a.find("select").on("change",(e=>{t.reportableChange("ODE Error handling change "+e.target.id)})),s&&($("#"+e+"-TypeSelector-"+l+' option[value="'+s.ErrorType+'"]').attr("selected",!0),$("#"+e+"-Comment-"+l).val(s.Comment))},o.getPageObject=function(t){var a=n.getPageObject(o,t);return a.Code=i[t].getValue(),a.ErrorType=$("#"+e+"-TypeSelector-"+t+" option:selected").val(),a.Comment=$("#"+e+"-Comment-"+t).val(),a},o.pageMainBuilder=function(t,n){return'<div class=" h-100 d-flex flex-column" style="flex-grow:1"><div class="input-group" style="flex-grow:0; flex-basis:0;"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Error Type")+'</span><select id="'+e+"-TypeSelector-"+t+'" class="form-select" ><option value="ANY_ERROR">ANY ERROR </option><option value="INTERNAL_SOLVER_ERROR" selected>INTERNAL SOLVER ERROR</option><option value="EVENT_NOT_FOUND">EVENT NOT FOUND</option><option value="ILLEGAL_EVENT_STATE">ILLEGAL EVENT STATE</option><option value="TOO_MANY_STEPS">TOO MANY STEPS</option><option value="DID_NOT_CONVERGE">DID NOT CONVERGE</option></select></div><div class="ace mt-1" id="'+e+"-Editor-"+t+'" style="flex-grow:1; min-height:200px;"></div></div>'},o.pageCommentBuilder=function(t,n){return'<div class="input-group input-group-sm dropup drop-start" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="'+e+"-Comment-"+t+'" placeholder="Page comment" aria-label="Page comment"></div>'},o},WebEJS_GUI.odePreliminaryCodePanel=function(t,e,n){const a=WebEJS_TOOLS.tabbedPanel(),o=a.getPageDivHash(e),i=a.getPageDivName(t,e),s=sMainResources.getString("Preliminary code for ODE")+" : "+i,l="mODEPreliminaryCodeEditor_"+o;var r={},c=n?{Code:n.PreliminaryCode.Code,Comment:n.PreliminaryCode.Comment}:{Code:"// "+s,Comment:""},d=null,u=null;function p(){d&&(c={Code:u.getValue(),Comment:$("#"+l+"-Comment").val()})}r.getContent=function(){return p(),c};const m={width:Math.min(.9*window.innerWidth,1200),height:Math.min(.9*window.innerHeight,1200)};return r.show=function(){if(!d)return function(){const e={content:'<div id="'+l+'-ace" class="ace h-100" style="flex-grow:1"></div>',onbeforeclose:function(t){return p(),d=null,!0},position:{at:"center",of:"#sMainWorkpanel"},footerToolbar:'<div class="h-100 d-flex flex-row" style="flex-grow:1"><div class="input-group input-group-sm" style="flex-grow:1;"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Comment")+'</span><input type="text" class="flex flex-grow form-control" id="'+l+'-Comment" placeholder="'+sLocaleFor("Page comment")+'" aria-label="'+sLocaleFor("Page comment")+'"></div><button type="button" id="'+l+'-Button" style="flex-grow:0; flex-basis:0;" class="sTranslatable ms-1 input-group-button btn btn-primary float-left">Done</button></div>',callback:function(e){$("#"+l+"-Button").click((function(){d.close()})),u=a.initializeCodeEditor(l+"-ace",c.Code,(()=>{t.nonReportableChange("PrelimCode")}),(()=>{t.nonReportableChange("PrelimCode")})),$("#"+l+"-Comment").val(c.Comment)}};d=WebEJS_TOOLS.createJSPanel(s,e,{minimize:"remove"},m)}();d.resize(m),d.reposition(),d.front()},r.hide=function(){d&&d.close()},r},WebEJS_GUI.codePanelMenuAction=function(t,e,n){switch(t){case"CustomMethods":sMainSelectCodeForm.show("Custom methods",sMainGUI.getModel().getCustomCode().getCustomMethods(),e,n);break;case"ModelMethods":sMainSelectCodeForm.show("Model methods",sMainGUI.getSystemInformation("model_methods"),e,n);break;case"ViewMethods":sMainSelectCodeForm.show("View methods",sMainGUI.getSystemInformation("view_methods"),e,n);break;case"ToolsMethods":sMainSelectCodeForm.show("Tools methods",sMainGUI.getSystemInformation("tools_methods"),e,n)}},WebEJS_GUI.codePanel=function(t,e){const n=WebEJS_TOOLS.tabbedPanel(),a=WebEJS_TOOLS.textTools();var o={},i={};return o.getKeyword=function(){switch(t){case"initialization":return"Initialization";case"fixed_relations":return"FixedRelations";case"custom":return"Custom";default:return t}},o.getPageName=function(){switch(t){case"initialization":return"Init Page";case"fixed_relations":return"FixRel Page";case"custom":return"Custom Page";default:return"Page"}},o.getMainPanelSelector=function(){return e},o.getDefaultPageType=function(){return"CODE_EDITOR"},o.readObject=function(t){if(i={},"pages"in t){const a=t.pages;null==a||a.length<=0?o.setNoPages():($(e).html(n.panelHTML(o,a)),n.initPanel(o,a))}else o.setNoPages();return!0},o.getPageObject=function(e){var a=n.getPageObject(o,e);return a.Comment=$("#m"+t+"PageComment_"+e).val(),a.Code=i[e].getValue(),a},o.saveObject=function(){return{pages:n.getAllPagesObject(o)}},o.getCustomMethods=function(){var t=[];for(var e in i){const s=n.getPageDivNameByHash(o,e),l=i[e].getValue();t.push(...a.getCustomMethods(s,l))}return t},o.reportableChange=function(t){sMainGUI.setChanged()},o.setNoPages=function(){$(e).html('<button class="sModelBtn sPanelNoPageBtn active" style="flex-grow:1;"><h5 class="sTranslatable">Click to create a page of '+function(t){switch(t){case"initialization":return"initialization";case"fixed_relations":return"fixed relations";case"custom":return"custom code"}}(t)+"</h5></button>"),n.initPanel(o,null)},o.pageInitialization=function(t,e){const a=n.getPageDivHash(t);t.find(".ace").each((function(){var s=e?e.Code:"// "+n.getPageDivName(o,t);i[a]=n.initializeCodeEditor($(this).attr("id"),s,(()=>{o.reportableChange("PageContent")}),(()=>{sMainGUI.setChanged()}))})),t.find(".sPageCommentField").on("change",(()=>{sMainGUI.setChanged()})),t.find(".cCodeMenuItem").on("click",(t=>{WebEJS_GUI.codePanelMenuAction($(t.target).data("action"),i[a],o)}))},o.pageDeleted=function(t){const e=n.getPageDivHash(t);delete i[e]},o.pageMainBuilder=function(e,n){return'<div class="ace" id="m'+t+"PageCodeEditor_"+e+'" style="flex-grow:1"></div>'},o.pageCommentBuilder=function(e,n){return'<div class="input-group input-group-sm dropup drop-start" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="m'+t+"PageComment_"+e+'" placeholder="Page comment" aria-label="Page comment"'+(n&&n.Comment?' value="'+n.Comment+'"':"")+'><span class="sModelBtn input-group-text dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="appearance:none"><i class="bi bi-menu-down"></i></span><ul class="dropdown-menu" data-hash="'+e+'"><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="CustomMethods">Custom methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ModelMethods" >Model methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ViewMethods"  >View methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ToolsMethods" >Tools methods</li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cCodeMenuItem py-0" data-action="CodeWizard" >Code wizard</li></ul></div>'},o},WebEJS_GUI.elementsPanel_dragFunction=function(t,e){console.log("Drag saved: "+t.target.dataset.drag_info),t.dataTransfer.setData("text","EJS-model_element:"+t.target.dataset.drag_info)},WebEJS_GUI.elementsPanel=function(){const t="#sModelList",e="border border-danger";var n={},a="",o=[],i=0,s={};function l(t){return t.find(".sMEListElementName").first().text()}function r(t){var e="";"html"in t&&(e+='<span class="cMEreadme col m-2" style="user-select: none;" ><figure class="figure m-2"><img src="'+sMainGUI.getSystemIconURL("info32.png")+'" class="m-0 figure-img img-fluid rounded mx-auto d-block" alt="Read Me"    draggable="false"  data-name="'+t.name+'" data-html="'+t.html+'"><figcaption class="sModelBtn figure-caption text-end">'+sLocaleFor("Read me")+"</figcaption></figure></span>");const n=t.elements;for(var i in n){const t=n[i];o.push(t);var s=t.name;"tooltip"in t&&(s+=" "+t.tooltip),e+='<span class=" cMEreadme col m-2" style="user-select: none;" ><figure class="figure m-2" draggable="true" ondragstart="WebEJS_GUI.elementsPanel_dragFunction(event)" data-drag_info="'+t.classname+'"><img src="'+a+t.icon+'" class="m-0 figure-img img-fluid rounded mx-auto d-block" alt="'+t.name+'"  draggable="false"  data-bs-toggle="tooltip" data-bs-placement="top"  data-html="'+t.html+'" data-name="'+t.name+'" title="'+s+'" ><figcaption class="sModelBtn figure-caption text-center">'+t.name+"</figcaption></figure></span>"}return e}function c(t,e){const n={theme:"bootstrap-light",headerLogo:sMainGUI.getWebEJSLogo(),headerTitle:'<h5 class="sTranslatable text-primary modal-title">'+t+"</h5>",headerControls:{smallify:"remove",minimize:"remove"},position:{at:"center",of:"#sMainWorkpanel"},borderRadius:".3rem",panelSize:{width:Math.min(.7*window.innerWidth,600),height:Math.min(.6*window.innerHeight,800)},content:'<iframe src="'+a+e+'" style="width: 100%; height: 100%;"></iframe>'};jsPanel.modal.create(n),$(".jsPanel-hdr").addClass(["p-1","bg-light"]),$(".jsPanel-content").addClass(["m-1","p-2","bg-light","border","border-dark","rounded"])}function d(t){for(var e in o){const n=o[e];if(n.classname==t)return n}return sMainGUI.errorLine(sMainResources.getString("Attempt to create a NON-SUPPORTED model element:")),sMainGUI.errorLine(sMainResources.getString("  - "+t)),sMessageForm.showWarning("MODEL ELEMENT reading error","The file includes a Model Element class not supported by WebEJS!","Check out the output area."),null}function u(e){return e=e.replaceAll(" ","_"),$(t).find(".list-group-item").each((function(t,n){l($(n))==e&&(e=u(e+"New"))})),e}function p(e,n){const o=d(e);if(!o)return;if(i++,s[i]=WebEJS_MODEL_ELEMENTS[o.classname](),!n){n=u(o.name.charAt(0).toLowerCase()+o.name.substring(1))}var l=$(MODEL_ELEMENT_INSTANCE_TEMPLATE.replaceAll("{{CLASSNAME}}",e).replaceAll("{{NAME}}",n).replaceAll("{{HASH}}",i).replaceAll("{{ICON}}",a+o.icon).replaceAll("{{VISIBLE}}",s[i].editConfiguration?"":"d-none"));const r=function(e){const n=e.split(".");e=n[n.length-1];var a=null;return $(t).find(".list-group-item").each((function(t,n){const o=$(n),i=o.data("classname").split(".");if(i[i.length-1].localeCompare(e)>0)return a=o,!1})),a}(o.classname);return r?l.insertBefore(r):$(t).append(l),s[i]}return n.readObject=function(e){$(t).empty();const n=e.list;for(var a in n){const t=n[a],e=p(t.Classname,t.Name);"Contents"in t&&e.readXMLContents(t.Contents)}return!0},n.saveObject=function(){var e=[];return $(t).find(".list-group-item").each((function(t,n){const a=$(n);var o={Classname:a.data("classname"),Name:l(a)};const i=s[a.data("hash")];i.saveXMLContents&&(o.Contents=i.saveXMLContents()),e.push(o)})),{list:e}},n.nonReportableChange=function(t){console.log("Model variable, non reportable change: "+t),sMainGUI.setChanged()},n.buildPalette=function(t){for(var e in a=sMainGUI.getModelElementsURL(),elementGroups=t.model_elements,o=[],elementGroups){const t="mModelElementPaletteRow_"+e,o=elementGroups[e];var n=jQuery("<div/>",{class:"accordion-item p-0"}),i='<span class="accordion-header" id="'+t+'-header"><button class="sModelBtn accordion-button py-1" type="button" data-bs-toggle="collapse"  data-bs-target="#'+t+'" aria-expanded="true" aria-controls="'+t+'"><img id="'+t+'_group_button" class="cModelElementGroup" draggable="false" src="'+a+o.icon+'">'+o.name+'</button></span><div id="'+t+'" class="accordion-collapse collapse show" aria-labelledby="'+t+'-header"><div class="mElementPaletteSubpanel accordion-body p-0">'+r(o)+"</div></div>";n.html(i),$("#sModelElementsPaletteSubpanel").append(n)}$(".cMEreadme").on("click",(t=>{c($(t.target).data("name"),$(t.target).data("html"))}))},$(t).on("dblclick",".list-group-item",(function(t){const e=$(t.currentTarget).closest(".list-group-item"),n=e.data("hash");if(s[n].editConfiguration)s[n].editConfiguration();else{const t=d(e.data("classname"));c(t.name,t.html)}})),$(t).on("dragenter",(function(n){n.preventDefault(),$(t).addClass(e)})),$(t).on("dragover",(function(n){n.preventDefault(),$(t).addClass(e)})),$(t).on("dragleave",(function(n){n.preventDefault(),$(t).removeClass(e)})),$(t).on("dragenter",".list-group-item",(function(n){n.preventDefault(),$(t).addClass(e)})),$(t).on("dragover",".list-group-item",(function(n){n.preventDefault(),$(t).addClass(e)})),$(t).on("drop",(function(n){$(t).removeClass(e),$(n.target).hasClass("list-group-item")&&($(n.target).closest(".list-group-item").removeClass(e),console.log("Target = "+l($(n.target))));const a=n.originalEvent.dataTransfer.getData("text");if("EJS-model_element"!=a.split(":")[0])return;const o=a.split(":")[1];"undefined"!=o&&(n.preventDefault(),p(o))})),$(t).on("click",".item-icon",(t=>{const e=l($(t.target).closest(".list-group-item"));$(t.target).parent().find(".cMEMenuHeader").text(sMainResources.getString("Menu for")+" "+e)})),$(t).on("click",".cMEMenuItem",(t=>{!function(t){const e=t.closest(".list-group-item");switch(t.data("action")){case"Edit":const t=e.data("hash");s[t].editConfiguration();break;case"Rename":const n=l(e);sInputForm.show("Rename element","New name",n,(function(t){t!==n&&(t=u(t),function(t,e){t.find(".sMEListElementName").first().text(e)}(e,t))}));break;case"Remove":sMainConfirmationForm.show(l(e),"This action cannot be undone. Do you really want to remove this element?","Remove",(function(){delete s[e.data("hash")],e.remove()}));break;case"Help":const a=d(e.data("classname"));c(a.name,a.html)}}($(t.target))})),n},MODEL_ELEMENT_INSTANCE_TEMPLATE='\n<div role="treeitem" class="list-group-item py-0 border-1" style="padding-left:10" data-hash={{HASH}} data-classname="{{CLASSNAME}}">\n\t<span class="dropdown">\n\t\t<img class="item-icon dropdown" style="padding: 0 2px 0 2px;" src="{{ICON}}" \n\t\t\tid="mMEItemMenuIcon_{{HASH}}" type="button" data-bs-toggle="dropdown" aria-expanded="false">\n\t\t</img>\n\t\t<ul class="dropdown-menu py-0" aria-labelledby="mMEItemMenuIcon_{{HASH}}">\n\t\t\t<li><span class="cMEMenuHeader dropdown-item-text py-0 fw-bold">Menu</span></li>\n\n\t\t\t<li><hr class="dropdown-divider m-0"></li>\n\t\t\t<li class="{{VISIBLE}} dropdown-item sTranslatable cMEMenuItem" data-action="Edit">Edit</li>\n\t\t\t<li class="dropdown-item sTranslatable cMEMenuItem" data-action="Rename">Rename</li>\n\t\t\t<li class="dropdown-item sTranslatable cMEMenuItem" data-action="Help">Help</li>\n\t\t\t<li><hr class="dropdown-divider m-0"></li>\n\t\t\t<li class="dropdown-item sTranslatable cMEMenuItem" data-action="Remove">Remove</li>\n\t\t</ul>\n\t</span>\n\t<span class="sMEListElementName">{{NAME}}</span>\n</div>\n',WebEJS_GUI.eventPanel=function(t,e,n){const a=WebEJS_TOOLS.tabbedPanel();WebEJS_TOOLS.textTools();var o={getKeyword:function(){return" Event"},getPageName:function(){return"Event"},getMainPanelSelector:function(){return t},getDefaultPageType:function(){return"EVENT_EDITOR"}};const i='<div class="col-12 h-100 d-flex flex-column">#{content}<div class="m-1 d-flex flex-row" style="flex-basis:0;flex-grow: 0"><div class="input-group input-group-sm" style="flex-basis:0;"><label class="sTranslatable sModelBtn input-group-text cODEZenoEffectButton">Zeno effect action</label></div><div class="input-group input-group-sm me-1" style="flex-grow: 1"><span class="sTranslatable sModelBtn input-group-text p-1 pe-2">Check events at steps no larger than</span><input type="text" class="form-control form-control-sm ps-1 cODEEventsStepSize" '+sMainNoAutocorrect+' id="mEventPageEditor_StepSize_'+e+'" ><span class="input-group-text"><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#mEventPageEditor_StepSize_'+e+'"  style="font-size: 1rem;"></i></span></div></div></div>';return o.readObject=function(e){null==e||e.length<=0?o.setNoPages():($(t).html(a.panelHTML(o,e)),a.initPanel(o,e)),$(t).find(".cODEZenoEffectButton").on("click",(t=>{alert("Zenno efect panel here")})),$(t).find(".cVariableChooser").on("click",(t=>{var e=$(t.target).data("types").split("|"),n=$(t.target).data("field");$(n).val().trim();sMainSelectChoiceForm.show("List of suitable variables",function(t){const e=t.split("|");for(var n=sMainGUI.getModel().getVariables().getVariablesOfType(e),a=[],o=0;o<n.length;o++){const t=n[o],e="("+t.type+t.dimension+") : "+t.comment;a.push({name:t.name,value:t.name,description:e,style:"sModelBtn"})}return a}(e),value,(function(t){t!=value&&($(n).val(t),o.nonReportableChange("Parameter changed on "+a.getPageDivName(o,mPageDiv)))}))}))},o.getPageObject=function(t){var e=a.getPageObject(o,t);return e.Comment=$("#m"+mKeyword+"PageComment_"+t).val(),e.Code=mCodeEditors[t].getValue(),e},o.saveObject=function(){return{pages:a.getAllPagesObject(o)}},o.reportableChange=function(t){sMainGUI.setChanged()},o.setNoPages=function(){var e=i.replace(/#{content}/g,'<button class="sModelBtn sPanelNoPageBtn active" style="flex-grow:1;"><h5 class="sTranslatable">Click to create an event page</h5></button>');$(t).html(e),a.initPanel(o,null)},o.pageInitialization=function(t,e){const n=a.getPageDivHash(t);t.find(".ace").each((function(){var i=e?e.Code:"// "+a.getPageDivName(o,t);mCodeEditors[n]=a.initializeCodeEditor($(this).attr("id"),i,(()=>{o.reportableChange("PageContent")}),(()=>{sMainGUI.setChanged()}))})),t.find(".sPageCommentField").on("change",(()=>{sMainGUI.setChanged()})),t.find(".cCodeMenuItem").on("click",(e=>{WebEJS_GUI.codePanelMenuAction($(e.target).data("action"),mCodeEditors[n],o),codeMenuAction(t,$(e.target).data("action"))}))},o.pageDeleted=function(t){const e=a.getPageDivHash(t);mCodeEditors[e]=null},o.pageMainBuilder=function(t,e){return'<div class="ace" id="m'+mKeyword+"PageCodeEditor_"+t+'" style="flex-grow:1"></div>'},o.pageCommentBuilder=function(t,e){return'<div class="input-group input-group-sm dropup drop-start" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="m'+mKeyword+"PageComment_"+t+'" placeholder="Page comment" aria-label="Page comment"'+(e&&e.Comment?' value="'+e.Comment+'"':"")+'><span class="sModelBtn input-group-text dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="appearance:none"><i class="bi bi-menu-down"></i></span><ul class="dropdown-menu" data-hash="'+t+'"><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="CustomMethods">Custom methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ModelMethods" >Model methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ViewMethods"  >View methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ToolsMethods" >Tools methods</li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cCodeMenuItem py-0" data-action="CodeWizard" >Code wizard</li></ul></div>'},o},WebEJS_GUI.evolutionPanel=function(t){const e=WebEJS_TOOLS.tabbedPanel();var n={},a=WebEJS_TOOLS.tablePanel(n),o="",i={},s={},l={},r={};function c(t){const e=t.split("|");for(var n=sMainGUI.getModel().getVariables().getVariablesOfType(e),a=[],o=0;o<n.length;o++){const t=n[o],e="("+t.type+t.dimension+") : "+t.comment;a.push({name:t.name,value:t.name,description:e,style:"sModelBtn"})}return a}function d(t){a.getRows(t).each((function(){const e=$(this).find(".cODEstate").first(),n=e.find(".cODEvalue").val();u(e,t,n)}))}function u(t,e,n){const a=$("#mEvolutionPageEditor_IndependentVariable_"+e).val();var o=sMainSimulationOptions.useDeltaForODEs(),i=o=sMainSimulationOptions.useDeltaForODEs()?"&#916;":"d";i='<span class="fw-bold">'+o+"</span> "+n+'<span class="fw-bold"> / '+o+"</span> "+a,t.find(".cODEvalue").val(n),t.find(".cODEdisplay").html(i)}function p(t,e){t.find(".cODEvalue").val(e),t.find(".cODEdisplay").html(e)}n.getMainPanelSelector=function(){return t},n.getKeyword=function(){return"Evolution"},n.getPageName=function(){return"Evol Page"},n.getDefaultPageType=function(){return"EVOLUTION_EDITOR"},n.getSecondType=function(){return"ODE_EDITOR"},n.getSecondTypeLabel=function(){return"Create a new page of ODEs"},n.isPageSecondType=function(t){return t.find(".cODEtable").length>0},n.disablePage=function(t,a){n.isPageSecondType(e.getDivPageByHash(n,t))&&a&&(s[t].hide(),l[t].hide(),r[t].hide())},$("#sEvolParamFPSRange").on("input",(t=>{var e=t.target.value;e<25?$("#sEvolParamFPS").val(e):$("#sEvolParamFPS").val(100),n.nonReportableChange("FPS changed")})),$("#sEvolParamFPSRange").on("mouseup",(t=>{var e={action:"SetFPS",value:t.target.value};n.nonReportableChange(e)})),$("#sEvolParamFPSRange").on("touchend",(t=>{var e={action:"SetFPS",value:t.target.value};n.nonReportableChange(e)})),$("#sEvolParamFPS").on("change",(()=>{var t=Math.round($("#sEvolParamFPS").val());isNaN(t)&&(t=15),t<1&&(t=1),t>24?($("#sEvolParamFPSRange").val(25),t=100):$("#sEvolParamFPSRange").val(t),$("#sEvolParamFPS").val(t);var e={action:"SetFPS",value:t};n.nonReportableChange(e)})),$("#sEvolParamSPD").on("change",".sEvolParamSPD",(()=>{var t={action:"SetSPD",value:$("#sEvolParamSPD").val()};n.nonReportableChange(t)})),n.readObject=function(c){if(i={},s={},l={},r={},"information"in c){const t=c.information;t.FPS>24?$("#sEvolParamFPSRange").val(25):$("#sEvolParamFPSRange").val(t.FPS),$("#sEvolParamFPS").val(t.FPS),$("#sEvolParamSPD").val(t.SPD),"false"==t.Autoplay?$("#sEvolParamAutoplay").prop("checked",!1):$("#sEvolParamAutoplay").prop("checked",!0),o="RealTimeVariable"in c?c.RealTimeVariable:""}else $("#sEvolParamFPSRange").val(20),$("#sEvolParamFPS").val(20),$("#sEvolParamSPD").val(1),$("#sEvolParamAutoplay").prop("checked",!0),o="";if("pages"in c){const o=c.pages;null==o||o.length<=0?n.setNoPages():($(t).html(e.panelHTML(n,o)),e.initPanel(n,o),a.processRowsToSet())}else n.setNoPages();return!0},n.getPageObject=function(t){var o=e.getPageObject(n,t);return o.Comment=$("#mEvolutionPageComment_"+t).val(),n.isPageSecondType(e.getDivPageByHash(n,t))?(o.IndependentVariable=$("#mEvolutionPageEditor_IndependentVariable_"+t).val(),o.Increment=$("#mEvolutionPageEditor_Increment_"+t).val(),o.Equations=a.getTableRows(t),o.Method=$("#mEvolution_PageEditor_Method_"+t+" option:selected").val(),o.AbsoluteTolerance=$("#mEvolution_PageEditor_Tolerance_"+t).val(),o.PreliminaryCode=s[t].getContent(),l[t].getContent(o),r[t].getContent(o)):o.Code=i[t].getValue(),o},n.saveObject=function(){return{information:{FPS:$("#sEvolParamFPSRange").val(),SPD:$("#sEvolParamSPD").val(),RealTimeVariable:o,Autoplay:$("#sEvolParamAutoplay").prop("checked")?"true":"false"},pages:e.getAllPagesObject(n)}},n.nonReportableChange=function(t){console.info("Model evolution, non reportable change: "+t),sMainGUI.setChanged()},n.reportableChange=function(t){console.info("Model evolution, reportable change: "+t),sMainGUI.setChanged()},n.setNoPages=function(){$(t).html('<div class="h-100 col-12 mx-auto btn-group-vertical" style="flex-grow:1;"><button class="sModelBtn sPanelNoPageBtn col-12 h-50 active" data-type="'+n.getDefaultPageType()+'" ><h5 class="sTranslatable">Click to create a page of code</h5></button><button class="sModelBtn sPanelNoPageBtn col-12 h-50 active" data-type="'+n.getSecondType()+'" ><h5 class="sTranslatable">Click to create a page of ODEs</h5></button></div>'),e.initPanel(n,null)},n.pageMainBuilder=function(t,e,n){return"ODE_EDITOR"==n?function(t,e){const n=sMainGUI.getSystemInformation("solvers"),o=e?e.Equations:[];var i='<div class="tabContent d-flex flex-column" style="flex-grow:1"><div id="mEvolutionPageEditor_'+t+'" class="cODEtable table-responsive d-flex flex-column" style="flex-grow:1"><div class="m-1 d-flex flex-row" style="flex-basis:0;flex-grow: 0"><div class="input-group input-group-sm me-1" style="flex-grow: 1"><span class="sTranslatable sModelBtn input-group-text p-1 pe-2">Indep. Var.</span><input type="text" class="form-control form-control-sm ps-1 cODEIndepVar" '+sMainNoAutocorrect+' id="mEvolutionPageEditor_IndependentVariable_'+t+'" '+(e?"value="+e.IndependentVariable:"")+'><span class="input-group-text"><i class="sModelBtn bi bi-link cVariableChooser cEvolutionIndepVar"  data-types="int|double"  data-field="#mEvolutionPageEditor_IndependentVariable_'+t+'"  style="font-size: 1rem;"></i></span></div><div class="input-group input-group-sm me-1" style="flex-grow: 1"><span class="sTranslatable sModelBtn input-group-text p-1 pe-2">Increment</span><input type="text" class="form-control form-control-sm ps-1 sODEIncrement" '+sMainNoAutocorrect+' id="mEvolutionPageEditor_Increment_'+t+'" '+(e?"value="+e.Increment:"")+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#mEvolutionPageEditor_Increment_'+t+'"  style="font-size: 1rem;"></i></span></div><div class="input-group input-group-sm" style="flex-basis:0;"><label class="sTranslatable sModelBtn input-group-text cODEPrelimCodeButton">Prelim code</label></div></div><div class="sModelBorderedPanel table-responsive" style="flex-grow: 1">'+a.getTableHTML(t,m,o)+'</div><div class="m-1" style="flex-basis: 0;flex-grow: 0"><div class="d-flex flex-row"><div class="input-group input-group-sm me-1" style="flex-grow: 5"><span class="sTranslatable sModelBtn input-group-text p-1 pe-2">Solver</span><select class="form-select" id="mEvolution_PageEditor_Method_'+t+'">';const s=e?e.Method:sMainGUI.getSystemInformation("default_solver");for(methodIndex in n){var l=n[methodIndex];l.key==s?i+='<option selected value="'+l.key+'">'+l.name+"</option>":i+='<option value="'+l.key+'">'+l.name+"</option>"}return i+='</select></div><div class="input-group input-group-sm me-1" style="flex-grow: 5"><span class="sTranslatable sModelBtn input-group-text p-1 pe-2">Tol</span><input type="text" class="form-control form-control-sm ps-1"  placeholder="Absolute tolerance" aria-label="Absolute tolerance"'+sMainNoAutocorrect+' id="mEvolution_PageEditor_Tolerance_'+t+'" '+(e&&e.AbsoluteTolerance?' value="'+e.AbsoluteTolerance+'"':"")+'><span class="input-group-text"><i class="sModelBtn bi bi-link col-12 cVariableChooser"  data-types="int|double"  data-field="#mEvolution_PageEditor_Tolerance_'+t+'"  data-name="tolerance"  style="font-size: 1rem;"></i></span></div><div class="input-group input-group-sm me-1" style="flex-basis: 0"><span class="input-group-text sODEParameters cODEParametersButton"><i class="sModelBtn bi bi-table" style="font-size: 1rem;"></i></span></div><div class="input-group input-group-sm" style="flex-basis:0;"><span class="sTranslatable sModelBtn cODEEventsButton input-group-text p-1 pe-2" id="mEvolution_PageEvents_'+t+'">'+sLocaleFor("Events")+"</span></div></div></div></div></div>"}(t,e):'<div class="ace" id="mEvolutionPageCodeEditor_'+t+'" style="flex-grow:1"></div>'},n.pageCommentBuilder=function(t,e){return'<div class="input-group input-group-sm" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="mEvolutionPageComment_'+t+'" placeholder="Page comment" aria-label="Page comment"'+(e&&e.Comment?' value="'+e.Comment+'"':"")+"></div>"},n.selectVariable=function(t,e){const a=$(t.target).data("types"),o=$(t.target).data("field"),i=$(o).val().trim();sMainSelectChoiceForm.show("List of suitable variables",c(a),i,(function(a){a!=i&&($(o).val(a),$(t.target).hasClass("cEvolutionIndepVar")&&d(pageHash),n.nonReportableChange("Parameter changed on "+e+" ("+o+")"))}))},n.pageInitialization=function(t,o){const c=e.getPageDivHash(t);if(n.isPageSecondType(t)){e.getPageDivName(n,t);s[c]=WebEJS_GUI.odePreliminaryCodePanel(n,t,o),l[c]=WebEJS_GUI.odeEventsPanel(n,t,o),r[c]=WebEJS_GUI.odeParametersPanel(n,t,o),t.find(".cVariableChooser").on("click",(a=>{e.isPageDisabled(n,t)||n.selectVariable(a,e.getPageDivName(n,t))})),t.find(".cODEIndepVar").on("change",(t=>{d(c)})),t.find(".cODEPrelimCodeButton").on("click",(function(){e.isPageDisabled(n,t)||s[c].show()})),t.find(".cODEEventsButton").on("click",(function(){e.isPageDisabled(n,t)||l[c].show()})),t.find(".cODEParametersButton").on("click",(function(){e.isPageDisabled(n,t)||r[c].show()})),t.find(".cODEPrelimCodeButton").on("click",(function(){e.isPageDisabled(n,t)||s[c].show()})),a.tableInitialization(c)}else t.find(".ace").each((function(){var a=o?o.Code:"// "+e.getPageDivName(n,t);i[c]=e.initializeCodeEditor($(this).attr("id"),a,(()=>{n.reportableChange("PageContent")}),(()=>{sMainGUI.setChanged()}))}))},n.pageDeleted=function(t){const a=e.getPageDivHash(t);n.isPageSecondType(t)?(s[a].hide(),delete s[a],l[a].hide(),delete l[a],r[a].hide(),delete r[a]):delete i[a]},n.showNumberOfEvents=function(t,n){const a=e.getPageDivHash(n);$("#mEvolution_PageEvents_"+a).text(t+" "+sLocaleFor("Events"))},n.tableRowInitialization=function(t,o,i){i.find(".cODEstate").on("click",(o=>{const s=e.getDivPageByHash(n,t);if(e.isPageDisabled(n,s))return;const l=$(o.target).closest(".cODEstate"),r=l.find(".cODEvalue").val();sMainSelectChoiceForm.show("List of suitable variables",c("double|double[]"),r,(function(e){e!=r&&(u(l,t,e),i.is(":last-child")&&a.appendEmptyRow(t),n.nonReportableChange("ODE state changed on "+t))}),null,null,"[i]")})),i.find(".cODErate").on("click",(o=>{const s=e.getDivPageByHash(n,t);if(e.isPageDisabled(n,s))return;const l=$(o.target).closest(".cODErate"),r=l.find(".cODEvalue").val();sMainSelectChoiceForm.show("List of suitable variables",c("int|int[]|double|double[]"),r,(function(e){e!=r&&(p(l,e),i.is(":last-child")&&a.appendEmptyRow(t),n.nonReportableChange("ODE Rate changed on "+t))}),null,null,"[i]")}))};const m=[{name:"State"},{name:""},{name:"Rate",class:"col-11"}];n.getTableEmptyRow=function(){return{state:"",rate:""}},n.getTableRowHTML=function(t,e,n){return'<td id="'+n+'State" class="col-4 cODEstate"><input hidden class="cODEvalue" type="text" '+sMainNoAutocorrect+'/><span class="cODEdisplay fw-normal" ></span></td><td class="fw-bold">=</td><td id="'+n+'Rate" class="col-8 cODErate"><input hidden class="cODEvalue" type="text" '+sMainNoAutocorrect+'/><span class="cODEdisplay fw-normal" ></span></td>'},n.setTableRow=function(t,e,n){u($("#"+e+"State"),t,n.state),p($("#"+e+"Rate"),n.rate)};return n.getTableRowObject=function(t){return{state:$(t[1]).find(".cODEvalue").val(),rate:$(t[3]).find(".cODEvalue").val()}},n},WebEJS_GUI.variablesPanel=function(t){const e=WebEJS_TOOLS.tabbedPanel(),n=WebEJS_TOOLS.textTools();var a={},o=WebEJS_TOOLS.tablePanel(a);function i(t){var n=[];return e.getAllPagesDivList(a).each((function(){if(!e.isPageDisabled(a,$(this))){const a=e.getPageDivHash($(this));n.push(...o.getTableRows(a,t))}})),n}function s(){for(var t=i(!0),e=[],a=0;a<t.length;a++){(s=t[a]).Name.trim().length<=0||e.push({name:s.Name,value:s.Value,dimension:s.Dimension,tr:s._tr_})}n.checkCode(e);var o=!0;for(var a in e){var s;(s=e[a]).run_ok?s.tr.removeClass("bg-warning"):(s.tr.addClass("bg-warning"),o=!1)}return o}a.getMainPanelSelector=function(){return t},a.getKeyword=function(){return"Variables"},a.getPageName=function(){return"Var Table"},a.getDefaultPageType=function(){return"VARIABLE_EDITOR"},a.disablePage=function(t,e){e&&o.removeWarnings(t)},a.readObject=function(n){if("pages"in n){var i=n.pages;null==i||i.length<=0?a.setNoPages():($(t).html(e.panelHTML(a,i)),e.initPanel(a,i),o.processRowsToSet(),s())}else a.setNoPages();return!0},a.getPageObject=function(t){var n=e.getPageObject(a,t);return n.PageComment=$("#mVariablesPageComment_"+t).val(),n.Variables=o.getTableRows(t),n},a.saveObject=function(){return{pages:e.getAllPagesObject(a)}},a.getVariablesOfType=function(t){for(var e=i(!1),n=[],a=0;a<e.length;a++){var o=e[a];if(!(o.Name.trim().length<=0)){var s=o.Type,l=o.Dimension.trim();l.length>0&&(s+="[]"),t.includes(s)&&(l.length>0&&"["!=l[0]&&(l="["+l+"]"),n.push({name:o.Name,type:o.Type,dimension:l,comment:o.Comment}))}}return n},a.isArrayVariable=function(t){for(var e=i(!1),n=0;n<e.length;n++){var a=e[n];if(a.Name.trim()==t)return a.Dimension.trim().length>0}return!1},a.nonReportableChange=function(t){console.log("Model variable, non reportable change: "+t),sMainGUI.setChanged()},a.reportableChange=function(t){if(console.log("Model variable, reportable change: "+t),sMainGUI.setChanged(),s()){var e={panel:"model",action:"setVariables",pages:a.saveObject().pages};sMainGUI.reportPreview(e)}},a.setNoPages=function(){$(t).html('<button class="sModelBtn sPanelNoPageBtn h-100 col-12 active" style="flex-grow:1;"><h5 class="sTranslatable">Click to create a page of variables<h5></button>'),e.initPanel(a,null)},a.pageMainBuilder=function(t,e){const n=e?e.Variables:[];return o.getTableHTML(t,r,n)},a.pageCommentBuilder=function(t,e){return'<div class="input-group input-group-sm" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="form-control cCommentField" id="mVariablesComment_'+t+'" disabled value=""/></div><div class="input-group input-group-sm" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Page comment</span><input type="text" class="sPageCommentField form-control" id="mVariablesPageComment_'+t+'" placeholder="Page comment" aria-label="Page comment"'+(e&&e.PageComment?' value="'+e.PageComment+'"':"")+"></div>"},a.pageInitialization=function(t,n){const i=e.getPageDivHash(t);o.tableInitialization(i),$("#mVariablesComment_"+i).on("change",(t=>{var e=parseInt($(t.target).data("row_hash"));if(isNaN(e))return;const n=o.findRowTDArrayByHash(i,e);n&&o.setText(n,d,$(t.target).val()),a.nonReportableChange("Variable comment changed")})),t.find(".sPageCommentField").on("change",(()=>{a.nonReportableChange("Page comment changed")}))},a.tableRowInitialization=function(t,e,i){i.find(".cTypeMenuItem").on("click",(t=>{const e=i.children();o.setText(e,c,$(t.target).data("type"));const n=a.getTableRowObject(e);a.reportableChange("Changed type of Variable "+n.Name)})),i.find("input").on("change",(e=>{if("checkbox"==$(e.target).attr("type"))return;const s=i.children(),l=a.getTableRowObject(s);if(a.reportableChange("Changed variable "+l.Name),$(e.target).hasClass("cEjsVarName")){const t=n.toValidVariableName(l.Name);t!=l.Name&&sMessageForm.showWarning("Error","This name is not a valid one!",sLocaleFor("Consider instead using (f.i.):")+" "+t)}i.is(":last-child")&&o.appendEmptyRow(t)})),i.find("input").on("focus",(n=>{const a=$("#mVariablesComment_"+t);a.attr("disabled",!1),a.data("row_hash",e),a.val(o.getText(i.children(),d)),o.highlightRows(t,e)}))};const l='<div class="dropdown" data-target="type"><button class="btn btn-link text-decoration-none dropdown-toggle typeMenuButton" style="padding:0px 5px 0px 0px; border:0px; "type="button" id="VarTableTypeMenuButton_#{label}" data-bs-toggle="dropdown" aria-expanded="false"></button><ul class="dropdown-menu"  aria-labelledby="VarTableTypeMenuButton_#{label}"><li class="dropdown-item cTypeMenuItem" data-type="boolean">boolean</li><li class="dropdown-item cTypeMenuItem" data-type="int">int</li><li class="dropdown-item cTypeMenuItem" data-type="double">double</li><li class="dropdown-item cTypeMenuItem" data-type="String">String</li><li class="dropdown-item cTypeMenuItem" data-type="Object">Object</li></ul></div>',r=[{name:"Name"},{name:"Initial Value"},{name:""},{name:"Type"},{name:"Dimension"}];a.getTableEmptyRow=function(){return{Name:"",Value:"",Type:"double",Dimension:"",Comment:"",Domain:""}},a.getTableRowHTML=function(t,e,n){return'<td><input id="'+n+'Name"   type="text" class="col-12 cEjsVarName"'+sMainNoAutocorrect+'/></td><td><input id="'+n+'Value"  type="text" class="col-12"'+sMainNoAutocorrect+"/></td><td>"+l.replace(/#\{label\}/g,t+"_"+e)+'</td><td><input id="'+n+'Type"   type="text" class="col-12 cTypeColumn"'+sMainNoAutocorrect+'/></td><td><input id="'+n+'Dimension"  type="text" class="col-12"'+sMainNoAutocorrect+'/></td><td hidden><input id="'+n+'Comment" type="text" /></td><td hidden><input id="'+n+'Domain" type="text" /></td>'},a.setTableRow=function(t,e,n){$("#"+e+"Name").val(n.Name),$("#"+e+"Value").val(n.Value),$("#"+e+"Type").val(n.Type),$("#"+e+"Dimension").val(n.Dimension),$("#"+e+"Comment").val(n.Comment),$("#"+e+"Domain").val(n.Domain)},a.rowRemoved=function(t,e){const n=$("#mVariablesComment_"+t);n.data("row_hash")==e&&(n.data("row_hash",null),n.attr("disabled",!0),n.val(""))};const c=4,d=6;return a.getTableRowObject=function(t){return{Name:o.getText(t,1),Value:o.getText(t,2),Type:o.getText(t,c),Dimension:o.getText(t,5),Comment:o.getText(t,d),Domain:o.getText(t,7)}},a},WebEJS_GUI.optionsSimulationPanel=function(){var t={},e=null,n=null;t.toggle=function(){if(e)return e.close(),sMainGUI.setSimulationOptionsRadio(!1),!1;const t={content:p,onbeforeclose:function(t){return u(),e=null,!0},onclosed:function(t,n){e=null,sMainGUI.setSimulationOptionsRadio(!1)},footerToolbar:'<button type="button" id="mSimulationOptionsEditorDoneButton" class="sTranslatable btn btn-primary float-left">Done</button>',callback:function(t){d(n),$("#mSimulationOptionsEditorDoneButton").click((function(){e.close()}))}};e=WebEJS_TOOLS.createJSPanel(sMainResources.getString("Simulation options"),t),sMainGUI.setSimulationOptionsRadio(!0)};var a=[],o=0,i=[],s=0;function l(t,e){for(var n=0;n<e.length;n++)if(entry=e[n].hash==t)return n;return-1}function r(t,e,n,a){for(var o="",i=0;i<e.length;i++){const t=e[i].hash;var s=e[i].logo;s=s.length<=0?sMainGUI.getSystemIconURL("question-square.svg"):sMainGUI.getURLpathFor(s),o+='<button class="p-1 btn btn-outline-secondary btn-link text-decoration-none" data-bs-toggle="tooltip" data-bs-placement="bottom"  title="'+sMainResources.getString("Click to choose a "+n+" x "+a+" PNG file)")+'"><img width="'+n+'" height="'+a+'" class="d-inline-block align-bottom;" src="'+s+'" data-hash="'+t+'" ></button>'}$(t).html(o)}function c(t){for(var e="",n=0;n<t.length;n++){e+="<option>"+t[n].trim()+"</option>"}$("#mSimulationOptionsDetectedFiles").html(e)}function d(e){$("#mSimulationOptionsTitle").val(e.Title);for(var n="",d=0;d<a.length;d++){const t=a[d].name.trim();n+='<option value="'+a[d].hash+'">'+t+"</option>"}$("#mSimulationOptionsAuthor").html(n),r("#mSimulationOptionsAuthorLogoGallery",a,50,50),$("#mSimulationOptionsAuthorLogoGallery").on("click","img",(function(){const e=$(this),n=$(this).data("hash");WebEJS_TOOLS.selectFile(WebEJS_TOOLS.IMAGE_FORMATS,(function(o,i){const s=l(n,a);s<0?alert("Author hash not found: "+n):(a[s].logo=o,e.attr("src",i),t.updateDetectedFiles())}),!0,null)})),$("#mSimulationOptionsAuthorAdd").click((e=>{const n=prompt(sMainResources.getString("Author name:"),"");null==n||n.trim().length<=0||(o++,a.push({name:n,logo:"",hash:o}),$("#mSimulationOptionsAuthor").append($("<option>",{value:o,text:n})),$('#mSimulationOptionsAuthor option[value="'+o+'"]').attr("selected",!0),r("#mSimulationOptionsAuthorLogoGallery",a,50,50),t.updateDetectedFiles())})),$("#mSimulationOptionsAuthorEdit").click((t=>{const e=$("#mSimulationOptionsAuthor option:selected");var n=e.val();const o=l(n,a);if(o<0)return void alert("Author hash not found: "+n);const i=prompt(sMainResources.getString("Author name:"),a[o].name);null==i||i.trim().length<=0||(a[o].name=i,e.val(i),e.text(i))})),$("#mSimulationOptionsAuthorDelete").click((e=>{const n=$("#mSimulationOptionsAuthor option:selected");var o=n.val();const i=l(o,a);i<0?alert("Author hash not found: "+o):(a.splice(i,1),n.remove(),r("#mSimulationOptionsAuthorLogoGallery",a,50,50),t.updateDetectedFiles())})),$("#mSimulationOptionsCopyright").val(e.Copyright),$("#mSimulationOptionsKeywords").val(e.Keywords),$("#mSimulationOptionsLevel").val(e.Level),$("#mSimulationOptionsLanguages").val(e.Language),$("#mSimulationOptionsAbstract").val(e.Abstract);for(n="",d=0;d<i.length;d++){const t=i[d].logo.trim();n+='<option value="'+i[d].hash+'">'+t+"</option>"}$("#mSimulationOptionsLogo").html(n),r("#mSimulationOptionsLogoGallery",i,320,180),$("#mSimulationOptionsLogoGallery").on("click","img",(function(){const t=$(this),e=$(this).data("hash");WebEJS_TOOLS.selectFile(WebEJS_TOOLS.IMAGE_FORMATS,(function(n,a){const o=l(e,i);o<0?alert("Logo hash not found: "+e):(i[o].logo=n,$('#mSimulationOptionsLogo option[value="'+e+'"]').text(n),t.attr("src",a))}),!0,null)})),$("#mSimulationOptionsLogoAdd").click((e=>{WebEJS_TOOLS.selectFile(WebEJS_TOOLS.IMAGE_FORMATS,(function(e,n){s++,i.push({logo:e,hash:s}),$("#mSimulationOptionsLogo").append($("<option>",{value:s,text:e})),$('#mSimulationOptionsLogo option[value="'+s+'"]').attr("selected",!0),r("#mSimulationOptionsLogoGallery",i,320,180),t.updateDetectedFiles()}),!0,null)})),$("#mSimulationOptionsLogoDelete").click((e=>{const n=$("#mSimulationOptionsLogo option:selected");var a=n.val();const o=l(a,i);o<0?alert("Logo hash not found: "+a):(o>-1&&i.splice(o,1),n.remove(),r("#mSimulationOptionsLogoGallery",i,320,180),t.updateDetectedFiles())})),$("#mSimulationOptionsEditorMustPause").prop("checked","false"==e.RunAlways),$("#mSimulationOptionsModelTab").val(e.ModelTab),$("#mSimulationOptionsModelTabTitle").val(e.ModelTabTitle),$("#mSimulationOptionsModelName").val(e.ModelName),$("#mSimulationOptionsFixedNavigationBar").prop("checked","false"==e.FixedNavigationBar),$("#mSimulationOptionsCSS").val(e.CSSFile),$("#mSimulationOptionsCSSEdit").click((t=>{WebEJS_TOOLS.selectFile(["css"],(function(t,e){$("#mSimulationOptionsCSS").val(t)}),!0,null)})),$("#mSimulationOptionsCSSDelete").click((t=>{$("#mSimulationOptionsCSS").val("")}));var u=!0;"IncludeSource"in e&&(u="false"!=e.IncludeSource),$("#mSimulationOptionsIncludeSource").prop("checked",u),u=!0,"IncludeLibrary"in e&&(u="false"!=e.IncludeLibrary),$("#mSimulationOptionsIncludeLibrary").prop("checked",u),u=!1,"SaveInXMLFormat"in e&&(u="true"==e.SaveInXMLFormat),$("#mSimulationOptionsSaveAsXML").prop("checked",u),u=!1,"UglifyJS"in e&&(includeCheck="true"==e.UglifyJS),$("#mSimulationOptionsUglifyJS").prop("checked",includeCheck);{const t=e.AuxiliaryFiles;for(n="",d=0;d<t.length;d++){n+="<option>"+t[d].trim()+"</option>"}$("#mSimulationOptionsUserFiles").html(n),$("#mSimulationOptionsUserFilesAdd").click((t=>{$("#mFileChooserModal").data("bs-target","#sMainSimulationOptionsModal").data("bs-toggle","modal").data("bs-dismiss","modal"),WebEJS_TOOLS.selectFile(null,(function(t){t.startsWith("/")||t.startsWith("./")||(t="./"+t);const e=$("<option>",{text:t});$("#mSimulationOptionsUserFiles").append(e),e.attr("selected",!0)}),!1,null,!0)})),$("#mSimulationOptionsUserFilesDelete").click((t=>{$("#mSimulationOptionsUserFiles option:selected").remove()}))}c(e.DetectedFiles),$("#mSimulationOptionsDetectedFilesRefresh").click((e=>{t.updateDetectedFiles()})),$("#mSimulationOptionsHtmlHead").val(e.HTMLHead),$("#mSimulationOptionsEditorFullModel").prop("checked","true"==e.PreviewFullModel),$("#mSimulationOptionsEditorParse").prop("checked","true"==e.UseInterpreter),$("#mSimulationOptionsEditorUseDelta").prop("checked","true"==e.UseDeltaForODE)}function u(){n.Title=$("#mSimulationOptionsTitle").val(),n.Author=[],n.AuthorLogo=[];for(var t=0;t<a.length;t++)n.Author.push(a[t].name),n.AuthorLogo.push(a[t].logo);n.Keywords=$("#mSimulationOptionsKeywords").val(),n.Abstract=$("#mSimulationOptionsAbstract").val(),n.Copyright=$("#mSimulationOptionsCopyright").val(),n.Level=$("#mSimulationOptionsLevel").val(),n.Language=$("#mSimulationOptionsLanguages").val(),n.Logo=[];for(t=0;t<i.length;t++)n.Logo.push(i[t].logo);n.RunAlways=$("#mSimulationOptionsEditorMustPause").is(":checked")?"false":"true",n.ModelTab=$("#mSimulationOptionsModelTab").val(),n.ModelTabTitle=$("#mSimulationOptionsModelTabTitle").val(),n.ModelName=$("#mSimulationOptionsModelName").val(),n.FixedNavigationBar=$("#mSimulationOptionsFixedNavigationBar").is(":checked")?"false":"true",n.IncludeSource=$("#mSimulationOptionsIncludeSource").is(":checked")?"true":"false",n.IncludeLibrary=$("#mSimulationOptionsIncludeLibrary").is(":checked")?"true":"false",n.SaveInXMLFormat=$("#mSimulationOptionsSaveAsXML").is(":checked")?"true":"false",n.UglifyJS=$("#mSimulationOptionsUglifyJS").is(":checked")?"true":"false",n.CSSFile=$("#mSimulationOptionsCSS").val(),n.AuxiliaryFiles=[],$("#mSimulationOptionsUserFiles > option").each((function(){n.AuxiliaryFiles.push(this.text)})),n.DetectedFiles=[],$("#mSimulationOptionsDetectedFiles > option").each((function(){n.DetectedFiles.push(this.text)})),n.HTMLHead=$("#mSimulationOptionsHtmlHead").val(),n.PreviewFullModel=$("#mSimulationOptionsEditorFullModel").is(":checked")?"true":"false",n.UseInterpreter=$("#mSimulationOptionsEditorParse").is(":checked")?"true":"false",n.UseDeltaForODE=$("#mSimulationOptionsEditorUseDelta").is(":checked")?"true":"false"}t.setAuthorInfo=function(t){t.name&&(o++,a.push({name:t.name,logo:t.logo,hash:o}),n.Copyright=t.name,t.affiliation&&(n.Copyright+=", "+t.affiliation),t.contact&&(n.Abstract="Contact: "+t.contact),d(n))},t.readObject=function(t){"PreviewFullModel"in t||(t.PreviewFullModel="false"),a=[],o=0;const l=t.Author;if(l&&l.length>0){authorsLogo=t.AuthorLogo;for(var r=0;r<l.length;r++){var c=authorsLogo&&r<authorsLogo.length?authorsLogo[r]:"";o++,a.push({name:l[r],logo:c,hash:o})}}i=[],s=0;const u=t.Logo;if(u)for(r=0;r<u.length;r++)s++,i.push({logo:u[r],hash:s});n=t,e&&d(n),$("#sPreviewFullModel").prop("checked","true"==n.PreviewFullModel)},t.saveObject=function(){return e&&u(),t.updateDetectedFiles(),n},t.getDetectedFiles=function(){e&&u();var t=[];t.push(...n.AuthorLogo),t.push(...n.Logo);const a=n.CSSFile.trim();return a.length>0&&t.push(a),t},t.getTitle=function(){return e?$("#mSimulationOptionsTitle").val():n.Title},t.useDeltaForODEs=function(){return e?$("#mSimulationOptionsEditorUseDelta").is(":checked"):"true"==n.UseDeltaForODE},t.previewFullModel=function(){return $("#sPreviewFullModel").is(":checked")},t.updateDetectedFiles=function(){var t=sMainGUI.getDetectedFiles();const a=[...new Set(t)];t=[];for(var o=0;o<a.length;o++){const e=a[o].trim();e.length<=0||(e.startsWith("/")||e.startsWith('"/')||e.startsWith("%")||t.push(e))}const i=t.sort();return e?c(i):n.DetectedFiles=i,i},t.addToDetectedFiles=function(t){var e=!1;if(console.log("Checking detected file : "+t),t.startsWith("./")||(t="./"+t),console.log("Actually file : "+t),$("#mSimulationOptionsDetectedFiles > option").each((function(){if(this.text==t)return e=!0,!1})),!e){const e=$("<option>",{text:t});$("#mSimulationOptionsDetectedFiles").append(e),e.attr("selected",!0)}},t.getRequiredFiles=function(){var a=t.updateDetectedFiles();e?$("#mSimulationOptionsUserFiles > option").each((function(){a.push(this.text)})):a.push(...n.AuxiliaryFiles);return[...new Set(a)].sort()};const p='\n\t<div class="sMainSimulationOptionsDialog dialog-sm">\n\t\t\t\t\n\t\t\t\t\x3c!-- begin tab headers --\x3e\n\t\t\t\t<ul class="nav nav-tabs" role="tablist">\n\t\t\t  \t<li class="nav-item" role="presentation">\n\t     \t\t\t<button class="sTranslatable nav-link active" id="mSimulationOptionsEditorMetadataTab" \n\t\t\t \t\t  \t\tdata-bs-toggle="tab" data-bs-target="#mSimulationOptionsEditorMetadataDiv"  \n\t     \t\t\t  \ttype="button" role="tab" aria-controls="mSimulationOptionsEditorMetadataDiv" aria-selected="true">\n\t     \t\t\t  \tMetadata\n\t     \t\t\t </button>\n\t    \t\t</li>\n\t\t\t  \t<li class="nav-item" role="presentation">\n\t     \t\t\t<button class="sTranslatable nav-link " id="mSimulationOptionsEditorRunningTab" \n\t\t\t\t\t\t \t\tdata-bs-toggle="tab" data-bs-target="#mSimulationOptionsEditorRunningDiv"  \n\t   \t\t\t\t\t \ttype="button" role="tab" aria-controls="mSimulationOptionsEditorRunningDiv" aria-selected="false">\n     \t\t\t\t\t Run options\n\t     \t\t\t</button>\n\t    \t\t</li>\n\t\t\t  \t<li class="nav-item" role="presentation">\n\t\t\t\t\t\t<button class="sTranslatable nav-link" id="mSimulationOptionsEditorExportTab" \n\t\t\t\t\t\t\t\tdata-bs-toggle="tab" data-bs-target="#mSimulationOptionsEditorExportDiv"  \n\t\t\t\t\t\t\t\ttype="button" role="tab" aria-controls="mSimulationOptionsEditorExportDiv" aria-selected="false">\n\t\t\t\t\t\t\tExport options\n\t\t\t\t\t\t</button>\n\t\t\t\t </li>\n\t\t\t\t <li class="nav-item" role="presentation">\n\t     \t\t\t<button class="sTranslatable nav-link" id="mSimulationOptionsEditorEditTab" \n\t\t\t \t\t  \t\tdata-bs-toggle="tab" data-bs-target="#mSimulationOptionsEditorEditDiv"  \n\t     \t\t\t  \ttype="button" role="tab" aria-controls="mSimulationOptionsEditorEditDiv" aria-selected="false">\n\t     \t\t\t  Edit options\n\t     \t\t\t</button>\n\t    \t\t</li>\n\t\t\t\t</ul> \n\t\t\t\t\x3c!-- end tab headers --\x3e\n\t     \t\t\t\n\t\t\t\t\x3c!-- begin tab content --\x3e\n\t\t\t\t<div class="tab-content">\n\t\t\t \t\t  \t\n\t\t\t \t\t\x3c!-- begin METADATA content --\x3e\n\t\t\t \t\t<div class="tab-pane fade show active" id="mSimulationOptionsEditorMetadataDiv" \n\t\t\t \t\t\t   role="tabpanel" aria-labelledby="mSimulationOptionsEditorMetadataTab">\n\t\t\t \t\t\t  \t\t\t\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsTitleLabel" class="sTranslatable input-group-text">Title</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsTitle" type="text" class="form-control" placeholder="Enter title here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Title" aria-describedby="mSimulationOptionsTitleLabel">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span class="sTranslatable input-group-text">Author</span>\n\t\t\t\t\t    <select id="mSimulationOptionsAuthor" class="form-select"></select>\n\t\t\t\t\t\t  <span id="mSimulationOptionsAuthorAdd" \t\tclass="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Add">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-plus" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t  <span id="mSimulationOptionsAuthorEdit" \tclass="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Edit">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-data" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t  <span id="mSimulationOptionsAuthorDelete" class="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Delete">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-x" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2">\n\t\t\t\t\t\t\t<span id="mSimulationOptionsAuthorLogoGallery" class="btn-group btn-group-sm" role="group" aria-label="AuthorLogoGallery">\n\t\t\t\t\t\t\t</span>\n        \t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsKeywordsLabel" class="sTranslatable input-group-text">Keywords</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsKeywords" type="text" class="form-control" placeholder="Enter keywords here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Keywords" aria-describedby="mSimulationOptionsKeywordsLabel">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t        \t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\x3c!-- div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsAbstractLabel" class="sTranslatable input-group-text">Abstract</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsAbstract" type="text" class="form-control" placeholder="Enter abstract here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Abstract" aria-describedby="mSimulationOptionsAbstractLabel">\n\t\t\t\t\t\t</div --\x3e\n\n\t\t\t\t\t\t<div class="mt-2 form-floating">\n\t\t\t\t\t\t  <textarea  id="mSimulationOptionsAbstract" class="form-control" placeholder="Enter abstract here"style="height: 100px"></textarea>\n\t\t\t\t\t\t  <label class="sTranslatable" for="mSimulationOptionsAbstract">Comments</label>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsCopyrightLabel" class="sTranslatable input-group-text">Copyright</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsCopyright" type="text" class="form-control" placeholder="Enter copyright here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Copyright" aria-describedby="mSimulationOptionsCopyrightLabel">\n\t\t\t\t\t\t</div>\n        \t\t\t\t\t\t\t\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsLevelLabel" class="sTranslatable input-group-text">Level</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsLevel" type="text" class="form-control" placeholder="Enter level here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Level" aria-describedby="mSimulationOptionsLevelLabel">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsLanguagesLabel" class="sTranslatable input-group-text">Languages</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsLanguages" type="text" class="form-control" placeholder="Enter languages here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Languages" aria-describedby="mSimulationOptionsLanguagesLabel">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span class="sTranslatable input-group-text">Logo</span>\n\t\t\t\t\t    <select id="mSimulationOptionsLogo" class="form-select"></select>\n\t\t\t\t\t\t  <span id="mSimulationOptionsLogoAdd" \t\tclass="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Add">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-plus" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t  <span id="mSimulationOptionsLogoDelete" class="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Delete">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-x" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2">\n\t\t\t\t\t\t\t<span id="mSimulationOptionsLogoGallery" class="btn-group btn-group-sm" role="group" aria-label="SimulationLogoGallery">\n\t\t\t\t\t\t\t</span>\n        \t\t</div>\n\n\t\t\t \t\t</div>\n\t\t\t \t\t\x3c!-- end METADATA content --\x3e\n\n\t\t\t\t\t\x3c!-- begging RUNNING content --\x3e\n\t\t\t\t\t<div class="tab-pane fade show " id="mSimulationOptionsEditorRunningDiv" \n\t\t\t \t\t\t  \trole="tabpanel" aria-labelledby="mSimulationOptionsEditorRunningTab">\n\t\t\t \t\t\t  \t\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsEditorMustPause" id="mSimulationOptionsEditorMustPause">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsEditorMustPause">\n\t\t\t\t\t\t\t\tThe simulation must pause if the page loses focus\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\t\t\t \t\t\t  \t\n\n\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsModelTabLabel" class="sTranslatable input-group-text">Simulation Tab</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsModelTab" type="text" class="form-control" placeholder="Enter tab number here" \n  \t\t\t\t\t\t\t\t\t\taria-label="ModelTab" aria-describedby="mSimulationOptionsModelTabLabel">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsModelTabTitleLabel" class="sTranslatable input-group-text">Simulation Tab Title</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsModelTabTitle" type="text" class="form-control" placeholder="Enter tab title here" \n  \t\t\t\t\t\t\t\t\t\taria-label="ModelTabTitle" aria-describedby="mSimulationOptionsModelTabTitleLabel">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsModelNameLabel" class="sTranslatable input-group-text">Simulation Name</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsModelName" type="text" class="form-control" placeholder="Enter simulation name here" \n  \t\t\t\t\t\t\t\t\t\taria-label="ModelName" aria-describedby="mSimulationOptionsModelNameLabel">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsFixedNavigationBar" id="mSimulationOptionsFixedNavigationBar">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsFixedNavigationBar">\n\t\t\t\t\t\t\t\tEJS Reader\'s navigation bar ignores double-clicks\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\t\t\t \t\t\t  \t\n\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsCSSLabel" class="sTranslatable input-group-text">CSS</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsCSS" type="text" class="form-control" readonly \n  \t\t\t\t\t\t\t\t\t\taria-label="Languages" aria-describedby="mSimulationOptionsCSSLabel">\n\t\t\t\t\t\t  <span id="mSimulationOptionsCSSEdit" \t\tclass="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Edit">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-data" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t  <span id="mSimulationOptionsCSSDelete" class="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Delete">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-x" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span class="sTranslatable input-group-text">User files</span>\n\t\t\t\t\t    <select id="mSimulationOptionsUserFiles" class="form-select"></select>\n\t\t\t\t\t\t  <span id="mSimulationOptionsUserFilesAdd" \t\tclass="input-group-text"\n        \t\t\t\t\t\tdata-bs-target="#mFileChooserModal" data-bs-toggle="modal" data-bs-dismiss="modal"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Add">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-plus" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t  <span id="mSimulationOptionsUserFilesDelete" class="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Delete">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-x" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t \t\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span class="sTranslatable input-group-text">Files required</span>\n\t\t\t\t\t    <select id="mSimulationOptionsDetectedFiles" class="form-select"></select>\n\t\t\t\t\t\t  <span id="mSimulationOptionsDetectedFilesRefresh" class="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Refresh">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-data" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t \n\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t<div class="mt-2 form-floating">\n\t\t\t\t\t\t  <textarea  id="mSimulationOptionsHtmlHead" class="form-control" placeholder="Enter html head here" style="height: 100px"></textarea>\n\t\t\t\t\t\t  <label class="sTranslatable" for="mSimulationOptionsHtmlHead">HTML head</label>\n\t\t\t\t\t\t</div>\n\n\t\t\t \t\t</div>\n\t\t\t \t\t\x3c!-- end RUNNING content --\x3e\n\n\t\t\t\t\t\x3c!-- begin EXPORT content --\x3e\n\t\t\t\t\t<div class="tab-pane fade show" id="mSimulationOptionsEditorExportDiv" role="tabpanel"\n\t\t\t\t\t\taria-labelledby="mSimulationOptionsEditorExportTab">\n\t\t\t\t\t\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsSaveAsXML" id="mSimulationOptionsSaveAsXML">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsSaveAsXML">\n\t\t\t\t\t\t\t\tSave the source file in EJS 6 format rather than WebEJS format<br>\n\t\t\t\t\t\t\t\t<small>\n\t\t\t\t\t\t\t\t\tNote that EJS 6 uses an XML file to describe the model whereas WebEJS uses a JSON file.\n\t\t\t\t\t\t\t\t\tNew WebEJS options may not be available if the model is exported in EJS 6 format.\n\t\t\t\t\t\t\t\t</small>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\t\t\t \t\t\t  \t\n\t\t\t\t\t\n            <div class="form-check mt-3 mx-0">\n\t\t\t\t\t\t\t\tWhen exporting the complete model\'s ZIP:\n\t\t\t\t    </div>\t\n\n            \x3c!---div class="form-check mt-2 mx-4">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsUseIndexHtml" id="mSimulationOptionsUseIndexHtml">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsUseIndexHtml">\n\t\t\t\t\t\t\t\tUse the simulation HTML file as \'index.html\'\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div---\x3e\t\n\n\t\t\t\t\t\t<div class="form-check mt-2 mx-4">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsIncludeSource" id="mSimulationOptionsIncludeSource">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsIncludeSource">\n\t\t\t\t\t\t\t\tInclude the source file\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\t\t\t \t\t\t  \t\n\n\t\t\t\t\t\t<div class="form-check mt-2 mx-4">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsIncludeLibrary" id="mSimulationOptionsIncludeLibrary">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsIncludeLibrary">\n\t\t\t\t\t\t\t\tInclude all EJS libraries<br>\n\t\t\t\t\t\t\t\t<small>\n\t\t\t\t\t\t\t\t\tThe models ZIP file will be smaller if the EJS libraries are excluded \n\t\t\t\t\t\t\t\t\tbecause the EJS libraries will be downloaded from the Internet when the \n\t\t\t\t\t\t\t\t\tmodels HTML page is run. This is fast and the files are cached in most \n\t\t\t\t\t\t\t\t\tbrowsers. Include the EJS libraries if you intend to run the HTML page \n\t\t\t\t\t\t\t\t\twithout an internet connection.<br><br>\n\t\t\t\t\t\t\t\t</small>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\t\t\t \t\t\t  \t\n\n\t\t\t\t\t\t\x3c!--div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" name="mSimulationOptionsUglifyJS"\n\t\t\t\t\t\t\t\tid="mSimulationOptionsUglifyJS">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsUglifyJS">\n\t\t\t\t\t\t\t\tUglify the Javacript code in the generated model\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div--\x3e\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- end EXPORT content --\x3e\n\t\t \n\t\t\t\t \t\x3c!-- begin EDITION content --\x3e\n\t\t\t \t\t<div class="tab-pane fade show" id="mSimulationOptionsEditorEditDiv" \n\t\t\t \t\t\t   role="tabpanel" aria-labelledby="mSimulationOptionsEditorEditTab">\n\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" \n\t\t\t\t\t\t\t\t name="mSimulationOptionsEditorFullModel" id="mSimulationOptionsEditorFullModel">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsEditorFullModel">\n\t\t\t\t\t\t\t\tShow full model in the preview area\ton load\t\t\t\t\t\t\n\t\t\t\t\t\t\t</label>\t\t\t\t\t\t\t\n\t\t\t\t \t\t</div>\t\n\t\t\t\t \t\t\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" \n\t\t\t\t\t\t\t\t name="mSimulationOptionsEditorParse" id="mSimulationOptionsEditorParse">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsEditorParse">\n\t\t\t\t\t\t\t\tParse custom method with an interpreter\n\t\t\t\t\t\t\t</label>\t\t\t\t\t\t\t\n\t\t\t\t \t\t</div>\t\n\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" \n\t\t\t\t\t\t\t\t name="mSimulationOptionsEditorUseDelta" id="mSimulationOptionsEditorUseDelta">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsEditorUseDelta">\n\t\t\t\t\t\t\t\tUse &#916; for ODEs\n\t\t\t\t\t\t\t</label>\t\t\t\t\t\t\t\n\t\t\t\t \t\t</div>\t\t\t \t\n\t\t\t\t \t\t\n\t\t\t \t\t</div>\t\t\t \t\n\t\t\t\t \t\x3c!-- end EDITION content --\x3e\n\t\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- end tab content --\x3e\n\t\n\t</div>\n  ';return t},(WebEJS_GUI=WebEJS_GUI||{}).outputArea=function(){var t={};function e(t,e){const n=$('<p class="m-0 '+t+'"></p>');var a;n.text(e),$("#sOutputTextarea").append(n),(a=$("#sOutputTextarea")).scrollTop(a[0].scrollHeight-a[0].clientHeight)}return t.println=function(t){e("text-dark",t)},t.logLine=function(t){e("text-dark",t)},t.infoLine=function(t){e("text-primary",t)},t.warningLine=function(t){e("text-warning",t)},t.errorLine=function(t){e("text-danger",t)},t.clear=function(){$("#sOutputTextarea").empty()},$("#sOutputClearButton").click((()=>{t.clear()})),t.clearAndPrintln=function(e){t.clear(),t.println(e)},t},(WebEJS_GUI=WebEJS_GUI||{}).previewArea=function(){var t={};function e(t){const e=sMainSimulationOptions.previewFullModel()?"FULL MODEL":"PREVIEW";$("#sPreviewTitle").text(sLocaleFor(e)+": "+t)}function n(){const t={useCDN:!0,separatePage:!1,fullModel:sMainSimulationOptions.previewFullModel()};var n;return e(sMainGUI.getTitleForPreview()),n=WebEJS_GEN.generate(t),$("#sPreviewFrame").attr("srcdoc",n),!1}return t.clearPreview=function(t){$("#sPreviewFrame").attr("src",sMainAssetsURL+"WebEJS/EmptyView/empty_view.html"),$("#sPreviewTitle").text(t)},t.updatePreview=function(){n()},t.reportPreview=function(t){n()},t.runSimulation=function(){window.open(URL.createObjectURL(new Blob([WebEJS_GEN.generate({useCDN:!0,separatePage:!0,fullModel:!0})],{type:"text/html"})))},t},(WebEJS_GUI=WebEJS_GUI||{}).tabbedPage=function(t){var e={},n=t,a=jQuery("<div/>",{style:"padding:0"});return e.setTitle=function(t){n=t},e.getTitle=function(){return n},e.getDiv=function(){return a},e.prepareToShow=function(){},e.saveObject=function(){return{title:t}},e.readObject=function(t){mLabel=t.title},e},WebEJS_GUI.tabbedPanel=function(t,e){WebEJS_RESOURCES.main();var n={};const a="<li class='sTabsLi'><a class='sTabsA' href='#{href}'>#{label}</a><span class='ui-icon ui-icon-close' role='presentation'>Remove Tab</span></li>",o=t+"-tabs";var i,s=0,l={},r=jQuery("<div/>",{class:e+" sWorkPanel"}),c=jQuery("<div/>",{id:o}).appendTo(r),d=jQuery("<ul/>",{class:" sTabList"}).appendTo(c),u=jQuery("<div/>",{class:"sTabDialog",title:gettext("Create new page")});jQuery("<div/>",{class:"sTabDialog",title:gettext("Delete page"),html:"<p><span class='ui-icon ui-icon-alert' style='float:left; margin:12px 12px 20px 0;'></span>"+gettext("This page will be permanently deleted")+". "+gettext("Are you sure?")+"</p>"});function p(){d.empty();for(const t in l)$(t).remove();var t;l={},t=jQuery("<button/>",{text:"+",class:"sTabAdd"}),i.find(".ui-tabs-nav").append(t),t.on("click",(function(){document.getElementById(o+"-tab_title").value=gettext("Page")+" "+(s+1),u.dialog("open")})),-1,s=0,i.tabs("refresh")}return n.getMainPanel=function(){return r},n.prepareToShow=function(){},n.saveObject=function(){var t=[];return $("> ul > li > a","#"+o).each((function(){var e=l[$(this).attr("href")];t.push(e.saveObject())})),t},n.readObject=function(t){p();for(var e=0;e<t.length;e++){var a=t[e];n.createPage(a.title).readObject(a)}n.setActive(0)},n.createPage=function(t){alert("Subclasses of Tabs should overwrite the createPage() function!!!")},n.addTab=function(t){var e=o+"-"+(s+1),n="#"+e,r=$(a.replace(/#\{href\}/g,n).replace(/#\{label\}/g,t.getTitle())),d=t.getDiv();return i.find(".ui-tabs-nav").append(r),d.attr("id",e),d.addClass("sTabContent"),c.append(d),i.tabs("refresh"),s++,l[n]=t,e},n.setActive=function(t){i.tabs("option","active",t)},n.getActive=function(){return i.tabs("option","active")},n},(WebEJS_GUI=WebEJS_GUI||{}).viewPropertyEditor=function(t,e,n){var a={};const o="mViewPropertyEditor_"+(n.hash>=0?n.hash:"root_properties");var i=null,s=!0,l=0,r=[];const c={width:Math.min(.9*window.innerWidth,1200),height:Math.min(.9*window.innerHeight,1200)};a.show=function(){i&&(i.resize(c),i.reposition(),i.front())},a.hide=function(){s=!1,i&&i.close()};{const a={content:function(){l=0,r=[];const e=t.getElementClassEditionInfo(n.type),a=t.getElementClassProperties(n.type,null);var i="",s="";for(var c in e){const t=e[c],n=0==c?" show active":"";i+='<li class="nav-item" role="presentation"><button class="sTranslatable nav-link'+(0==c?" active":"")+'" id="'+o+"TabHeader_"+c+'" data-bs-toggle="tab" data-bs-target="#'+o+"TabDiv_"+c+'" type="button" role="tab" aria-controls="'+o+"TabDiv_"+c+'" aria-selected="true">'+sMainResources.getString(t.label)+" </button></li>",s+='<div class="tab-pane cPropertyEditorTabDiv fade'+n+'" id="'+o+"TabDiv_"+c+'" role="tabpanel" aria-labelledby="'+o+"TabHeader_"+c+'">'+g(t,a)+"</div>"}return html='<div><ul class="nav nav-tabs" role="tablist">'+i+'</ul><div class="tab-content" id="'+o+'Contents">'+s+"</div></div>",html}(),onbeforeclose:function(t){return s&&e.clearPropertyEditor(n.hash),!0},footerToolbar:'<button type="button" id="'+o+'Button" class="sTranslatable btn btn-primary float-left">Done</button>',callback:function(a){$("#"+o+"Button").click((function(){i.close()})),function(){for(var t=0;t<r.length;t++){var e=r[t];$("#"+e[0]).val(e[1])}r=[]}(),$("#"+o+"Contents .cViewPropertyEditorInput").change((t=>{const a=$(t.target).closest(".input-group").data("name"),o=$(t.target).val().trim();e.setPropertyByName(a,o,n.hash)})),$("#"+o+"Contents .cViewPropertyEditorEditIcon").click((a=>{const o=$(a.target).closest(".input-group"),i=o.data("name"),s=o.data("types"),l=o.data("modifiers"),r=o.find(".cViewPropertyEditorInput").first(),c=r?r.val().trim():"",d=function(t){t!=c&&(e.setPropertyByName(i,t,n.hash),r.val(t))},p=u(s,l);return p?p("Edit property",i,c,d):t.isOfType(s,"Action")||t.hasModifier(l,"MULTILINE")?sInputForm.showArea("Edit property",i,c,d,!0):sInputForm.show("Edit property",i,c,d,!0)})),$("#"+o+"Contents .cViewPropertyEditorLinkIcon").click((a=>{const o=$(a.target).closest(".input-group"),i=o.data("name"),s=o.data("types"),l=o.find(".cViewPropertyEditorInput").first(),r=l?l.val().trim():"",c=function(t){t!=r&&(e.setPropertyByName(i,t,n.hash),l.val(t))};t.isOfType(s,"Action")?sMainSelectChoiceForm.show("List of actions",function(){for(var t=sMainGUI.getModel().getCustomCode().getCustomMethods(),e=0;e<t.length;e++)t[e].style="sModelBtn";for(t.push(...sMainGUI.getSystemInformation("model_methods")),t.push(...sMainGUI.getSystemInformation("view_methods")),t.push(...sMainGUI.getSystemInformation("tools_methods")),e=0;e<t.length;e++){var n=t[e].name;const a=n.indexOf("(");a>=0&&(t[e].value="%"+n.substring(0,a)+"%")}return t}(),r,c,"modal-lg"):sMainSelectChoiceForm.show("List of suitable variables",function(e){const n=t.getPropertyTypesList(e);var a=sMainGUI.getModel().getVariables().getVariablesOfType(n),o=[];n.includes("boolean")&&(o.push({name:"_isPlaying",description:"Whether the simulation is playing"}),o.push({name:"_isPaused",description:"Whether the simulation is paused"}),o.push({name:"_isMobile",description:"Whether the simulation is running on a mobile device"}));for(var i=0;i<a.length;i++){const t=a[i],e="("+t.type+t.dimension+") : "+t.comment;o.push({name:t.name,value:t.name,description:e,style:"sModelBtn"})}var s=sMainGUI.getModel().getCustomCode().getCustomMethods();for(i=0;i<s.length;i++){const t=s[i];t.style="text-secondary",o.push(t)}if(n.includes("String"))for(i=0;i<o.length;i++){var l=o[i].name;const t=l.indexOf("(");t>=0&&(o[i].value="%"+l.substring(0,t)+"%")}return o}(s),r,c)})),$("#"+o+"Contents .cViewPropertyEditorLabel").click((e=>{!function(e){const a=t.getElementClassProperties(n.type,null),o=t.getPropertyDescription(e,a),i=t.getPropertyDefaultValue(o),s=t.getPropertyTypesString(o).replaceAll("|",", "),l="<none>"==i?'<span class="fw-bold text-primary">'+sLocaleFor("No particular default value")+"</span>":'<span class="fw-bold text-primary">'+sLocaleFor("Default value")+' = </span><span class="text-danger font-monospace">'+i+"</span>",r=sLocaleFor("Property")+" "+e+" ("+n.type+")",c='<hr><p><span class="fw-bold text-primary">'+sLocaleFor("Types accepted")+' : </span><span class="text-danger font-monospace">'+s+"</span></p><p>"+l+'</p><hr><a class="fw-bold text-success" href="'+t.getWikiHelpPage(n.type)+'" target="_blank">'+sLocaleFor("Click for help on")+" "+n.type+"</a>";sMessageForm.showAllRaw(r,c)}($(e.target).closest(".input-group").data("name"))}))}};var d=sMainResources.getString("Properties for")+" "+n.name;n.type&&(d+=" ("+n.type+")"),i=WebEJS_TOOLS.createJSPanel(d,a,{minimize:"remove"},c)}function u(e,n){const a=t.getPropertyTypesList(e),o=t.getPropertyModifiersList(n);return WebEJS_GUI.viewPropertyTypeEditor(a,o)}function p(e,a,i){var s="",r="bi-keyboard",c=!0,d="bi-link",p="",m="";if(null==i)sMainGUI.println(sMainResources.getString("WARNING: property not recognized for elements of this type!")+": <"+a+"> ("+n.type+")"),s="text-secondary";else{const n=t.getPropertyTypesString(i),g=t.getPropertyModifiersString(i);r=u(n,g)?"bi-clipboard-data":"bi-keyboard",c=!t.hasPropertyModifier(i,"CONSTANT");const h=t.isPropertyOfType(i,"Action");h||t.hasPropertyModifier(i,"MULTILINE")?(d="bi-gear",h&&(s="text-danger"),p='<textarea id="'+e+'"  class="cViewPropertyEditorInput form-control form-control-sm" rows="1"  aria-label="'+a+'" aria-describedby="'+o+"Property_"+l+'"></textarea>'):p='<input id="'+e+'" type="text" class="cViewPropertyEditorInput form-control form-control-sm" '+sMainNoAutocorrect+' aria-label="'+a+'" aria-describedby="'+o+"Property_"+l+'">',m=' data-types="'+n+'" data-modifiers="'+g+'" '}return'<div class="mb-0 input-group input-group-sm" data-name="'+a+'" '+m+'><span id="'+o+"Property_"+l+'" class="cViewPropertyEditorLabel sTranslatable input-group-text input-group-text-sm '+s+'" >'+sMainResources.getString(a)+"</span>"+p+'<span class="cViewPropertyEditorEditIcon input-group-text input-group-text-sm"><i class="bi '+r+'" style="color: black;"></i></span><span class="cViewPropertyEditorLinkIcon input-group-text input-group-text-sm"><i class="bi '+d+'" style="color: black;"'+(c?"":" disabled ")+"></i></span></div>"}function m(a,i){for(var s="",c=0;c<a.length;c++){var d=a[c];if(d.startsWith("<LABEL")){const t=d.substring(6,d.length-1);s+='<div class="my-0 text-center"><label class="my-0 form-label text-center fw-bold text-primary">'+sMainResources.getString(t)+"</label></div>"}else if("<SEP>"==d)s+='<hr class="my-0">';else{l++;const a=e.getPropertyByName(d,n.properties),c=o+"PropertyInput_"+l;null!=a&&r.push([c,a]),s+=p(c,d,t.getPropertyDescription(d,i))}}return s}function g(t,e){for(var n="",a=0;a<t.columns.length;a++){n+='<div class="col cViewPropertyEditorColumn">'+m(t.columns[a],e)+"</div>"}return'<div class="container"><div class="row">'+n+"</div></div>"}return a},(WebEJS_GUI=WebEJS_GUI||{}).viewPropertyTypeEditor=function(t,e){if(t.includes("Color")||t.includes("Color3D"))return function(t,e,n,a){sMainEditorForColor.show(t,n,a)};if(t.includes("Font"))return function(t,e,n,a){sMainEditorForFont.show(t,n,a)};if(t.includes("File"))return function(n,a,o,i){var s=null;e.includes("BASE64_IMAGE")&&(s=WebEJS_GUI.viewPropertyFileHelperHtml());var l=[];t.includes("ImageFile")&&l.push(...WebEJS_TOOLS.IMAGE_FORMATS),t.includes("VideoFile")&&l.push(...WebEJS_TOOLS.VIDEO_FORMATS),t.includes("AudioFile")&&l.push(...WebEJS_TOOLS.AUDIO_FORMATS),WebEJS_TOOLS.selectFile(l,(function(t,e){const n=t.startsWith('"')?t:'"'+t+'"';n!=o&&(i(n),sMainSimulationOptions.updateDetectedFiles())}),!0,s)};var n=[];function a(t,e){for(var a=0;a<e.length;a++){const l=e[a];var o=l,i=null;Array.isArray(l)&&(o=l[0],i=l[1]);var s={name:'"'+o+'"',icon:'<img class="d-inline-block align-bottom;" style="padding: 0 2px 0 2px;" src="'+sMainGUI.getSystemIconURL("Editors/"+t+"_"+o.toUpperCase()+".gif")+'">'};i&&(s.old_names='"'+i+'"'),n.push(s)}}return t.includes("boolean")&&n.push({name:"true",icon:'<i class="bi bi-check-circle"></i>'},{name:"false",icon:'<i class="bi bi-x-circle"></i>'}),t.includes("3DDecorationType")&&a("Decoration",["NONE","AXES","CUBE","CENTERED_AXES"]),t.includes("3DDraggable")&&a("3DDraggable",["NONE","ANY","AZIMUTH","ALTITUDE"]),t.includes("3DProjectionType")&&a("DisplayMode",["PLANAR_XY","PLANAR_XZ","PLANAR_YZ","PERSPECTIVE_OFF","PERSPECTIVE_ON"]),t.includes("ArrowMark")&&a("ArrowStyle",["NONE","ANGLE","CIRCLE","RECTANGLE","LINE","CURVE","TRIANGLE","DIAMOND","WEDGE","POINTED","INVANGLE","INVTRIANGLE"]),t.includes("CursorShape")&&a("CursorShape",["HORIZONTAL","VERTICAL","CROSSHAIR"]),t.includes("GraphicsMode")&&a("GraphicsMode",["SVG","CANVAS"]),t.includes("Interaction2D")&&a("Interaction2D",["ENABLED_NONE","ENABLED_ANY","ENABLED_X","ENABLED_Y","ENABLED_NO_MOVE"]),t.includes("MarkType")&&a("MarkerShape",["ELLIPSE","RECTANGLE","AREA","BAR"]),t.includes("MeshDataType")&&a("MeshDataType",["MESH_2D","MESH_3D","SCALAR_2D_FIELD","SCALAR_3D_FIELD","VECTOR_2D_FIELD","VECTOR_3D_FIELD"]),t.includes("Offset")&&a("JSArrowPosition",["SOUTH_WEST","CENTERED","NORTH_EAST"]),t.includes("Orientation")&&a("Orientation",["HORIZONTAL","VERTICAL"]),t.includes("Position")&&a("ElementPosition",["CENTERED",["NORTH","hor_centered|hor_centered_down"],["SOUTH","hor_centered_up"],["EAST","ver_centered_left"],["WEST","ver_centered|ver_centered_right"],"NORTH_EAST",["NORTH_WEST","upper_left"],"SOUTH_EAST",["SOUTH_WEST","lower_left"]]),t.includes("ShapeType")&&a("MarkerShape",[["NONE","no_marker"],["ELLIPSE","circle|filled_circle"],["RECTANGLE","square|filled_square"],"ROUND_RECTANGLE","WHEEL"]),t.includes("TextAlign")&&a("Alignment",["left","center","right","justify"]),t.includes("ScaleType")&&a("ScaleType",["SCALE_NUM","SCALE_LOG"]),n.length>0?function(t,e,a,o){sMainSelectChoiceForm.show(e,n,a,o,null)}:null},WebEJS_GUI.viewPropertyFileHelperHtml=function(){function t(t){t.indexOf(".")<0&&(t+=".gif");const e="/org/opensourcephysics/resources/controls/images/"+t;return'<img class="cFileChooserHelperImage p-0 d-inline-block align-bottom;" width="16" height="16" src="'+sMainGUI.getSystemIconURL(e)+'" data-value="'+e+'">'}const e=["play","pause","stop","stepforward","stepback","continue","reset","initial","reset1","reset2","cycle","clear","forward","time","notime","close","folder","inspectfolder","window","inspect","value","hilite","erase","i_erase","caution","wrench","wrench_monkey","pdf","power_on.png","power_off.png","expand.png","download.png","center","apple.png","android.png"];for(var n=1,a='<div class="container m-0 p-0"><div class="row m-0 p-0">',o=0;o<e.length;o++)a+='<div class="col m-0 p-0">'+t(e[o])+"</div>",n>=3?(n=1,a+="</div>",o+1<e.length&&(a+='<div class="row m-0 p-0">')):n++;if(n>1){for(;n<=3;n++)a+='<div class="col m-0 p-0"></div>';a+="</div>"}return a+="</div>"},(WebEJS_GUI=WebEJS_GUI||{}).viewTree=function(t,e){const n="sViewTree-item-",a="sViewTree-group-",o="bi bi-chevron-down",i="bi bi-chevron-right",s="bi bi-dash",l="0.25rem",r="Root",c=WebEJS_TOOLS.textTools();function d(t){return t>0?(.5+.5*t).toString()+"rem":l}var u,p={},m={},g=0,h={},f={},b=[];function v(t,e){const n=w(e),a=I(e),o=R(e),i=h[n];var s={Name:a,Type:L(e)};if(o&&(s.Expanded=""+o.hasClass("show")),i&&(s.Properties=i),t.push(s),o){var l=[];o.children(".list-group-item").each((function(t,e){v(l,$(e))})),s.Children=l}}function E(t,e,n){const a=w(e),o=I(e),i=R(e),s=h[a];var l={Name:o,Type:L(e)};n&&(l.Parent=n),i&&(l.Expanded=""+i.hasClass("show")),s&&(l.Properties=s),t.push(l),i&&i.children(".list-group-item").each((function(e,n){E(t,$(n),o)}))}function _(t,n,a){const o=w(n),i=R(n),s=h[o];if(s&&s.length>0){const o=e.getElementClassProperties(L(n),a);for(var l=0;l<o.length;l++){const e=o[l];var r=p.getPropertyByName(e.name,s);r&&r.trim().length>0&&((r=r.trim()).startsWith('"')&&(r=r.substring(1)),r.endsWith('"')&&(r=r.substring(0,r.length-1)),t.push(r))}}i&&i.children(".list-group-item").each((function(e,n){_(t,$(n),a)}))}function S(t,e,n){var a=C(n,e.Name,e.Type);t.append(a),h[g]=e.Properties;const o="Children"in e?e.Children:[];if(o.length>0){const t=T(a,"Expanded"in e&&"true"==e.Expanded);g++,n++;for(var i=0;i<o.length;i++)S(t,o[i],n)}else g++}function y(e,n){for(var a={},o=0;o<n.length;o++){var i=n[o],s=i.Type.split(".");i.Type=s[s.length-1];var l,r,c=U(i.Name),d=null;if("Parent"in i&&!("group"in(d=a[i.Parent]))){const t=d.element,e="Expanded"in t&&"true"==t.Expanded;d.group=T(d.tree_item,e)}d?(l=C(r=d.depth+1,c,i.Type),d.group.append(l)):P(e)?(r=0,l=C(0,c,i.Type),t.append(l)):(l=C(r=M(e)+1,c,i.Type),N(e).append(l)),a[i.Name]={tree_item:l,element:i,depth:r},i.Properties&&(h[g]=JSON.parse(JSON.stringify(i.Properties))),g++}a={},p.reportableTreeChange("Paste subtree")}function T(t,e){const l=t.data("hash"),r=$('<div role="group" class="list-group ps-2 collapse'+(e?" show":"")+'"  data-parent="'+n+l+'"  id="'+a+l+'"></div>'),c=e?o:i;return t.find(".state-icon").removeClass(s).addClass(c),t.append(r),r}function C(t,o,i){const s=d(t),l=e.getElementClassIconSRC(i);return $('<div role="treeitem" class="list-group-item py-0 border-0" style="padding-left:'+s+'"  draggable="true" ondragstart="WebEJS_GUI.viewElements_dragFunction(event,\'element\')" data-drag_info="'+g+'"  id ="'+n+g+'" data-type="'+i+'" data-hash="'+g+'" data-depth="'+t+'"  data-bs-target="#'+a+g+'" "aria-level="'+t+'" ><i class="state-icon '+'bi bi-dash"></i><span class="dropdown"><img class="item-icon dropdown" style="padding: 0 2px 0 2px;" src="'+l+'" data-drag_info="'+g+'"  id="mViewItemMenuIcon_'+g+'" type="button" data-bs-toggle="dropdown" aria-expanded="false"></img><ul class="dropdown-menu py-0" aria-labelledby="mViewItemMenuIcon_'+g+'"><li><span class="cViewMenuHeader dropdown-item-text py-0 fw-bold">Menu</span></li><li><hr class="dropdown-divider m-0"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Properties">Properties</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Rename">Rename</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Reparent">Reparent</li><li><hr class="dropdown-divider m-0"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="MoveUp">Move up</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="MoveDown">Move down</li><li><hr class="dropdown-divider m-0"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Cut">Cut</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Copy">Copy</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Paste">Paste</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Remove">Remove</li><li><hr class="dropdown-divider m-0"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="AddCustom">Add to custom</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Help">Help</li></ul></span><span class="sViewTreeElement">'+o+"</span></div>")}function O(t,e){var n=sMainResources.getString("WARNING")+": ";n+=t?sMainResources.getString("Element")+" "+I(t):sMainResources.getString("Root"),n+=" "+sMainResources.getString("does not take children of type")+" "+e+"!",sMainGUI.println(n)}function x(t,n,a){if(t.data("hash")<0)return e.parentAcceptsChild(r,n)?{accept:!0,parent:null}:(O(null,n),{accept:!1});if(e.parentAcceptsChild(L(t),n))return{accept:!0,parent:null};if(a){const a=F(t);if(a&&e.parentAcceptsChild(L(a),n))return{accept:!0,parent:a}}return O(t,n),{accept:!1}}function P(t){return w(t)<0}function w(t){return t.data("hash")}function M(t){return t.data("depth")}function I(t){return t.find(".sViewTreeElement").first().text()}function L(t){return t.data("type")}function R(t){const e=$(t.data("bs-target"));return e.length>0?e.first():null}function F(t){const e=t.closest(".list-group");return e.length>0?$("#"+e.data("parent")):null}function D(t,e){t.css("padding-left",d(e)),t.data("depth",e);const n=R(t);n&&n.children(".list-group-item").each((function(t,n){D($(n),e+1)}))}function A(t,e){const n=R(t),a=e?F(t):null,o=w(t);delete h[o],delete f[o],t.remove(),n&&(n.children(".list-group-item").each((function(t,e){A($(e),!1)})),n.remove()),a&&W(a),p.reportableTreeChange("Delete element")}function k(e){var n=null;return $(t).find(".list-group-item").each((function(t,a){const o=$(a);if(w(o)>=0&&I(o)===e)return n=o,!1})),n}function N(t){const e=$(t.data("bs-target"));return e.length>0?e.first():T(t,!0)}function W(t){if(null!=t){var e=$(t.data("bs-target"));e.length<=0||(e=e.first()).children().length<=0&&(t.find(".state-icon").removeClass(o).removeClass(i).addClass(s),e.remove())}}function J(e,n){const a=n.data("hash");var o=t,i=0;a<0||(o=N(n),i=M(n)+1),D(e,i),o.append(e);const s=R(e);s&&o.append(s),p.reportableTreeChange("Moving"),W(F(e))}function B(t,e){const n=function(t){const e=$("#sViewTree-item-"+t);return e.length>0?e.first():null}(t);if(null==n)return void sMainGUI.println("ERROR: item with hash "+t+" NOT FOUND!!!");const a=L(n),o=F(n),i=x(e,a,!0);if(i.accept)if(i.parent){const t=i.parent;if(t&&t!=n){D(n,M(e)),n.insertBefore(e);const t=R(n);return t&&t.insertBefore(e),p.reportableTreeChange("Reparenting"),W(o)}}else J(n,e);else sMessageForm.showWarning("Move error","Target does not accept children of this type!")}function V(t,e){if(e.length<=0)return;const n=x(t,e[0].Type,!1);n.accept?n.parent?y(n.parent,e):y(t,e):sMessageForm.showWarning("Paste/Drag error","Target does not accept children of this type!")}function U(t){for(var e=1,n=t=c.toValidVariableName(t);k(n);)n=t+"_"+ ++e;return n}function G(t,n){var a=[];const o=e.getElementClassTextProperty(n);o&&a.push({name:o,value:'"'+t+'"'});const i=e.getElementClassDefaultProperties(n);for(var s=0;s<i.length;s++){const t=i[s];a.push({name:t.name,value:t.value})}h[g]=a,g++,p.reportableTreeChange("Create element")}function z(e,n,a){const o=U(e.charAt(0).toLowerCase()+e.slice(1));w(n)<0?sInputForm.show("Create new element","Name",o,(function(n){n=U(n),t.append(C(0,n,e)),G(n,e)})):sInputForm.show("Create new element","Name",o,(function(t){t=U(t);const o=C(M(n)+1,t,e);a?o.insertBefore(a):N(n).append(o),G(t,e)}))}function H(t){const n=w(t);f[n]?f[n].show():f[n]=WebEJS_GUI.viewPropertyEditor(e,p,function(t){const e=w(t);return e<0?{hash:e,name:sMainResources.getString("Simulation view"),type:"Root",properties:m}:{hash:e,name:I(t),type:L(t),properties:h[e]}}(t))}function j(t){const n=t.closest(".list-group-item"),a=t.data("action");switch(a){case"Properties":H(n);break;case"Rename":const t=I(n);sInputForm.show("Rename element","New name",t,(function(e){e!==t&&(e=U(e),function(t,e){t.find(".sViewTreeElement").first().text(e)}(n,e))}));break;case"Reparent":sInputForm.show("Reparent element","New parent","",(function(t){!function(t,e){const n=k(e);if(null==n)return void sMainGUI.println("ERROR: parent element not found!!! : "+e);x(n,L(t),!1).accept?J(t,n):sMessageForm.showWarning("Reparent error","Target does not accept children of this type!")}(n,t)}));break;case"Remove":sMainConfirmationForm.show(I(n),"This action cannot be undone. Do you really want to remove this element?","Remove",(function(){A(n,!0)}));break;case"AddCustom":e.isCustomSpaceAvailable()&&(E(b=[],n,null),sCustomElementForm.show((function(t,n){e.addUserCustomElement({name:t,icon:n,elements:b})})));break;case"Copy":case"Cut":E(b=[],n,null),"Cut"==a&&A(n,!0);break;case"Paste":V(n,b);break;case"MoveUp":!function(t){var e=t.prev();if(e.length>0){if((e=e.first()).hasClass("list-group")&&(e=e.prev().first()),P(e))return;t.insertBefore(e);const n=R(t);n&&n.insertAfter(t),p.reportableTreeChange("Move Up")}}(n);break;case"MoveDown":!function(t){var e=t.next();const n=R(t);if((e=n?n.next():t.next()).length>0){const a=R(e=e.first());a&&(e=a),t.insertAfter(e),n&&n.insertAfter(t),p.reportableTreeChange("Move Down")}}(n);break;case"Help":e.showElementClassHelp(L(n))}}return p.reportableTreeChange=function(t){sMainGUI.setChanged();var n={panel:"view",action:"setView",pages:e.saveObject().pages};sMainGUI.reportPreview(n)},p.reportablePropertyChange=function(t,e,n){p.reportableTreeChange("On behalf of element :"+e)},p.getRootProperties=function(){return m},p.isEmpty=function(){return $(t).children(".list-group-item").length<=1},p.getTree=function(){var e=[];return $(t).children(".list-group-item").each((function(t,n){const a=$(n);if(w(a)<0)return!0;v(e,a)})),e},p.getPropertyByName=function(t,e){if(!e)return null;for(var n=0;n<e.length;n++){const a=e[n];if(a.name==t)return a.value}return null},p.setPropertyByName=function(t,e,n){const a=e.length<=0,o=h[n];if(!o)return a?o:(h[n]=[{name:t,value:e}],p.reportablePropertyChange(n,t,e),h[n]);for(var i=0;i<o.length;i++){const s=o[i];if(s.name==t)return a?o.splice(i,1):s.value=e,p.reportablePropertyChange(n,t,e),o}return a||(o.push({name:t,value:e}),p.reportablePropertyChange(n,t,e)),o},p.getDetectedPropertiesOfType=function(e){var n=[];return $(t).children(".list-group-item").each((function(t,a){const o=$(a);if(w(o)<0)return!0;_(n,o,e)})),n},p.setTree=function(n,a){for(var o in g=0,h={},f)f.hasOwnProperty(o)&&f[o]&&f[o].hide();if(f={},null==u&&(u=function(){const t=e.getElementClassIconSRC(r);return $('<div role="treeitem" class="list-group-item fw-bold py-0 border-0" data-hash="-1" style="padding-left:0.25rem" aria-level="0"><span class="dropdown"><img class="root-icon dropdown" style="padding: 0 2px 0 2px;" src="'+t+'"  id="mViewItemMenuIcon_'+g+'" type="button" data-bs-toggle="dropdown" aria-expanded="false"></img><ul class="dropdown-menu" aria-labelledby="mViewItemMenuIcon_'+g+'"><li><span class="sTranslatable dropdown-item-text">Menu for Simulation view</span></li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Properties">Properties</li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Paste">Paste</li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Help">Help</li></ul></span><span class="sViewTreeElement">Simulation view</span></div>')}()),n&&(m=n),$(t).empty(),t.append(u),a)for(var i=0;i<a.length;i++){var s=a[i],l=s.Type.split(".");s.Type=l[l.length-1],S(t,s,0)}},$(t).addClass("bstreeview"),$(t).on("click",".state-icon",(function(t){var e=$(t.currentTarget);if(e.hasClass(s))return;e.toggleClass(o).toggleClass(i);const n=$(t.currentTarget).closest(".list-group-item");$(n.attr("data-bs-target")).collapse("toggle")})),$(t).on("dblclick",".sViewTreeElement",(function(t){H($(t.currentTarget).closest(".list-group-item"))})),$(t).on("dragenter",".sViewTreeElement",(function(t){t.preventDefault(),$(t.target).parent().addClass("bg-info")})),$(t).on("dragover",".sViewTreeElement",(function(t){t.preventDefault()})),$(t).on("dragleave",".sViewTreeElement",(function(t){t.preventDefault(),$(t.target).parent().removeClass("bg-info")})),$(t).on("drop",".sViewTreeElement",(function(t){const n=t.originalEvent.dataTransfer.getData("text"),a=n.split(":")[1];if("undefined"==a)return;t.preventDefault();const o=$(t.target).parent();if(o.removeClass("bg-info"),n.startsWith("EJS-element"))B(a,o);else if(n.startsWith("EJS-palette")){const t=a;t.startsWith("_custom_")?V(o,e.getCustomElementList(t)):function(t,e){const n=x(e,t,!1);n.accept?n.parent?z(t,n.parent,e):z(t,e,null):sMessageForm.showWarning("Creation error","Target does not accept children of this type!")}(t,o)}})),p.clearPropertyEditor=function(t){delete f[t]},$(t).on("click",".item-icon",(t=>{const e=$(t.target).closest(".list-group-item");$(t.target).parent().find(".cViewMenuHeader").text(sMainResources.getString("Menu for")+" "+I(e))})),$(t).on("click",".cViewMenuItem",(t=>{j($(t.target))})),p},(WebEJS_GUI=WebEJS_GUI||{}).viewElements_dragFunction=function(t,e){t.dataTransfer.setData("text","EJS-"+e+":"+t.target.dataset.drag_info)},WebEJS_GUI.viewWorkpanel=function(){var t={};const e=WebEJS_GUI.viewTree($("#sViewTree"),t);var n,a,o,i={},s=0,l=[];function r(){return'<div class="col px-1 py-1 cViewEmptyElement"><img src="'+sMainGUI.getSystemIconURL("elements/EMPTY.gif")+'"></div>'}function c(t,e){var n="_custom_"+ ++s;i[n]=t.elements,e&&(t.tag=n);return'<div class="col px-1 py-1" style="user-select: none;" data-element_tag="'+n+'"><img class="'+(e?"cViewUserElement":"cViewElementOnPalette")+'" src="'+t.icon+'"  draggable="true" ondragstart="WebEJS_GUI.viewElements_dragFunction(event,\'palette\')" data-drag_info="'+n+'" data-element_type="'+t.name+'" data-bs-toggle="tooltip" data-bs-placement="top" title="'+t.name+'"></img></div>'}function d(t,e,n){return'<div class="col px-1 py-1" style="user-select: none;" ><img class="cViewElementOnPalette" src="'+e+'"  draggable="true" ondragstart="WebEJS_GUI.viewElements_dragFunction(event,\'palette\')" data-drag_info="'+t+'"'+(n?' data-bs-toggle="tooltip" data-bs-placement="top" title="'+n+'"':"")+"></img></div>"}function u(e,n){var a=" active ",o="true",i=0,s='<ul class="nav nav-pills justify-content-center" role="tablist" ">',l='<div class="tab-content">';for(const[b,v]of Object.entries(n)){var u="mViewElements_"+e+"_"+ ++i;s+='<li class="nav-item" role="presentation"><button class="nav-link py-0 px-2'+a+'"  id="'+u+'-tab" data-bs-toggle="tab" data-bs-target="#'+u+'"  type="button" role="tab" aria-controls="'+u+'" aria-selected="'+o+'" data-bs-toggle="tooltip" data-bs-placement="top" title="'+b+'"><img src="'+sMainGUI.getSystemIconURL("groups/"+b+".gif")+'"></button></li>',l+='<div class="tab-pane fade show '+a+'" id="'+u+'" role="tabpanel" aria-labelledby="'+u+'-tab"><div class="mPaletteSubpanel container" '+("Compound"==b?'id="mPaletteGroup_Compound"':"")+'><div class="row m-0">';var p=1,m=0;if("Compound"==b)for(var g=0;g<v.length;g++){l+=c(v[g],!1),++m%8==0&&g<v.length-1&&(p++,m=0,l+='</div><div class="row m-0">')}else for(g=0;g<v.length;g++){const e=v[g];l+="EMPTY"==e?r():d(e,t.getElementClassIconSRC(e),h(e)),++m%8==0&&g<v.length-1&&(p++,m=0,l+='</div><div class="row m-0">')}for(;m<8;)l+=r(),m++;for(l+="</div>";p<2;){if(l+='<div class="row m-0">',"Compound"==b)for(var f=0;f<8;f++)l+=r();else l+=r();l+="</div>",p++}l+="</div></div>",a="",o="false"}return(s+="</ul>")+(l+="</div>")}function p(t,e){if(!((e=e.trim()).length<=0||e.startsWith("/")||e.startsWith('"/')||e.startsWith("%")))if(e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'"))t.push(e.substring(1,e.length-1));else if(e.startsWith("[")&&e.endsWith("]")){const a=e.substring(1,e.length-1).trim().split(",");for(var n=0;n<a.length;n++)p(t,a[n])}else;}function m(t){return a[t]}function g(t){const e=t.split(".");return o[e[0]][e[1]]}function h(t){const e=g(m(t));return"description"in e?e.description:sMainResources.getString(t+"_INFO")}function f(t){for(var e=[];;){e.push(t);const n=g(t);if(!("parent"in n))return e;t=n.parent}}return t.getCustomElementList=function(t){return i[t]},t.getUserCustomElements=function(){return l},t.isCustomSpaceAvailable=function(){const t=$("#mPaletteGroup_Compound .cViewEmptyElement");if(t.length<1){const t=$("#mPaletteGroup_Compound .cViewUserElement").length;return sMainGUI.errorLine(sMainResources.getString("You reached the maximum of custom elements")+":"+t),sMessageForm.showWarning("Creation error","No space left","Check out the output area."),null}return t},t.addUserCustomElement=function(e){const n=t.isCustomSpaceAvailable();if(!n)return;const a=c(e,!0);return $(n[0]).replaceWith(a),l.push(e),!0},t.readUserCustomElements=function(e){for(var n=0;n<e.length;n++){const a=e[n];if(!t.addUserCustomElement(a))break}},t.buildPalette=function(t){n=t.view_elements,a=n.classnames,o=t.view_elements_info;var e="",i=0;for(const[t,a]of Object.entries(n.panels)){var s="mViewPaletteRow_"+ ++i;e+='<div class="accordion-item p-0"><span class="accordion-header" id="'+s+'-header"><button class="sViewBtn accordion-button py-1" type="button" data-bs-toggle="collapse"  data-bs-target="#'+s+'" aria-expanded="true" aria-controls="'+s+'">'+t+'</button></span><div id="'+s+'" class="accordion-collapse collapse show" aria-labelledby="'+s+'-header"><div class="mPaletteSubpanel accordion-body p-0">'+u(i,a)+"</div></div></div>"}$("#sViewPaletteSubpanel").html(e)},t.saveObject=function(){return{Tree:e.getTree(),RootProperties:e.getRootProperties()}},t.readObject=function(t){var n=!1,a=[],o={};if("view"in t){const e=t.view;"Tree"in e&&(o=e.Tree,a=e.RootProperties,n=!0)}return e.setTree(a,o),n},t.getDetectedFiles=function(){const t=[...new Set(e.getDetectedPropertiesOfType("File"))];for(var n=[],a=0;a<t.length;a++)p(n,t[a]);return[...new Set(n)]},t.viewIsEmpty=function(){return e.isEmpty()},t.getWikiHelpPage=function(t){if(!t)return"https://t.um.es/webejs";return"Poligon"===t?t="Polygon":t.startsWith("UserDefined.")&&(t="UserDefined"),"https://www.um.es/fem/EjsWiki/Main/HtmlViewElements"+t},t.showElementClassHelp=function(e){window.open(t.getWikiHelpPage(e),"_blank")},t.getElementClassIconSRC=function(t){const e=g(m(t));return"icon"in e?e.icon:sMainGUI.getSystemIconURL("elements/"+t+".gif")},t.getElementClassTextProperty=function(t){const e=g(m(t));return"text"in e?e.text:null},t.getElementClassEditionInfo=function(t){return g(m(t)).edition},t.getElementClassDefaultProperties=function(t){for(var e=[],n=m(t);;){const t=g(n);if("defaults"in t){const n=t.defaults;for(var a in n)n.hasOwnProperty(a)&&e.push({name:a,value:n[a]})}if(!("parent"in t))return e;n=t.parent}},t.getElementClassProperties=function(e,n){for(var a=m(e),o=[];;){const e=g(a);if("properties"in e){const a=e.properties;if(n)for(var i=0;i<a.length;i++){const e=a[i];t.isPropertyOfType(e,n)&&o.push(e)}else o.push(...a)}if(!("parent"in e))return o;a=e.parent}},t.parentAcceptsChild=function(t,e){const n=f(m(t)),a=f(m(e));for(var o=0;o<n.length;o++){const t=g(n[o]);if("accepts"in t){const e=t.accepts;for(var i=0;i<a.length;i++)for(var s=0;s<e.length;s++)if(e[s]==a[i])return!0}}return!1},t.getPropertyDescription=function(t,e){for(var n=0;n<e.length;n++){var a=e[n];if(t==a.name)return a}return null},t.getPropertyDefaultValue=function(t){return t.default},t.getPropertyModifiersString=function(t){return t.modifiers},t.getPropertyTypesString=function(t){return t.types},t.getPropertyTypesList=function(t){return t.split("|")},t.hasPropertyModifier=function(t,e){return t.modifiers.indexOf(e)>=0},t.getPropertyModifiersList=function(t){return t.split("|")},t.isPropertyOfType=function(t,e){return t.types.indexOf(e)>=0},t.hasModifier=function(t,e){return t.indexOf(e)>=0},t.isOfType=function(t,e){return t.indexOf(e)>=0},$("#sViewPaletteSubpanel").on("dblclick",".cViewElementOnPalette",(function(e){t.showElementClassHelp($(e.currentTarget).data("drag_info"))})),$("#sViewPaletteSubpanel").on("dblclick",".cViewUserElement",(function(t){sMainConfirmationForm.show($(t.currentTarget).data("element_type"),"This element was created by the user and is not editable.<br>Do you want to delete it?","Delete",(function(){const e=$(t.currentTarget).data("drag_info");console.log("tag = "+e),function(t){const e=$('#mPaletteGroup_Compound *[data-element_tag="'+t+'"]');e.length>0&&$(e[0]).replaceWith(r()),delete i[t];for(var n=0;n<l.length;n++)if(l[n].tag==t){l.splice(n,1);break}}(e)}))})),t};var WebEJS_GUI,WebEJS_TOOLS,WebEJS_RESOURCES=WebEJS_RESOURCES||{};WebEJS_RESOURCES.sSingleton=null,WebEJS_RESOURCES.main=function(t){if(null!=WebEJS_RESOURCES.sSingleton)return WebEJS_RESOURCES.sSingleton;var e={},n="en",a=null;const o={Description:"Descripcin",Model:"Modelo",View:"Vista",Preview:"Previsualizacin",Output:"Salida",D:"D",M:"M",V:"V",P:"P",O:"S","Clear output":"Borrar salida","Create a new simulation":"Crear una simulacin nueva","Create a new simulation":"Crear una simulacin nueva","Load a simulation from your device":"Cargar una simulacin desde su dispositivo","Download a simulation from a digital library":"Descargar una simulacin desde una librera digital","Manage the simulation files":"Organizar los archivos de la simulacin","Download ZIP with the sources":"Descargar un ZIP con las fuentes de la simulacin","Download ZIP with the complete simulation":"Descargar un ZIP con la simulacin completa","Search in the simulation":"Buscar en la simulacin","Run the simulation":"Ejecutar la simulacin","Translate the simulation":"Traducir la simulacin","Run the simulation":"Ejecutar la simulacin","Show WebEJS options":"Mostrar las opciones de WebEJS","Show info and help":"Mostrar informacin y ayuda",Variables:"Variables",Initialization:"Inicializacin",Evolution:"Evolucin","Fixed relations":"Relaciones fijas",Custom:"Propio",Elements:"Elementos",Name:"Nombre","Create new page":"Crear una nueva pgina",Page:"Pgina","Click to create a page of variables":"Haga clic para crear una pgina de variables","Click to create a page of initialization":"Haga clic para crear una pgina de inicializacin","Click to create a page of fixed relations":"Haga clic para crear una pgina de relaciones fijas","Click to create a page of code":"Haga clic para crear una pgina de cdigo","Click to create a page of ODEs":"Haga clic para crear una pgina de EDO","Click to create a page of custom code":"Haga clic para crear una pgina de cdigo propio","Frames<br>per second":"Imgenes<br>por segundo","Tree of elements":"rbol de elementos","Elements for the view":"Elementos para la vista"};return e.setLocale=function(t){"es"==t?(a=o,n="es"):(a=sStrings_en,n="en"),e.translateAll()},e.translateAll=function(){$(".sTranslatable").each((function(){$(this).text(e.getString($(this).data("original_string")))})),$(".sTranslatableHTML").each((function(){$(this).html(e.getString($(this).data("original_string")))})),$(".sTranslatableTitle").each((function(){$(this).prop("title",e.getString($(this).data("original_string")))}))},e.prepareForTranslation=function(t){$(t).find(".sTranslatable").each((function(){$(this).data("original_string")||$(this).data("original_string",$(this).text())})),$(t).find(".sTranslatableHTML").each((function(){$(this).data("original_string")||$(this).data("original_string",$(this).html())})),$(t).find(".sTranslatableTitle").each((function(){$(this).data("original_string")||$(this).data("original_string",$(this).prop("title"))})),e.translateAll()},e.updateTranslation=function(t){for(var n=0;n<t.length;n++)parentSelector=t[n],$(parentSelector).find(".sTranslatable").each((function(){$(this).data("original_string",$(this).text()),$(this).text(e.getString($(this).data("original_string")))})),$(parentSelector).find(".sTranslatableHTML").each((function(){$(this).data("original_string",$(this).html()),$(this).html(e.getString($(this).data("original_string")))})),$(parentSelector).find(".sTranslatableTitle").each((function(){$(this).data("original_string",$(this).prop("title")),$(this).prop("title",e.getString($(this).data("original_string")))}))},e.getLocale=function(){return n},e.getString=function(t){return null==a?t:t in a?a[t]:"[?] "+t},e.prepareForTranslation("#sMainBody"),null!=t&&e.setLocale(t),WebEJS_RESOURCES.sSingleton=e,e},(WebEJS_GUI=WebEJS_GUI||{}).fileChooser_drag_prefix="_webEJSFileChooserPath_:",WebEJS_GUI.fileChooser_dragFunction=function(t){t.dataTransfer.setData("text",WebEJS_GUI.fileChooser_drag_prefix+t.target.dataset.path)},WebEJS_GUI.fileChooser=function(t,e,n){var a={};const o=WebEJS_TOOLS.textTools();var i="webEJSFileChooserModal",s=[];for(var l=1;$("#"+i).length>0&&l<1e3;)i="webEJSFileChooserModal"+ ++l;["fullscreen","lg","xl"].includes(e)||(e="fullscreen");var r=function(t){return"(en) "+t},c=function(t){$(t+" .sTranslatable").each((function(){const t=$(this).data("_locale_original_text");if(t)$(this).text(r(t));else{const t=$(this).text();$(this).data("_locale_original_text",t),$(this).text(r(t))}}))};function d(t){t.startsWith("/")&&(t=t.substring(1));for(var e=0;e<s.length;e++){const n=s[e];if("regex"in n){if(n.regex.test(t))return!0}else if(t==n.reserved)return!0}return!1}void 0!==n&&(r=n.getString,c=n.translateAll),a.addToReservedFilenameList=function(t){for(var e=0;e<t.length;e++){const o=t[e];if(o.includes("*")){var n=o.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*"),a=new RegExp("^"+n+"$");s.push({regex:a})}else s.push({reserved:o})}};const u='\n    <div class="modal-header bg-light text-dark">\n    <img src="'+sMainEjsLogo+'" height="40" class="me-2 d-inline-block align-bottom;">\n    <h5 class="ps-2 sTranslatable text-primary modal-title">#{TITLE}</h5>\n      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    </div>\n    ',p='\n    <div id="#{ID}" \n          class="modal modal-dialog-scrollable fade" \n          data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\t\t\n      <div class="modal-dialog modal-#{SIZE} modal-dialog-centered modal-dialog-scrollable">\n        <div class="modal-content h-100">\n          '+u+'\n\n          <div class="modal-body d-flex flex-row">\n        \n            <div id="mFileChooserHelper" class="col-2 m-0 p-0" style="flex-grow:1;">\n            </div>\n          \n  \n          <div class="h-100 col-10 d-flex flex-column" style="flex-grow:1;">\n            <div class="bstreeview h-100 d-flex flex-column" style="flex-grow: 1"></div>\n            <div class="border-top" style="flex-grow: 0; flex-basis: 0">\n              <span class="flex flex-grow input-group input-group-sm mt-1">\n                <nav aria-label="breadcrumb">\n                  <ol class="breadcrumb m-0"></ol>\n                </nav>\n              </span>\n              <span class="filename_div flex flex-grow input-group input-group-sm mt-1">\n                <span  class="sTranslatable input-group-text">Filename</span>\n                <input type="text" class="filename_input flex flex-grow form-control"   \n                  placeholder="<Type in or click on an option>" aria-label="Filename"   \n                  value="">\n              </span>\n            </div>\n          </div>\n          </div>\n    \n          <div class="modal-footer">\n               <button type="button" class="cancel_button sTranslatable btn btn-secondary me-auto" data-dismiss="modal">Close</button>\n            <button type="button" class="upload_button sTranslatable btn btn-outline-secondary me-auto">Upload File</button>\n            <button type="button" class="folder_button sTranslatable btn btn-outline-secondary me-auto">New Folder</button>\n            <button type="button" class="ok_button btn btn-primary">Done</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',m='\n    <div id="#{ID}-new_folder_modal" class="modal fade"\n       data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\t\n    \n      <div class="modal-dialog modal-dialog-centered">\n        <div class="modal-content">\n        '+u+'\n        <div class="modal-body">\n              <div class="input-group mb-3">\n                <span  id="#{ID}-new_folder_label" class="sTranslatable input-group-text">Name</span>\n                <input id="#{ID}-new_folder_name"  type="text" class="name_input form-control" \n                  placeholder="Folder name here" aria-label="Folder name" aria-describedby="#{ID}-new_folder_label">\n              </div>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="sTranslatable btn btn-secondary me-auto" \n                    data-bs-target="##{ID}" data-bs-toggle="modal">Cancel</button>\n            <button type="button" class="ok_button sTranslatable btn btn-primary">Create</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',g='\n    <div id="#{ID}-upload_modal" class="modal fade"\n      data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\t\n    \n      <div class="modal-dialog modal-dialog-centered">\n        <div class="modal-content">\n        '+u+'\n        <div class="modal-body">\n            <div class="input-group mb-3">\n              <span  id="#{ID}-upload_label" class="sTranslatable input-group-text">Name</span>\n              <input id="#{ID}-upload_name"  type="text" class="name_input form-control" \n                  placeholder="File name here" aria-label="File name" aria-describedby="#{ID}-upload_label">\n            </div>\n            <div class="input-group mb-3">\n              <input  id="#{ID}-upload_input" class="form-control" type="file">\n            </div>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="sTranslatable btn btn-secondary me-auto" \n                    data-bs-target="##{ID}" data-bs-toggle="modal">Cancel</button>\n            <button type="button" class="ok_button sTranslatable btn btn-primary">Upload</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',h='\n  <div id="#{ID}-rename_modal" class="modal fade"\n     data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\t\n  \n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n      '+u+'\n      <div class="modal-body">\n            <div class="input-group mb-3">\n              <span  id="#{ID}-rename_label" class="sTranslatable input-group-text">New name</span>\n              <input id="#{ID}-rename_name"  type="text" class="name_input form-control" \n                placeholder="New name here" aria-label="Folder name" aria-describedby="#{ID}-rename_label">\n            </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="sTranslatable btn btn-secondary me-auto" data-bs-target="##{ID}" data-bs-toggle="modal">Cancel</button>\n          <button type="button" class="ok_button sTranslatable btn btn-primary">Apply</button>\n        </div>\n      </div>\n    </div>\n  </div>\n';$("body").append($(p.replace(/#\{ID\}/g,i).replace(/#\{TITLE\}/g,"File Manager").replace(/#\{SIZE\}/g,e))),$("body").append($(m.replace(/#\{ID\}/g,i).replace(/#\{TITLE\}/g,"New Folder"))),$("body").append($(g.replace(/#\{ID\}/g,i).replace(/#\{TITLE\}/g,"Upload File"))),$("body").append($(h.replace(/#\{ID\}/g,i).replace(/#\{TITLE\}/g,"Rename")));const f=new bootstrap.Modal(document.getElementById(i)),b=new bootstrap.Modal(document.getElementById(i+"-new_folder_modal")),v=new bootstrap.Modal(document.getElementById(i+"-upload_modal")),E=new bootstrap.Modal(document.getElementById(i+"-rename_modal"));["","-new_folder_modal","-upload_modal","-rename_modal"].forEach((function(t){$("#"+i+t).on("show.bs.modal",(function(e){c("#"+i+t)}))})),$("#"+i).on("hide.bs.modal",(function(t){L=[],$("#"+i+" ."+V).each((function(){const t=$(this).closest(".list-group-item");L.push(t.data("path"))}))})),$("#mFileChooserHelper").on("click",".cFileChooserHelperImage",(function(t){f.hide();const e=$(t.currentTarget).data("value");R&&R(e)}));const _=$("#"+i+" .bstreeview"),S=$("#"+i+" .breadcrumb"),y=0,T=1,C=2;var O=null,x="/",P=y,w=null,M=0,I=null,L=[],R=null,F=!1;function D(e,n){e?($("#mFileChooserHelper").html(e),$("#mFileChooserHelper").removeClass("d-none")):($("#mFileChooserHelper").html(""),$("#mFileChooserHelper").addClass("d-none")),null==O?t.refreshUserFiles((function(t){O={root_path:"/",root_entries:W(t,"/")},J(x,n)})):J(x,n)}function A(t,e){if("/"==t||""==t)return{parent:"/",name:""};t.startsWith("/")||(t="/"+t),e&&t.endsWith("/")&&(t=t.substring(0,t.length-1));const n=t.lastIndexOf("/");return{parent:t.substring(0,n+1),name:t.substring(n+1)}}function k(t){return""==t.name?t.parent:t.parent+t.name+"/"}function N(t){return t.parent+t.name}function W(t,e){for(var n=[],a=0;a<t.length;a++){var o=t[a];const i="DIRECTORY"==o.type,s=A(o.path,i);s.parent==e&&(s.name.startsWith(".")||(i?n.push({name:s.name,path:k(s),description:o.description,entries:W(t,k(s))}):n.push({name:s.name,path:N(s),description:o.description,url:o.url})))}return n}function J(t,e){switch(P){case C:$("#"+i+" .filename_div").removeClass("d-none"),$("#"+i+" .ok_button").text(r("Save")),$("#"+i+" .filename_input").attr("disabled",null==w);break;case T:$("#"+i+" .filename_div").addClass("d-none"),$("#"+i+" .ok_button").text(r("Read"));break;default:$("#"+i+" .filename_div").addClass("d-none"),$("#"+i+" .ok_button").text(r("Done"))}I=null,t;const n=t.endsWith("/"),a=A(t,n);if(n){if(!Z(k(a)))return;K(k(a))}else{if(!Z(a.parent+"/"))return;K(a.parent+"/"),tt(t)}F=e,f.show()}a.reset=function(){O=null,x="/",I=null,M=0},a.showManager=function(){P=y,w=null,R=null,D(null,!1)},a.showRead=function(t,e,n,a){P=T,w=t,R=e,D(n,a)},a.showWrite=function(t,e){P=C,w=t,R=e,D(null,!1)};const B=i+"-tree-group-",V="bi-chevron-down",U="bi-chevron-right",G="bi-dash";function z(t){return t.startsWith("/")&&(t=t.substring(1)),t.endsWith("/")&&(t=t.substring(0,t.length-1)),t}function H(t,e){for(var n=0;n<e.length;n++){const a=e[n];if("entries"in a&&t==a.name)return a}return null}function j(t){if("/"==t)return O.root_entries;const e=z(t).split("/");for(var n=O.root_entries,a=0;a<e.length;a++){const t=H(e[a],n);if(null==t)return[];n=t.entries}return n}function Z(t){var e=t?j(t):O.root_entries;$(_).empty();for(var n=0,a=0;a<e.length;a++){var o=e[a];n+=X(_,o,0,w)}return 0==n&&_.append($('<div class="m-3 text-secondary">'+r("(This folder is empty)")+"</div>")),L=[],!0}function X(t,e,n,a){const o=function(t){return t>0?(.5+.5*t).toString()+"rem":"0.25rem"}(n),s="entries"in e,l=d(e.path),r=l?'\n    <div role="treeitem" class="list-group-item py-0 border-0" style="padding-left: #{PADDING}" \n      data-path="#{PATH}" aria-level="#{DEPTH}" \n      #{EXTRA_INFO}\n      >\n      <i class="state-icon pe-1 bi #{BI_CLASS}"></i>\n      <span class="#{CLASS_STR}">\n        <i class="item-icon me-1 bi #{ICON_CLASS}">\n        </i>\n        <span class="cReservedFileChooserName">\n        #{NAME}\n        </span>\n      </span>\n    </div>':'\n    <div role="treeitem" class="list-group-item py-0 border-0" style="padding-left: #{PADDING}" \n      draggable="true" ondragstart="WebEJS_GUI.fileChooser_dragFunction(event)" \n      data-path="#{PATH}" aria-level="#{DEPTH}" \n      #{EXTRA_INFO}\n      >\n      <i class="state-icon cFileChooserIconActive pe-1 bi #{BI_CLASS}"></i>\n      <span class="#{CLASS_STR}">\n        <span class="dropdown">\n          <i class="item-icon dropdown me-1 bi #{ICON_CLASS}"\n            id="#{ID}-MenuIcon_#{HASH}" type="button" data-bs-toggle="dropdown" aria-expanded="false">\n          </i>\n          <ul class="dropdown-menu py-0" aria-labelledby="#{ID}-MenuIcon_#{HASH}">\n            \x3c!--li><span class="cFileChooserMenuHeader sTranslatable dropdown-item-text py-0 fw-bold">Menu</span></li>\n\n            <li><hr class="dropdown-divider m-0"></li--\x3e\n            <li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Rename">Rename</li>\n            <li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Duplicate">Duplicate</li>\n            #{ITEM_OPTIONS}\n            <li><hr class="dropdown-divider m-0"></li>\n            <li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Delete">Delete</li>\n          </ul>\n        </span>\n        <span class="cFileChooserName">\n        #{NAME}\n        </span>\n      </span>\n    </div>';var c="text-muted",u=0,p="";if(s){var m=U,g="bi-folder-x",h="";l||(g="bi-folder",c="cFileChooserFolder",m=L.includes(e.path)?V:U,h='\n          <li><hr class="dropdown-divider m-0"></li>\n          <li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Upload">Upload File</li>\n          <li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Subfolder">Create Subfolder</li>\n        '),p=r.replace(/#\{ID\}/g,i).replace(/#\{PADDING\}/g,o).replace(/#\{PATH\}/g,e.path).replace(/#\{DEPTH\}/g,n).replace(/#\{EXTRA_INFO\}/g,' data-bs-target="#'+B+M+'" data-level="'+n+'" ').replace(/#\{BI_CLASS\}/g,m).replace(/#\{CLASS_STR\}/g,c).replace(/#\{ICON_CLASS\}/g,g).replace(/#\{ITEM_OPTIONS\}/g,h).replace(/#\{NAME\}/g,e.name)}else{g="bi-file-earmark-x";var f="";if(!l){var b=!0;if(null!=a){f=" text-primary";const t=/(?:\.([^.]+))?$/.exec(e.path)[1];b=t&&a.includes(t)}c=b?"cFileChooserElement"+f:"cFileChooserElement",g=b?"bi-file-check":"bi-file",'\n          <li><hr class="dropdown-divider m-0"></li>\n          <li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Download">Download File</li>\n        '}p=r.replace(/#\{ID\}/g,i).replace(/#\{PADDING\}/g,o).replace(/#\{PATH\}/g,e.path).replace(/#\{DEPTH\}/g,n).replace(/#\{EXTRA_INFO\}/g," ").replace(/#\{BI_CLASS\}/g,G).replace(/#\{CLASS_STR\}/g,c).replace(/#\{ICON_CLASS\}/g,g).replace(/#\{ITEM_OPTIONS\}/g,"").replace(/#\{NAME\}/g,e.name),u++}if(t.append($(p)),s){const o=function(t,e){const n=$('<div role="group" class="list-group ps-2 collapse'+(e?" show":"")+'"  id="'+B+M+'"></div>');return t.append(n),n}(t,L.includes(e.path));u++,M++,n++;const i=e.entries;for(var v=0;v<i.length;v++){u+=X(o,i[v],n,a)}}return u}function Y(e){e.startsWith("/")||(e="/"+e),e.endsWith("/")||(e+="/"),L=[],$("#"+i+" ."+V).each((function(){const t=$(this).closest(".list-group-item");L.push(t.data("path"))})),t.refreshUserFiles((t=>{O={root_path:"/",root_entries:W(t,"/")},Z(e),K(e)}),"Could not refresh files tree!")}function K(t){t=z(t),S.empty();const e=t.split("/");if(t.length<=0||e.length<=0)S.append($('<li class="breadcrumb-item sTranslatable active" href="#" data-path="/">Simulation</li>'));else{S.append($('<li class="breadcrumb-item sTranslatable" href="#" data-path="/"><a href="#" >Simulation</a></li>'));for(var n=O.root_entries,a=0;a<e.length;a++){const t=H(e[a],n);if(null==t)return;var o;o=a==e.length-1?'<li class="breadcrumb-item active" aria-current="page" data-path="'+t.path+'">'+t.name+"</li>":'<li class="breadcrumb-item" href="#" data-path="'+t.path+'"><a href="#">'+t.name+"</a></li>",S.append($(o)),n=t.entries}}}function q(){var t=S.find("li.active").data("path");return t.endsWith("/")||(t+="/"),t}function Q(t){const e=t.data("path");return A(e,e.endsWith("/")).name}function tt(t){if(P!=C)return;const e=t.endsWith("/");if(e)return void $("#mFileChooserFilename").val("");const n=A(t,e);$("#"+i+" .filename_input").val(n.name)}function et(t){const e=t.endsWith("/"),n=A(t,e);var a=j(n.parent);if(null==a)return!1;for(var o=0;o<a.length;o++)if(n.name==a[o].name)return!0;return!1}function nt(t){et(t)?sMainConfirmationForm.showWarning(t,"Existing file will be overwriten","Overwrite",(function(){R&&R(t)}),(function(){f.show()})):R&&R(t)}function at(t,e,n){function a(){n&&n.show()}if(!o.isValidFilename(e))return n&&n.hide(),sMessageForm.showWarning("Error","This name is not a valid one!",e,a),!1;if("/"==t&&d(e))return n&&n.hide(),sMessageForm.showWarning("Error","This name conflicts with reserved filenames!",e,a),!1;const i=t+e;return!et(i)||(n&&n.hide(),void sMessageForm.showWarning("Error","Name is taken!",i,a))}function ot(){const e=$("#"+i+"-rename_name").val().trim(),n=Q(I);if(e.length<=0||e==n)return E.hide(),void f.show();const a=I.data("path"),o=A(a,a.endsWith("/"));at(o.parent,e,E)&&(t.userFileCommand({command:"Rename",path:a,new_path:o.parent+e},(()=>{Y(x)})),$("#"+i+"-rename_name").val(""),E.hide(),f.show())}$(S).on("click","a",(function(t){$(t.currentTarget).closest(".list-group-item");t.stopPropagation(),Z(x=$(t.currentTarget).closest("li").data("path")),K(x)})),$("#"+i+" .cancel_button").click((function(){f.hide()})),$("#"+i+" .ok_button").click((function(){if(P==C){const t=$("#"+i+" .filename_input").val().trim();if(t.length<=0)return;f.hide(),nt(q()+t)}else if(P==T){if(!I)return;f.hide(),R&&R(I.data("path"))}else f.hide()})),$("#"+i+" .folder_button").click((function(){lt=q(),f.hide(),b.show()})),$("#"+i+" .upload_button").click((function(){f.hide(),st=x,v.show()})),$("#"+i+" .filename_input").change((function(){const t=$("#"+i+" .filename_input").val().trim();t.length<=0||(f.hide(),nt(q()+t))})),$("#"+i).on("click",".cFileChooserMenuItem",(e=>{const n=$(e.target).closest(".list-group-item"),a=$(e.target).data("action"),o=n.data("path");switch(console.log("Action "+a+" for path: "+o),a){case"Rename":f.hide(),E.show();break;case"Duplicate":!function(){const e=I.data("path");if("/"==e)return;var n;if(e.endsWith("/")){const t=e.substring(0,e.length-1);n=t+" copy/";for(var a=1;et(n)&&a<1e3;)n=t+" copy "+ ++a+"/"}else{n=e+" copy";for(a=1;et(n)&&a<1e3;)n=e+" copy "+ ++a}t.userFileCommand({command:"Duplicate",path:e,new_path:n},(function(){Y(x)}))}();break;case"Delete":!function(){const e=I.data("path");if("/"==e)return;f.hide(),sMainConfirmationForm.showWarning(r("Delete"),r("WARNING!!! This action CANNOT be undone!!!")+"<br>"+e,r("Delete"),(function(){t.userFileCommand({command:"Delete",path:e},(function(){Y(x),f.show()}))}),(function(){f.show()}))}();break;case"Subfolder":lt=n.data("path"),f.hide(),b.show();break;case"Upload":f.hide(),mUploadBasePath=I.data("path"),v.show();break;case"Download":const e=o.lastIndexOf("/"),a=e<0?o:o.substring(e+1);sMainFilenameForm.show(a,(t=>{var e=document.createElement("a");e.download=t,e.href=sMainGUI.getURLpathFor(o),e.dataset.downloadurl=["text/plain",e.download,e.href].join(":"),e.click()}))}})),$("#"+i+"-rename_modal").on("show.bs.modal",(function(t){const e=Q(I);$("#"+i+"-rename_name").val(e)})),$("#"+i+"-rename_modal .name_input").change((function(){ot()})),$("#"+i+"-rename_modal .ok_button").click((function(){ot()}));var it=null,st="/";$("#"+i+"-upload_input").change((function(t){const e=t.target.files[0];$("#"+i+"-upload_name").val().trim().length<=0&&$("#"+i+"-upload_name").val(e.name);const n=new FileReader;n.onload=function(t){const e=t.target.result;var n;(n=e,new Promise(((t,e)=>{const a=new Blob([n],{type:"application/octet-binary"}),o=new FileReader;o.onloadend=()=>{const e=o.result.split(",")[1];t(e)},o.onerror=e,o.readAsDataURL(a)}))).then((t=>{it=t}))},n.onerror=function(t){v.hide(),sMessageForm.showWarning("Error","File could not be read!",t.target.error,(function(){v.show()}))},n.readAsArrayBuffer(e)})),$("#"+i+"-upload_modal .ok_button").click((function(){if(null==it)return v.hide(),void sMessageForm.showWarning("Error","No upload file specified!","",(function(){v.show()}));const e=$("#"+i+"-upload_name").val().trim();e.length<=0||at(st,e,v)&&(t.userFileCommand({command:"Upload",path:st+e,data:it},(()=>{Y(x)})),$("#"+i+"-upload_name").val(""),$("#"+i+"-upload_input").val(""),it=null,v.hide(),f.show())}));var lt="/";return $("#"+i+"-new_folder_modal .ok_button").click((function(){const e=$("#"+i+"-new_folder_name").val().trim();if(e.length>0){if(!checkValidFile(lt,e,b))return;const n=lt+e;t.userFileCommand({command:"NewFolder",path:n},(function(t){Y(x)}))}$("#"+i+"-new_folder_name").val(""),b.hide(),f.show()})),$("#"+i).on("dragenter",".list-group-item,.breadcrumb-item",(function(t){t.preventDefault();var e=$(t.currentTarget);console.log("Currenttarget:"),console.log(e),console.log(e.attr("class")),e.hasClass("breadcrumb-item")||(e=e.closest(".list-group-item")),e.data("path").endsWith("/")&&e.addClass("bg-warning")})),$("#"+i).on("dragover",".list-group-item,.breadcrumb-item",(function(t){t.preventDefault();var e=$(t.currentTarget);e.hasClass("breadcrumb-item")||(e=e.closest(".list-group-item")),e.data("path").endsWith("/")&&e.addClass("bg-warning")})),$("#"+i).on("dragleave",".list-group-item,.breadcrumb-item",(function(t){t.preventDefault();var e=$(t.currentTarget);e.hasClass("breadcrumb-item")||(e=e.closest(".list-group-item")),e.removeClass("bg-warning")})),$("#"+i).on("drop",".list-group-item,.breadcrumb-item",(function(e){var n=e.originalEvent.dataTransfer.getData("text");if(!n.startsWith(WebEJS_GUI.fileChooser_drag_prefix))return;n=n.substring(WebEJS_GUI.fileChooser_drag_prefix.length),e.preventDefault();var a=$(e.currentTarget);a.hasClass("breadcrumb-item")||(a=a.closest(".list-group-item")),a.removeClass("bg-warning");const o=a.data("path");at(o,n.split("/").pop(),null)&&t.userFileCommand({command:"Move",path:n,folder:o},(()=>{Y(x)}))})),$(_).on("click",".cFileChooserIconActive",(function(t){var e=$(t.currentTarget);if(e.hasClass(G))return;e.toggleClass(V).toggleClass(U);const n=$(t.currentTarget).closest(".list-group-item");$(n.attr("data-bs-target")).collapse("toggle")})),$(_).on("dblclick",".cFileChooserFolder",(function(t){const e=$(t.currentTarget);e.closest(".cFileChooserIconActive").toggleClass(V).toggleClass(U);const n=e.closest(".list-group-item");$(n.attr("data-bs-target")).collapse("toggle"),Z(x=n.data("path")),K(x),I=null,tt("/")})),$(_).on("click",".cFileChooserFolder",(function(t){if(P in[y,T]){if(P==T&&!F)return;const e=$(t.currentTarget).closest(".list-group-item");I&&I.removeClass("bg-info"),(I=e).addClass("bg-info");tt(e.data("path"))}})),$(_).on("click",".cFileChooserElement",(function(t){const e=$(t.currentTarget).closest(".list-group-item");I&&I.removeClass("bg-info"),(I=e).addClass("bg-info");tt(e.data("path"))})),$(_).on("dblclick",".cFileChooserElement",(function(t){if(P==y)return;f.hide();const e=$(t.currentTarget).closest(".list-group-item").data("path");P==C?nt(e):R(e)})),a},(WebEJS_GUI=WebEJS_GUI||{}).getTranslateAll=function(t){return void 0!==t?t.translateAll:function(t){$(t+" .sTranslatable").each((function(){const t=$(this).data("_locale_original_text");if(t)$(this).text("(en) "+t);else{const t=$(this).text();$(this).data("_locale_original_text",t),$(this).text("(en) "+t)}}))}},WebEJS_GUI.MODAL_TEMPLATE='\n<div id="#{ID}" class="modal fade"\n\tdata-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\t\n\n<div class="modal-dialog modal-dialog-centered">\n\t<div class="modal-content">\n\n\t<div class="modal-header bg-light text-dark">\n\t   <img  src="#{LOGO}" height="40" class="me-2 d-inline-block align-bottom;">\n\t   <h5 class="ps-2 sTranslatable text-primary modal-title">#{TITLE}</h5>\n\t   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n\t</div>\n\t<div class="modal-body">\n\t\t#{BODY_HTML}\n\t</div>\n\t\t<div class="modal-footer">\n\t\t   <button type="button" class="sTranslatable btn btn-secondary me-auto" data-bs-target="##{ID}" data-bs-toggle="modal">Cancel</button>\n\t\t   #{FOOTER_HTML}\n\t   </div>\n   </div>\n</div>\n</div>\n',WebEJS_GUI.filenameForm=function(t){var e={},n="webEJSFilenameFormModal";const a=WebEJS_GUI.getTranslateAll(t),o='\n\t\t<div class="input-group mb-3">\n\t\t\t<span  id="#{ID}-label" class="sTranslatable input-group-text">Filename</span>\n\t\t\t<input id="#{ID}-name"  type="text" class="filename_input form-control" \n\t\t\t\tplaceholder="New name here" aria-label="Folder name" aria-describedby="#{ID}-label">\n\t\t</div>'.replace(/#\{ID\}/g,n);var i=WebEJS_GUI.MODAL_TEMPLATE.replace(/#\{ID\}/g,n).replace(/#\{LOGO\}/g,sMainEjsLogo).replace(/#\{TITLE\}/g,"Choose filename").replace(/#\{BODY_HTML\}/g,o).replace(/#\{FOOTER_HTML\}/g,'\n\t\t<button type="button" class="ok_button sTranslatable btn btn-primary">Download</button>\n\t\t');$("body").append($(i));const s=new bootstrap.Modal(document.getElementById(n));var l;return $("#"+n).on("show.bs.modal",(function(t){a("#"+n)})),$("#"+n+" .cancel_button").click((function(){s.hide()})),$("#"+n+" .ok_button").click((function(){const t=$("#"+n+" .filename_input").val().trim();""!=t&&null!=t&&(s.hide(),l&&l(t))})),e.show=function(t,e){$("#"+n+" .filename_input").val(t),l=e,s.show()},e},(WebEJS_GUI=WebEJS_GUI||{}).confirmationForm=function(){var t={};$("body").append($('\n  <div class="modal fade" id="mConfirmationFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mConfirmationFormLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 id="mConfirmationFormTitle" class="sTranslatable text-primary modal-title">Confirmation</h5>\n      \t\t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n\n\n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div id="mConfirmationFormMessage" class="modal-body">\n\t\t\t\t<p>Do you really want to do this?</p>\n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" id="mConfirmationFormCloseButton" class="btn btn-secondary me-auto">Oops! Please cancel</button>\n\t\t\t\t<button type="button" id="mConfirmationFormOkButton" \t\tclass="btn btn-primary">Confirm</button>\n\t\t\t</div>\n\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var e,n,a=new bootstrap.Modal(document.getElementById("mConfirmationFormModal"));$("#mConfirmationFormLogo").attr("src",sMainEjsLogo);var o=!1;function i(t,i,s,l,r,c){$("#mConfirmationFormTitle").text(t),$("#mConfirmationFormTitle").removeClass(["text-primary","text-danger"]).addClass(i),$("#mConfirmationFormMessage").html(s),$("#mConfirmationFormOkButton").text(sMainResources.getString(l)),e=r,n=c,o=!1,a.show()}return $("#mConfirmationFormModal").on("hidden.bs.modal",(function(){o?e():n&&n()})),$("#mConfirmationFormCloseButton").click((function(){a.hide()})),$("#mConfirmationFormOkButton").click((function(){o=!0,a.hide()})),t.showWarning=function(t,e,n,a,o){i(t,"text-danger","<p>"+sMainResources.getString(e)+"</p>",n,a,o)},t.show=function(t,e,n,a,o){i(t,"text-primary","<p>"+sMainResources.getString(e)+"</p>",n,a,o)},t.showHtml=function(t,e,n,a,o){i(t,"text-primary",e,n,a,o)},t},(WebEJS_GUI=WebEJS_GUI||{}).customElementForm=function(){var t={};$("body").append($('\n<div class="modal fade" id="mCustomElementFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mCustomElementFormLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 class="sTranslatable text-primary modal-title">Add custom element</h5>\n\t\t\t\t</img>\n      \t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div class="modal-body">\n\t\t\t\t<div class="mb-2">\n\t\t\t\t\t<label id="mCustomElementFormNameLabel" for="mCustomElementFormNameValue" class="sTranslatable form-label form-label-sm">Name</label>\n\t\t\t\t\t<input type="text" class="form-control form-control-sm" name="mCustomElementFormNameValue" id="mCustomElementFormNameValue"\n\t\t\t\t\t\tplaceholder="Enter name here" >\n\t\t\t\t</div>\n\t       <div class="input-group mb-3">\n\t         <label class="input-group-text sTranslatable" for="mCustomElementFormIconField" class="form-label">Click to choose a (24x24) icon</label>\n\t         <label class="input-group-text bg-white" id="mCustomElementFormIconButton">\n\t           <img id="mCustomElementFormIconImage" width="24" height="24">\n\t         </label>\n         <input class="form-control d-none" accept="image/*"  id="mCustomElementFormIconField" type="file">\n       </div>\n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" id="mCustomElementFormCancelButton" class="sTranslatable btn btn-secondary me-auto" data-dismiss="modal">Cancel</button>\n\t\t\t\t<button type="button" id="mCustomElementFormOkButton" class="sTranslatable btn btn-primary float-left">OK</button>\n\t\t\t</div>\n\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var e,n=new bootstrap.Modal(document.getElementById("mCustomElementFormModal"));return $("#mCustomElementFormLogo").attr("src",sMainEjsLogo),$("#mCustomElementFormIconField").change((function(t){$("#mCustomElementFormIconImage").attr("src",URL.createObjectURL(t.target.files[0]))})),$("#mCustomElementFormCancelButton").click((function(){n.hide()})),$("#mCustomElementFormOkButton").click((function(){var t=$("#mCustomElementFormNameValue").val().trim();if(""!=t&&null!=t){var a=$("#mCustomElementFormIconField").val().trim();""!=a&&null!=a?(n.hide(),e&&e(t,WebEJS_TOOLS.getBase64("mCustomElementFormIconImage"))):alert("An icon is required!")}else alert("Name field is required!")})),t.show=function(t){e=t,n.show()},t},(WebEJS_GUI=WebEJS_GUI||{}).inputForm=function(){var t={};$("body").append($('\n  <div class="modal fade" id="mInputFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n      \n    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n      \n      <div class="modal-content">\n          \n        <div class="modal-header bg-light text-dark">\n          <img id="mInputFormLogo" height="40" class="me-2 d-inline-block align-bottom;">\n            <h5 id="mInputFormTitle" class="sTranslatable text-primary modal-title">Input</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>  \n        \x3c!------------------  end modal header ---------------\x3e\n  \n        <div class="modal-body">\n          <div id="mInputFormInputDiv" class="mb-2">\n            <label id="mInputFormInputLabel" for="mInputFormInput" class="sTranslatable form-label">Value</label>\n            <input type="text" class="form-control" name="mInputFormInput" id="mInputFormInput"\n              placeholder="Enter value here" >\n          </div>\n          <div id="mInputFormAreaDiv" class="mb-2 d-none">\n            <label     id="mInputFormAreaLabel" for="mInputFormArea" class="sTranslatable form-label">Value</label>\n            <textarea  id="mInputFormArea" name="mInputFormInput"    class="form-control" style="height: 100px"></textarea>\n          </div>\n        </div>\n          \n        \x3c!------------------  end modal body ---------------\x3e\n      \n        <div class="modal-footer">\n          <button type="button" id="mInputFormCancelButton" class="sTranslatable btn btn-secondary me-auto" data-dismiss="modal">Cancel</button>\n          <button type="button" id="mInputFormOkButton" class="sTranslatable btn btn-primary float-left">OK</button>\n        </div>\n  \n        \x3c!------------------  end modal footer ---------------\x3e\n  \n      </div>\n      \x3c!------------------  end modal content ---------------\x3e\n      \n    </div>\t\n    \x3c!------------------  end modal-dialog ---------------\x3e\n  \n  </div>\n  \x3c!------------------  end modal ---------------\x3e\n  '));var e,n,a=new bootstrap.Modal(document.getElementById("mInputFormModal"));$("#mInputFormLogo").attr("src",sMainEjsLogo);return $("#mInputFormCancelButton").click((function(){a.hide()})),$("#mInputFormInput").change((function(){a.hide();var t=$("#mInputFormInput").val().trim();(mAcceptEmptyValue||""!=t&&null!=t)&&n&&n(t)})),$("#mInputFormArea").change((function(){a.hide();var t=$("#mInputFormArea").val().trim();(mAcceptEmptyValue||""!=t&&null!=t)&&n&&n(t)})),$("#mInputFormOkButton").click((function(){a.hide();var t=e.val().trim();(mAcceptEmptyValue||""!=t&&null!=t)&&n&&n(t)})),t.show=function(t,o,i,s,l){$("#mInputFormInputDiv").removeClass("d-none"),$("#mInputFormAreaDiv").addClass("d-none"),$("#mInputFormTitle").text(sMainResources.getString(t)),$("#mInputFormInputLabel").text(sMainResources.getString(o)),(e=$("#mInputFormInput")).val(i),n=s,mAcceptEmptyValue=l,a.show()},t.showArea=function(t,o,i,s,l){$("#mInputFormInputDiv").addClass("d-none"),$("#mInputFormAreaDiv").removeClass("d-none"),$("#mInputFormTitle").text(sMainResources.getString(t)),$("#mInputFormAreaLabel").text(sMainResources.getString(o)),(e=$("#mInputFormArea")).val(i),n=s,mAcceptEmptyValue=l,a.show()},t},(WebEJS_GUI=WebEJS_GUI||{}).messageForm=function(){var t={},e=!1,n=null;$("body").append($('\n<div class="modal fade cModalTop" id="mMessageFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mMessageFormLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 id="mMessageFormTitle" class="text-primary modal-title">WebEJS Message</h5>\n      \t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div class="modal-body">\n\t\t\t\t<div class="mb-2">\n\t\t    \t<div id="mMessageFormText" class="modal-body">\n\t\t      \t<p>Message from WebEJS</p>\n\t\t    \t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" id="mMessageFormCloseButton" class="sTranslatable btn btn-primary float-left">Close</button>\n\t\t\t</div>\n\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var a=document.getElementById("mMessageFormModal"),o=new bootstrap.Modal(a);function i(t,e,n,a){var o="<p>"+n+"</p>";a&&(o+='<p class="'+e+'"><small>'+a+"<small></p>"),s(t,e,o)}function s(t,e,n){$("#mMessageFormTitle").text(sMainResources.getString(t)),$("#mMessageFormTitle").removeClass(["text-primary","text-danger"]).addClass(e),$("#mMessageFormText").html(n),o.show()}return $("#mMessageFormLogo").attr("src",sMainEjsLogo),a.addEventListener("shown.bs.modal",(function(t){e=!0;const n=document.querySelector(".modal-backdrop");n&&n.classList.add("cModal_top")})),a.addEventListener("hidden.bs.modal",(function(t){e=!1;const a=document.querySelector(".modal-backdrop");a&&a.classList.remove("cModal_top"),n&&n(),n=null})),$("#mMessageFormCloseButton").click((function(){o.hide()})),t.hide=function(){e?o.hide():window.setTimeout((function(){o.hide()}),500)},t.show=function(t,e,n){i(t,"text-primary",sMainResources.getString(e),sMainResources.getString(n))},t.showTemporal=function(t,e,n){i(t,"text-primary",e,sMainResources.getString(n))},t.showRaw=function(t,e,n){i(t,"text-primary",e,sMainResources.getString(n))},t.showAllRaw=function(t,e){$("#mMessageFormTitle").text(t),$("#mMessageFormTitle").removeClass("text-danger").addClass("text-primary"),$("#mMessageFormText").html(e),o.show()},t.showWarning=function(t,e,a,o){n=o,i(t,"text-danger",sMainResources.getString(e),sMainResources.getString(a))},t.showWarningRaw=function(t,e,n){i(t,"text-danger",e,sMainResources.getString(n))},t.showHTML=function(t,e){s(t,"text-primary",e)},t.showWarningHTML=function(t,e){s(t,"text-danger",e)},t},(WebEJS_GUI=WebEJS_GUI||{}).responseForm=function(){var t={};$("body").append($('\n<div class="modal fade" id="mResponseFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mResponseFormLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t<h5 id="mResponseFormTitle" class="sTranslatable text-primary modal-title">Response</h5>\n      \t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n\n\n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div id="mResponseFormMessage" class="modal-body">\n\t\t\t\t<p>Do you really want to do this?</p>\n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" id="mResponseFormCloseButton" class="btn btn-secondary me-auto">Oops! Please cancel</button>\n\t\t\t\t<button type="button" id="mResponseFormOkButton" \t\tclass="btn btn-primary">Confirm</button>\n\t\t\t</div>\n\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var e,n,a=new bootstrap.Modal(document.getElementById("mResponseFormModal"));$("#mResponseFormLogo").attr("src",sMainEjsLogo);var o=!1;return $("#mResponseFormModal").on("hidden.bs.modal",(function(){o?e():n&&n()})),$("#mResponseFormCloseButton").click((function(){a.hide()})),$("#mResponseFormOkButton").click((function(){o=!0,a.hide()})),t.show=function(t,i,s,l,r){$("#mResponseFormTitle").text(t),$("#mResponseFormMessage").html(i),$("#mResponseFormOkButton").text(sMainResources.getString(s)),e=l,n=r,o=!1,a.show()},t},(WebEJS_GUI=WebEJS_GUI||{}).selectChoiceForm=function(){var t={};const e="border border-dark rounded";$("body").append($('\n<div class="modal fade" id="mSelectChoiceFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div id= "mSelectChoiceFormModalDiv" class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mSelectChoiceFormLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 id="mSelectChoiceFormTitle" class="sTranslatable text-primary modal-title">Select one</h5>\n      \t<button id="mSelectChoiceFormCloseButton" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n\n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div class="modal-body">\n\t\t\t\t<div id="mSelectChoiceFormList" class="list-group">\n\t\t\t\t</div>\n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<span class="flex flex-grow input-group input-group-sm mt-1"> \n\t\t\t\t  <span class="sTranslatable input-group-text">Value</span> \n\t\t\t\t\t   <input id="mSelectChoiceFormValue"  type="text" class="flex flex-grow form-control"   \n\t\t\t\t\t\t placeholder="<Type in or click on an option>" aria-label="Value"   \n\t\t\t\t\t\t\tspellcheck="off" autocorrect="off" autocapitalize="none" autocomplete="off" \n\t\t\t\t\t\t\tvalue=""> \n\t\t\t\t\t <button id= "mSelectChoiceFormCancelButton" class="sTranslatable btn btn-outline-secondary me-auto" type="button">Cancel</button>\n\t\t\t\t\t <button id= "mSelectChoiceFormOkButton"     class="sTranslatable btn btn-outline-primary "  type="button">OK</button> \n\t\t\t\t </span>\n\n\t\t\t</div>\n\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var n,a,o,i=new bootstrap.Modal(document.getElementById("mSelectChoiceFormModal"));return $("#mSelectChoiceFormLogo").attr("src",sMainEjsLogo),t.show=function(t,s,l,r,c,d,u,p){a=r,o=p,$("#mSelectChoiceFormModalDiv").removeClass("modal-sm modal-lg modal-xl"),c&&$("#mSelectChoiceFormModalDiv").addClass(c),$("#mSelectChoiceFormTitle").text(sMainResources.getString(t)),$("#mSelectChoiceFormList").html(function(t,n){var a="",o=n;if(o.startsWith('"')&&(o=o.substring(1,o.length-1)),t.length<=0)a+='<div class="m-1 text-secondary">'+sLocaleFor("(No choices available)")+"</div>";else for(var i=0;i<t.length;i++){const l=t[i],r="style"in l?l.style:"text-primary";"value"in l||(l.value=l.name);var s="";(l.value==n||"old_names"in l&&o.length>0&&l.old_names.indexOf(o)>=0)&&(s=e),a+='<button type="button" class="p-0 list-group-item list-group-item-action cSelectChoiceFormOptionChosen '+s+'" data-index="'+i+'" >'+("icon"in l?l.icon:"")+'<span class="ps-1 cSelectChoiceFormOptionName '+r+'"></span>'+("description"in l?" : "+l.description:"")+"</button>"}return a}(s,l)),$("#mSelectChoiceFormValue").val(l),d?$("#mSelectChoiceFormValue").attr("readonly",!0):$("#mSelectChoiceFormValue").attr("readonly",!1);const m=$("#mSelectChoiceFormList .border");n=m.length>0?m.first():null,$("#mSelectChoiceFormModal .cSelectChoiceFormOptionChosen").click((t=>{n&&n.removeClass(e),(n=$(t.target).closest(".cSelectChoiceFormOptionChosen")).addClass(e);var a=s[n.data("index")].value;u&&sMainGUI.getModel().getVariables().isArrayVariable(a)&&(a+=u),$("#mSelectChoiceFormValue").val(a)})),$("#mSelectChoiceFormModal .cSelectChoiceFormOptionChosen").dblclick((t=>{i.hide();const e=$(t.target).closest(".cSelectChoiceFormOptionChosen").data("index");var n=s[e].value;u&&sMainGUI.getModel().getVariables().isArrayVariable(n)&&(n+=u),a(n)})),$("#mSelectChoiceFormModal .cSelectChoiceFormOptionName").each((function(){const t=$(this).closest(".cSelectChoiceFormOptionChosen").data("index");$(this).text(s[t].name)})),i.show()},$("#mSelectChoiceFormValue").change((t=>{i.hide(),a($("#mSelectChoiceFormValue").val().trim())})),$("#mSelectChoiceFormOkButton").click((t=>{i.hide(),a($("#mSelectChoiceFormValue").val().trim())})),$("#mSelectChoiceFormCancelButton").click((t=>{o&&o(),i.hide()})),$("#mSelectChoiceFormCloseButton").click((t=>{o&&o()})),t},(WebEJS_GUI=WebEJS_GUI||{}).selectCodeForm=function(){var t={};$("body").append($('\n<div class="modal fade" id="mSelectCodeFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mSelectCodeFormLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 id="mSelectCodeFormTitle" class="sTranslatable text-primary modal-title">Select code</h5>\n      \t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n\n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div class="modal-body">\n\t\t\t\t<div id="mSelectCodeFormList" class="list-group">\n\t\t\t\t</div>\n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<span class="flex flex-grow input-group input-group-sm mt-1"> \n\t\t\t\t  <span class="sTranslatable input-group-text">Method</span> \n\t\t\t\t\t   <input id="mSelectCodeFormValue"  type="text" class="flex flex-grow form-control"   \n\t\t\t\t\t\t placeholder="<Type in or click on a method>" aria-label="Variable"   \n\t\t\t\t\t\t value=""> \n\t\t\t\t\t <button id= "mSelectCodeFormCancelButton" class="sTranslatable btn btn-outline-secondary me-auto" type="button">Cancel</button>\n\t\t\t\t\t <button id= "mSelectCodeFormOkButton"     class="sTranslatable btn btn-outline-primary "  type="button">OK</button> \n\t\t\t\t </span>\n\t\t\t</div>\n\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var e,n,a=new bootstrap.Modal(document.getElementById("mSelectCodeFormModal"));return $("#mSelectCodeFormLogo").attr("src",sMainEjsLogo),$("#mSelectCodeFormOkButton").click((t=>{a.hide();const o=$("#mSelectCodeFormValue").val().trim();o.length>0&&(e.session.insert(e.getCursorPosition(),o),n.reportableChange())})),$("#mSelectCodeFormCancelButton").click((t=>{a.hide()})),t.show=function(t,o,i,s){e=i,n=s,$("#mSelectCodeFormTitle").text(sMainResources.getString(t)),$("#mSelectCodeFormValue").val("");var l="";for(var r in o){const t=o[r];l+='<button type="button" class="p-0 list-group-item list-group-item-action cSelectCodeFormOptionChosen" data-value="'+t.name+'" ><span class="sModelBtn">'+t.name+"</span> : "+t.description+"</button>"}$("#mSelectCodeFormList").html(l),$("#mSelectCodeFormModal .cSelectCodeFormOptionChosen").click((t=>{var e=$(t.target).closest(".cSelectCodeFormOptionChosen").data("value");$("#mSelectCodeFormValue").val(e)})),$("#mSelectCodeFormModal .cSelectCodeFormOptionChosen").dblclick((t=>{var o=$(t.target).closest(".cSelectCodeFormOptionChosen").data("value");e.session.insert(e.getCursorPosition(),o),n.reportableChange(),a.hide()})),a.show()},t},(WebEJS_GUI=WebEJS_GUI||{}).YesNoCancelForm=function(){var t={};$("body").append($('\n<div class="modal fade" id="mYesNoCancelFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mYesNoCancelFormLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 id="mYesNoCancelFormTitle" class="sTranslatable text-primary modal-title">Confirmation</h5>\n      \t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div class="modal-body">\n\t\t\t\t<div class="mb-2">\n\t\t\t\t\t<p id="mYesNoCancelFormLine1">Filename</p>\n\t\t\t\t\t<div id="mYesNoCancelFormLine2">Do you ...?</div>\n\t\t\t\t</div>\n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\t\n\t\t\t<div id="YesNoCancelFormFooter" class="modal-footer">\n\t\t\t\t<button type="button" class="sTranslatable btn btn-secondary me-auto" data-answer="CANCEL" data-dismiss="modal">Oops! Please cancel</button>\n\t\t\t\t<button type="button" class="sTranslatable btn btn-warning"   data-answer="NO" \t\t data-dismiss="modal">No, thank you</button>\n\t\t\t\t<button type="button" class="sTranslatable btn btn-primary" \tdata-answer="YES"\t\t data-dismiss="modal">Yes, please</button>\n\t\t\t</div>\n\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var e,n=new bootstrap.Modal(document.getElementById("mYesNoCancelFormModal"));return $("#mYesNoCancelFormLogo").attr("src",sMainEjsLogo),$("#YesNoCancelFormFooter button").click((t=>{var a=$(t.target).data("answer");n.hide(),e&&e(a)})),t.show=function(t,a,o,i){t&&$("#mYesNoCancelFormTitle").text(sMainResources.getString(t)),a?($("#mYesNoCancelFormLine1").text(a),$("#mYesNoCancelFormLine1").show()):$("#mYesNoCancelFormLine1").hide(),o?($("#mYesNoCancelFormLine2").html(sMainResources.getString(o)),$("#mYesNoCancelFormLine2").show()):$("#mYesNoCancelFormLine2").hide(),e=i,n.show()},t},(WebEJS_TOOLS=WebEJS_TOOLS||{}).IMAGE_FORMATS=["jpeg","jpg","gif","png","svg"],WebEJS_TOOLS.VIDEO_FORMATS=["mp4","ogv","webm"],WebEJS_TOOLS.AUDIO_FORMATS=["aac","mp3","m4a","ogg","wav"],WebEJS_TOOLS.HTML_FORMATS=["html","xhtml"],WebEJS_TOOLS.createJSPanel=function(t,e,n,a,o){e.config={theme:"bootstrap-light",headerLogo:sMainGUI.getWebEJSLogo(),headerTitle:'<h5 class="sTranslatable '+(o||"text-primary")+' modal-title">'+sMainResources.getString(t)+"</h5>",headerControls:n||{smallify:"remove",minimize:"remove"},position:{at:"center",of:"#sMainWorkpanel"},borderRadius:".3rem",panelSize:a||{width:Math.min(.7*window.innerWidth,600),height:Math.min(.6*window.innerHeight,800)}};const i=jsPanel.create(e);return $(".jsPanel-hdr").addClass(["p-1","bg-light"]),$(".jsPanel-content").addClass(["m-1","p-2","bg-light","border","border-dark","rounded"]),i},WebEJS_TOOLS.isBase64Image=function(t){return/^data:image\/(png|jpg|jpeg|gif|bmp|webp);base64,/i.test(t)},WebEJS_TOOLS.getBase64=function(t){var e=document.getElementById(t);if(e.naturalHeight<=0||e.naturalWidth<=0)return"";var n=document.createElement("canvas"),a=n.getContext("2d");n.height=e.naturalHeight,n.width=e.naturalWidth,a.drawImage(e,0,0);var o=n.toDataURL("image/png");return n.remove(),o},WebEJS_TOOLS.selectFile=function(t,e,n,a,o){sMainFileChooser.showRead(t,(function(t){t.startsWith("/org/opensourcephysics")||t.startsWith("/")&&(t="."+t),t.startsWith("/org/")&&(n=!1),n?sMainComm.checkRequiredFile(t,e,(function(t){var e="<p>"+sMainResources.getString("The selected file is not included in your simulation list of <i>User files</i>:")+'</p><p class="text-danger">'+t+"</p><p>"+sMainResources.getString("Please, add it before using it.","User file error")+"</p>";sMessageForm.showWarningHTML("User File Error",e)})):e(t)}),a,o)},(WebEJS_TOOLS=WebEJS_TOOLS||{}).html_tools={TO_RELATIVE_TO_XML_FILE:0,TO_ABSOLUTE_URL:1,convertSRCtags:function(t,e){const n=window.location.origin+sMainGUI.getURLpathFor(""),a=n.length;for(var o=t.toLowerCase(),i="",s=o.indexOf("<img");s>=0;){var l=!0,r=o.indexOf("/>",s);if(r<0&&(l=!1,r=o.indexOf(">",s)),r<0)break;var c=o.substring(s,r),d=-1,u=c.indexOf('src="');u>=0?(u+=5,d=s+c.indexOf('"',u)):(u=c.indexOf('src=\\"')+6,d=s+c.indexOf('\\"',u)),u=s+u;var p=t.substring(u,d);switch(e){case WebEJS_TOOLS.html_tools.TO_RELATIVE_TO_XML_FILE:p.startsWith(n)&&(p="./"+p.substring(a));break;default:case WebEJS_TOOLS.html_tools.TO_ABSOLUTE_URL:p.indexOf(":")<0&&(p=p.startsWith("./")?n+p.substring(2):n+p)}i+=t.substring(0,u)+p,i+=t.substring(d,r),l||(i+="/"),o=o.substring(r),t=t.substring(r),s=o.indexOf("<img")}return i+=t},convertToRelative:function(t){return WebEJS_TOOLS.html_tools.convertSRCtags(t,WebEJS_TOOLS.html_tools.TO_RELATIVE_TO_XML_FILE)},convertToAbsolute:function(t){return WebEJS_TOOLS.html_tools.convertSRCtags(t,WebEJS_TOOLS.html_toolsTO_ABSOLUTE_URL)}},(WebEJS_GUI=WebEJS_GUI||{}).libraryChooser=function(){const t="mLibraryChooserCollection-item-",e="mLibraryChooserCollection-group-",n="bi bi-chevron-down",a="bi bi-chevron-right",o="bi bi-dash";var i={};$("body").append($('\n<div class="modal modal-dialog-scrollable fade" id="mLibraryChooserModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mLibraryChooserLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 class="sTranslatable text-primary modal-title">Library explorer</h5>\n      \t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n    \t\x3c!------------------  end modal header ---------------\x3e\n      \t\n\t\t\t<div class="modal-body  d-flex flex-row">\n\t\t\t\t\t<div id="mLibraryChooserCollection" class="bstreeview" style="flex-grow:1;">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="mLibraryChooserHelper" class="border" style="flex-basis:0; flex-grow: 0; min-width: 50%;">\n\t\t\t\t\t</div>\n\n\t\t\t</div>\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<span class="flex flex-grow input-group input-group-sm mt-1">\n\t\t\t\t\t<nav aria-label="breadcrumb">\n  \t\t\t\t\t<ol id="mLibraryChooserBreadCrumb" class="breadcrumb m-0">\n  \t\t\t\t\t</ol>\n\t\t\t\t\t</nav>\n\t\t\t\t</span>\n\t\t\t\t<span class="mb-2"> \n\t\t\t\t\t<button type="button" id="mLibraryChooserCancelButton" class="sTranslatable btn btn-secondary me-auto" data-dismiss="modal">Cancel</button>\n\t\t\t\t\t<button type="button" id="mLibraryChooserOKButton" class="sTranslatable btn btn-primary float-left">Download</button>\n\t\t\t\t </span>\n\n\t\t\t</div>\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var s=new bootstrap.Modal(document.getElementById("mLibraryChooserModal"));$("#mLibraryChooserLogo").attr("src",sMainEjsLogo);var l=$("#mLibraryChooserCollection"),r=null,c=0,d={},u=null;function p(t){const e=t.data;return"target"in e||(e.target=""),"htmlPath"in e||(e.htmlPath=""),e._name_=t.text,e._id_=t.id,e}function m(t){const e=t.data("hash");console.log("You selected folder :"+v(t));const n=_(t);n&&(console.log("Expanding folder with target:"+n),WebEJS_TOOLS.getComPADRECollection(n,b(function(t){const e=t.parent().data("parent");return $("#"+e)}(t)),b(t),(function(n,a){!function(t,e){f(t);var n=e[0];const a=d[t];if(n.id==a._id_){d[t]=p(n),h(t).children(".cLibraryChooserName").removeClass("text-danger");var o={};o[n.id]={group:f(t),depth:g(t)};for(var i=1;i<e.length;i++){var s=e[i];const t=o[s.parent],n=t.depth+1,a="target"in s.data?s.data.target:"";var l=y(n,s.text,s.data.type,a,0==i);t.group.append(l.tree_item),"group"in l&&(l.tree_item.parent().append(l.group),o[s.id]={group:l.group,depth:n}),d[c]=p(s),c++}o={}}else alert("Error trying to expand ID:"+n.id)}(e,a),console.log(a),function(t){d[t.data("hash")].target=""}(t),T(t)})))}function g(e){const n=$("#"+t+e);return n.length>0?n.first().data("depth"):0}function h(e){const n=$("#"+t+e);return n.length>0?n.first():null}function f(t){const n=$("#"+e+t);return n.length>0?n.first():null}function b(t){return d[t.data("hash")]._id_}function v(t){return d[t.data("hash")]._name_}function E(t){const e=d[t.data("hash")];return e.type.trim().length>0?e.type.trim():"Unknown type"}function _(t){const e=d[t.data("hash")];return e.target.trim().length>0?e.target:null}function S(i,s){const l=function(t){return t.data("hash")}(i),r=$('<div role="group" class="list-group ps-2 collapse'+(s?" show":"")+'"  data-parent="'+t+l+'"  id="'+e+l+'"></div>'),c=s?n:a;return i.find(".state-icon").removeClass(o).addClass(c),r}function y(n,a,o,i,s){const l=function(t){return t>0?(.5+.5*t).toString()+"rem":"0.25rem"}(n),r="Collection"==o,d="EJS"==o,u=r&&i.trim().length>0?"text-danger":d?"text-primary":"",p=$('<div role="treeitem" class="list-group-item py-0 border-0" style="padding-left:'+l+'"  id ="'+t+c+'" data-hash="'+c+'" data-depth="'+n+'"  data-bs-target="#'+e+c+'" "aria-level="'+n+'" ><i class="state-icon '+'bi bi-dash"></i><span class="cLibraryChooserName '+u+'"><i class="me-1 '+(r?"bi bi-folder":d?"bi bi-cloud-download":"bi bi-file-richtext")+'"></i>'+a+"</span></div>");return r?{tree_item:p,group:S(p,s)}:{tree_item:p}}function T(t){"Collection"!=E(t)?($("#mLibraryChooserHelper").removeClass("p-2"),$("#mLibraryChooserHelper").html(C(t))):($("#mLibraryChooserHelper").addClass("p-2"),$("#mLibraryChooserHelper").html(function(t){var e=[],n=[];$(t.data("bs-target")).children(".list-group-item").each((function(){const t=$(this),a=E(t);"Collection"==a?e.push(v(t)):"EJS"==a&&n.push(v(t))}));const a=v(t);var o="";if(e.length>0){o+='<h5 class="text-primary">'+sLocaleFor("Subcategories of ")+a+'</h5><ul class="mb-2">';for(var i=0;i<e.length;i++)o+="<li>"+e[i]+"</li>";o+="</ul>"}if(n.length>0){o+='<h5 class="text-primary">'+sLocaleFor("Models in the ")+a+" "+sLocaleFor("category")+'</h5><ul class="mb-2">';for(i=0;i<n.length;i++)o+="<li>"+n[i]+"</li>";o+="</ul>"}else _(t)&&(o+='<h5 class="text-danger">'+sLocaleFor("Double-click this node to get the list of models in the ")+a+" "+sLocaleFor("category")+"</h5>");return o}(t)))}function C(t){const e=function(t){const e=d[t.data("hash")];return e.htmlPath.trim().length>0?e.htmlPath:null}(t);if(e)return'<iframe\tsrc="'+e+'" style="width:100%; height:100%;"></iframe>';const n=function(t){const e=d[t.data("hash")];return e.description.trim().length>0?e.description:null}(t);return n?'<div class="p-2">'+n+"<div>":'<h5 class="p-1 text-danger">'+sLocaleFor("No information on this item")+"</h5>"}return i.show=function(t){WebEJS_TOOLS.getComPADRECollectionIndex((function(e,n){console.log(n),u=t,mOriginalPath=null,function(t){r=null,function(t){$(l).empty(),c=0,d={};for(var e={},n=null,a=0;a<t.length;a++){var o=t[a];const s=o.parent,r="#"==s?null:e[s],u=r?r.depth+1:0,m="target"in o.data?o.data.target:"";var i=y(u,o.text,o.data.type,m,0==a);r?r.group.append(i.tree_item):l.append(i.tree_item),"group"in i&&(i.tree_item.parent().append(i.group),e[o.id]={group:i.group,depth:u}),d[c]=p(o),0==a&&(d[c].type="ROOT",n=i.tree_item),c++}e={},n&&$("#mLibraryChooserHelper").html(C(n));$("#mLibraryChooserOKButton").prop("disabled",!0)}(t),s.show()}(n)}))},$("#mLibraryChooserCancelButton").click((function(){s.hide()})),$("#mLibraryChooserOKButton").click((function(){if(!r)return;s.hide();const t=_(r);console.log("url selected = "+t),u(_(r),v(r))})),$(l).on("click",".state-icon",(function(t){var e=$(t.currentTarget);if(e.hasClass(o))return;e.toggleClass(n).toggleClass(a);const i=$(t.currentTarget).closest(".list-group-item");$(i.attr("data-bs-target")).collapse("toggle")})),$(l).on("click",".cLibraryChooserName",(function(t){const e=$(t.currentTarget).closest(".list-group-item");r&&r.removeClass("bg-info"),(r=e).addClass("bg-info");const n=E(e);$("#mLibraryChooserOKButton").prop("disabled","EJS"!=n),T(e)})),$(l).on("dblclick",".cLibraryChooserName",(function(t){const e=$(t.currentTarget).closest(".list-group-item"),o=E(e);if(console.log("You selected item "+v(e)),"Collection"==o){m(e);$(t.currentTarget).siblings(".state-icon").addClass(n).removeClass(a);const o=$(t.currentTarget).closest(".list-group-item");$(o.attr("data-bs-target")).collapse("show")}else if("EJS"==o){s.hide();const t=_(e);console.log("url selected = "+t),u(_(e),v(e))}})),i},(WebEJS_TOOLS=WebEJS_TOOLS||{}).LibraryComPADRE={OSP_INFO_URL:"https://www.compadre.org/OSP/online_help/EjsDL/OSPCollection.html",EJS_SERVER_TREE_LOCAL:"osp.php?basename=tree",EJS_SERVER_TREE:"https://www.compadre.org/services/rest/osp_ejss.cfm?verb=Identify&OSPType=EJSS+Model",EJS_SERVER_RECORDS_LOCAL:"osp.php?basename=records",EJS_SERVER_RECORDS:"https://www.compadre.org/osp/services/REST/osp_ejss.cfm?OSPType=EJSS+Model",EJS_SERVER_SEARCH:"https://www.compadre.org/osp/services/REST/search_v1_02.cfm?verb=Search&OSPType=EJSS+Model&Skip=0&Max=30&q=",EJS_COLLECTION_NAME:"EJS OSP Collection",EJS_INFO_URL:"http://www.compadre.org/OSP/online_help/EjsDL/DLModels.html",TRACKER_SERVER_TREE:"http://www.compadre.org/osp/services/REST/osp_tracker.cfm?verb=Identify&OSPType=Tracker",TRACKER_SERVER_RECORDS:"http://www.compadre.org/osp/services/REST/osp_tracker.cfm?OSPType=Tracker",TRACKER_COLLECTION_NAME:"Tracker OSP Collection",TRACKER_INFO_URL:"https://physlets.org/tracker/library/comPADRE_collection.html",PRIMARY_ONLY:"&OSPPrimary=Subject",GENERIC_COLLECTION_NAME:"AAPT-ComPADRE OSP Collection",ABOUT_OSP:"About OSP and AAPT-ComPADRE",Description_DoubleClick:"dblClick",Description_Author:"Author",Description_DownloadSize:"Download Size",Description_InfoField:"Info"},WebEJS_TOOLS.LibraryResource={UNKNOWN_TYPE:"Unknown",COLLECTION_TYPE:"Collection",TRACKER_TYPE:"Tracker",EJS_TYPE:"EJS",VIDEO_TYPE:"Video",HTML_TYPE:"HTML",PDF_TYPE:"PDF"},WebEJS_TOOLS.libraryResource=function(t,e){var n,a={},o="",i="",s="",l="",r=WebEJS_TOOLS.LibraryResource.UNKNOWN_TYPE,c={},d=t+"/"+e;function u(t,e){return-1!==t.indexOf(e,t.length-e.length)}return a.getParent=function(){return t},a.getName=function(){return e},a.getId=function(){return d},a.getBasePath=function(){return i},a.setBasePath=function(t){return(t=t?t.trim():"")!=i&&(i=t,!0)},a.getTarget=function(){return l},a.setTarget=function(t){return(t=t?t.trim():"")!=l&&(n=null,l=t,u(t=t.toUpperCase(),".TRK")?a.setType(WebEJS_TOOLS.LibraryResource.TRACKER_TYPE):u(t,".PDF")?a.setType(WebEJS_TOOLS.LibraryResource.PDF_TYPE):t.indexOf("EJS")>-1?a.setType(WebEJS_TOOLS.LibraryResource.EJS_TYPE):""==t&&(null==a.getHTMLPath()?a.setType(WebEJS_TOOLS.LibraryResource.UNKNOWN_TYPE):a.setType(WebEJS_TOOLS.LibraryResource.HTML_TYPE)),!0)},a.getHTMLPath=function(){return o},a.setHTMLPath=function(t){return(t=t?t.trim():"")!=o&&(o=t,a.addResource||""!=a.getTarget()||(""==t?a.setType(WebEJS_TOOLS.LibraryResource.UNKNOWN_TYPE):a.setType(WebEJS_TOOLS.LibraryResource.HTML_TYPE)),!0)},a.getDescription=function(){return s},a.setDescription=function(t){return(t=t?t.trim():"")!=s&&(s=t,!0)},a.getType=function(){return r},a.setType=function(t){return r!=t&&(r=t,!0)},a.setProperty=function(t,e){c[t]=e},a.getProperty=function(t){return c[t]},a.getThumbnail=function(){return n},a.setThumbnail=function(t){n=t},a.toJSON=function(){var a={};return a.id=d,a.parent=t,a.text=e,a.type="file",a.data={},a.data.htmlPath=o,a.data.basePath=i,a.data.description=s,a.data.target=l,a.data.type=r,a.data.thumbnail=n,a},a},WebEJS_TOOLS.libraryCollection=function(t,e){var n=WebEJS_TOOLS.libraryResource(t,e),a={};return n.addResource=function(t){a[t.getName()]||(a[t.getName()]=t)},n.removeResource=function(t){a[t.getName()]&&delete a[t.getName()]},n.getResources=function(){return a},n.toJSON=function(){var t=[],e={};for(var o in e.id=n.getId(),e.parent=n.getParent(),e.text=n.getName(),e.type="folder",n.getName()===WebEJS_TOOLS.LibraryComPADRE.GENERIC_COLLECTION_NAME&&(e.state={opened:!0,selected:!0,disabled:!1}),e.data={},e.data.htmlPath=n.getHTMLPath(),e.data.basePath=n.getBasePath(),e.data.description=n.getDescription(),e.data.target=n.getTarget(),e.data.type=n.getType(),e.data.thumbnail=n.getThumbnail(),t.push(e),a){var i=a[o];t=t.concat(i.toJSON())}return t},n.setType(WebEJS_TOOLS.LibraryResource.COLLECTION_TYPE),n},WebEJS_TOOLS.libraryComPADRE=function(){var t={};function e(t,n,a,i){for(var s=!1,l=WebEJS_TOOLS.LibraryComPADRE.Description_DoubleClick,c=t.getId(),d=0;d<n.length;d++)if(n.item(d)instanceof Element){var u=n.item(d);if("sub-tree-set"==u.nodeName.toLowerCase()&&a==u.getAttribute("type")){var p=o(u,"sub-tree");if(p.length>0){for(var m=null,g=0;g<p.length;g++)if(p[g]instanceof Element){var h=p[g],f=h.getAttribute("name"),b=h.getAttribute("service-parameter");if(b=i+"&"+r(b),"Unclassified"!=f){var v=WebEJS_TOOLS.libraryCollection(c,f);if(t.addResource(v),s=!0,0==o(h,"sub-tree-set").length){var E="<h2>"+f+"</h2><blockquote>";v.setDescription(E+l+"</blockquote>"),v.setTarget(b)}else e(v,h.childNodes,a+"-detail",b)}else m=b}null!=m&&t.setTarget(m)}}}return s}function n(t,e){for(var n=s(t,"file-identifier"),o=t.childNodes,l=null,r=0,c=o.length;r<c;r++){var d=o.item(r);if("attached-document"!=!d.nodeName.toLowerCase()){var u=a(d,"file-type");if(null!=u&&e==i(u)){var p=a(d,"download-url");if(null!=p&&(null==l||n==s(d,"file-identifier"))){var m=i(p),g=a(d,"file-name");l=null!=g?[m,i(g),g.getAttribute("file-size")]:[m,null,null]}}}}return l}function a(t,e){for(var n=t.childNodes,a=0,o=n.length;a<o;a++){var i=n.item(a);if(i.nodeName.toLowerCase()==e.toLowerCase())return i}return null}function o(t,e){for(var n=[],a=t.childNodes,o=0,i=a.length;o<i;o++){var s=a.item(o);s.nodeName.toLowerCase()==e.toLowerCase()&&n.push(s)}return n}function i(t){for(var e=t.childNodes[0];null!=e;e=e.getNextSibling())if(e.nodeType==Node.TEXT_NODE)return e.nodeValue;return null}function s(t,e){var n=a(t,e);return null!=n?i(n):null}function l(t){for(var e=[],n=t.indexOf("&amp;");n>=0;)e.push(t.subSequence(0,n+1)),n=(t=t.substring(n+5)).indexOf("&amp;");return e.push(t),e.toString()}function r(t){if(null==t)return null;var e=t;for(0===e.indexOf("file:")&&(e=e.substring(5));0===e.indexOf("//");)e=e.substring(1);0===e.indexOf("/")&&e.indexOf(":")>-1&&(e=e.substring(1));for(var n=e.indexOf("%20");n>-1;){var a=e.substring(0,n);n=(e=a+" "+e.substring(n+3)).indexOf("%20")}return e}return t.getNameFromId=function(t){return t.substr(t.lastIndexOf("/")+1)},t.load=function(t,n){for(var a=n.getElementsByTagName("Identify"),o=!1,i=0;i<a.length;i++)o=e(t,a.item(i).childNodes,"osp-subject","")||o;return o},t.getResources=function(t,e){for(var r,c,d=!1,u=WebEJS_TOOLS.LibraryComPADRE.Description_Author,p=WebEJS_TOOLS.LibraryComPADRE.Description_DownloadSize,m=WebEJS_TOOLS.LibraryComPADRE.Description_InfoField,g=t.getId(),h=e.getElementsByTagName("record"),f=0;f<h.length;f++){var b,v=h.item(f);if(null!=(b=n(v,"Source Code"))){var E=s(v,"title"),_=WebEJS_TOOLS.libraryResource(g,E);t.addResource(_);var S=l(b[0]);_.setTarget(S),_.setProperty("download_filename",b[1]);var y=s(v,"osp-type").toUpperCase();y=0===y.indexOf("EJS")?WebEJS_TOOLS.LibraryResource.EJS_TYPE:"TRACKER"==y?WebEJS_TOOLS.LibraryResource.TRACKER_TYPE:WebEJS_TOOLS.LibraryResource.UNKNOWN_TYPE,_.setType(y);var T=s(v,"description"),C=s(v,"information-url"),O=s(v,"thumbnail-url"),x="",P=o(a(v,"contributors"),"contributor");for(var w in P){var M=P[w];"Author"==M.getAttribute("role")&&(x+=i(M)+", ")}c=", ",-1!==(r=x).indexOf(c,r.length-c.length)&&(x=x.substring(0,x.length-2));var I=[];I.push('<p align="center"><img src="'+O+'" alt="'+E+'"></p>'),I.push("<p><b></b></p>"),I.push("<h2>"+E+"</h2>"),x.length>0&&I.push("<p><b>"+u+":</b> "+x+"</p>"),T&&I.push("<p>"+T.replace(/\n([ \t]*\n)+/g,"</p><p>").replace("\n","<br />")+"</p>"),I.push("<p><b>"+m+'</b><br><a href="'+C+'" target="_blank">'+C+"</a></p>"),I.push("<p><b>"+p+"</b> "+b[2]+" bytes</p>"),_.setDescription(I.join("")),d=!0}}return d},t.getCollection=function(e,n,a){var o=function(t){return 0===t.indexOf(WebEJS_TOOLS.LibraryComPADRE.EJS_SERVER_TREE)?WebEJS_TOOLS.LibraryComPADRE.EJS_COLLECTION_NAME:0===t.indexOf(WebEJS_TOOLS.LibraryComPADRE.TRACKER_SERVER_TREE)?WebEJS_TOOLS.LibraryComPADRE.TRACKER_COLLECTION_NAME:WebEJS_TOOLS.LibraryComPADRE.GENERIC_COLLECTION_NAME}(n),i=n.indexOf(WebEJS_TOOLS.LibraryComPADRE.PRIMARY_ONLY)>-1,s=WebEJS_TOOLS.libraryCollection(e,o);o==WebEJS_TOOLS.LibraryComPADRE.EJS_COLLECTION_NAME?s.setHTMLPath(WebEJS_TOOLS.LibraryComPADRE.EJS_INFO_URL):o==WebEJS_TOOLS.LibraryComPADRE.TRACKER_COLLECTION_NAME&&s.setHTMLPath(WebEJS_TOOLS.LibraryComPADRE.TRACKER_INFO_URL);var l=WebEJS_TOOLS.libraryResource(s.getId(),WebEJS_TOOLS.LibraryComPADRE.ABOUT_OSP);l.setHTMLPath(WebEJS_TOOLS.LibraryComPADRE.OSP_INFO_URL),s.addResource(l),t.load(s,a);var r=WebEJS_TOOLS.LibraryComPADRE.EJS_SERVER_RECORDS;return o==WebEJS_TOOLS.LibraryComPADRE.TRACKER_COLLECTION_NAME&&(r=WebEJS_TOOLS.LibraryComPADRE.TRACKER_SERVER_RECORDS),i&&(r+=WebEJS_TOOLS.LibraryComPADRE.PRIMARY_ONLY),s.setBasePath(r),s},t}(),WebEJS_TOOLS.getComPADRECollectionIndex=function(t){return WebEJS_TOOLS.getComPADRECollection(null,null,null,t)},WebEJS_TOOLS.getComPADRECollection=function(t,e,n,a){const o=null==e;t?t=WebEJS_TOOLS.LibraryComPADRE.EJS_SERVER_RECORDS+t:(t=WebEJS_TOOLS.LibraryComPADRE.EJS_SERVER_TREE+WebEJS_TOOLS.LibraryComPADRE.PRIMARY_ONLY,e="#"),$.ajax({type:"POST",url:t,headers:{"Content-type":"application/x-www-form-urlencoded"},dataType:"xml",processData:!1,success:i=>{if(console.log("Received:"),console.log(i),o){var s=WebEJS_TOOLS.libraryComPADRE.getCollection(e,t,i);a(!0,s.toJSON())}else{var l=WebEJS_TOOLS.libraryComPADRE.getNameFromId(n),r=WebEJS_TOOLS.libraryCollection(e,l);const t=WebEJS_TOOLS.libraryComPADRE.getResources(r,i);a(t,r.toJSON())}},error:t=>{console.log("No XML content in OSP connection!"),console.log(t)}})},(WebEJS_GUI=WebEJS_GUI||{}).editorForColor=function(){const t=WebEJS_TOOLS.textTools();var e={};$("body").append($('\n<div class="modal fade" id="mEditorForColorModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div id= "mEditorForColorModalDiv" class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mEditorForColorLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 id="mEditorForColorTitle" class="sTranslatable text-primary modal-title">Select color</h5>\n      \t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n\n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div class="modal-body">\n        <div id="mEditorForColorList" class="container">\n          <div class="row">\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: BLACK; width:36px; height:36px;" data-value="Black"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: DARKGRAY; width:36px; height:36px;" data-value="DarkGray"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: GRAY; width:36px; height:36px;" data-value="Gray"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: LIGHTGRAY; width:36px; height:36px;" data-value="LightGray"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0 border" style="background: WHITE; width:36px; height:36px;" data-value="White"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: BLUE; width:36px; height:36px;" data-value="Blue"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: CYAN; width:36px; height:36px;" data-value="Cyan"></div>\n          </div>\n          <div class="row">\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: GREEN; width:36px; height:36px;" data-value="Green"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: MAGENTA; width:36px; height:36px;" data-value="Magenta"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: RED; width:36px; height:36px;" data-value="Red"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: PINK; width:36px; height:36px;" data-value="Pink"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: ORANGE; width:36px; height:36px;" data-value="Orange"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: YELLOW; width:36px; height:36px;" data-value="Yellow"></div>\n            <div class="col cEditorForColorOne me-1 mb-1 p-0" style="background: rgb(200,220,208); width:36px; height:36px;" data-value="rgb(200,220,208)"></div>\n          </div>\n        </div>\n\t\t\t\n\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t<span  id="mEditorForColorInputLabel" class="sTranslatable input-group-text">Or click to choose a color &rarr;</span>\n \t\t\t\t\t<input type="color" id="mEditorForColorInput" class="form-control" style="height:40px;"\n \t\t\t\t\t\t\t\t\taria-label="Title" aria-describedby="mEditorForColorInputLabel">\n\t\t\t\t</div>\n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<span class="flex flex-grow input-group input-group-sm mt-1"> \n\t\t\t\t  <span class="sTranslatable input-group-text">Value</span> \n\t\t\t\t\t   <input id="mEditorForColorValue"  type="text" class="flex flex-grow form-control"   \n\t\t\t\t\t\t placeholder="<Type in or click on an option>" aria-label="Value"   \n\t\t\t\t\t\t value=""> \n\t\t\t\t\t <button id= "mEditorForColorCancelButton" class="sTranslatable btn btn-outline-secondary" type="button">Cancel</button>\n\t\t\t\t\t <button id= "mEditorForColorOkButton"     class="sTranslatable btn btn-outline-primary "  type="button">OK</button> \n\t\t\t\t </span>\n\n\t\t\t</div>\n\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var n,a=new bootstrap.Modal(document.getElementById("mEditorForColorModal"));return $("#mEditorForColorLogo").attr("src",sMainEjsLogo),e.show=function(e,o,i){n=i,$("#mEditorForColorTitle").text(sMainResources.getString(e)),(o=t.removeQuotes(o)).trim().length>0&&($("#mEditorForColorInput").val(o),$("#mEditorForColorValue").val(t.addQuotes(o))),a.show()},$("#mEditorForColorInput").change((e=>{var n=$("#mEditorForColorInput").val();$("#mEditorForColorValue").val(t.addQuotes(n))})),$("#mEditorForColorList .cEditorForColorOne").click((e=>{var n=$(e.target).data("value");$("#mEditorForColorValue").val(t.addQuotes(n))})),$("#mEditorForColorList .cEditorForColorOne").dblclick((e=>{a.hide();var o=$(e.target).data("value");n(t.addQuotes(o))})),$("#mEditorForColorValue").change((t=>{a.hide(),n($("#mEditorForColorValue").val().trim())})),$("#mEditorForColorOkButton").click((t=>{a.hide(),n($("#mEditorForColorValue").val().trim())})),$("#mEditorForColorCancelButton").click((t=>{a.hide()})),e},(WebEJS_GUI=WebEJS_GUI||{}).editorForFont=function(){const t=WebEJS_TOOLS.textTools();var e={};$("body").append($('\n<div class="modal fade" id="mEditorForFontModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div id= "mEditorForFontModalDiv" class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mEditorForFontLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 id="mEditorForFontTitle" class="sTranslatable text-primary modal-title">Select font</h5>\n      \t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n\n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div class="modal-body">\n\n        <div class="mt-2 input-group">\n          <span class="sTranslatable input-group-text">Family</span>\n          <select id="mEditorForFontFamily" class="form-select">\n            <option selected>"Times New Roman", Times, serif</option>\n            <option>Georgia, serif</option>\n            <option>Garamond, serif</option>\n            <option>Arial, Helvetica, sans-serif</option>\n            <option>Tahoma, Verdana, sans-serif</option>\n            <option>"Trebuchet MS", Helvetica, sans-serif</option>\n            <option>Geneva, Verdana, sans-serif</option>\n            <option>"Courier New", Courier, monospace</option>\n            <option>"Brush Script MT", cursive</option>\n            <option>Copperplate, Papyrus, fantasy</option>\n          </select>\n        </div>\n        <div class="mt-2 input-group">\n          <span class="sTranslatable input-group-text">Style</span>\n          <select id="mEditorForFontStyle" class="form-select">\n            <option selected value="normal normal">Plain</option>\n            <option value="normal bold">Bold</option>\n            <option value="italic normal">Italic</option>\n            <option value="italic bold">Bold+Italic</option>\n          </select>\n        </div>\n        \n        <div class="mt-2 input-group">\n          <span class="sTranslatable input-group-text">Size</span>\n          <select id="mEditorForFontSize" class="form-select">\n            <option selected value="default">Default</option>\n            <option value="pixels">pixels:</option>\n            <option value="xx-small">xx small</option>\n            <option value="x-small">x small</option>\n            <option value="small">small</option>\n            <option value="medium">medium</option>\n            <option value="large">large</option>\n            <option value="x-large">x large</option>\n            <option value="xx-large">xx large</option>\n            <option value="smaller">smaller</option>\n            <option value="larger">larger</option>\n          </select>\n          <input id="mEditorForFontSizeInput" type="text" class="form-control d-none" value="10"\n                placeholder="Enter pixel size" >\n        </div>\n\n        \x3c!-- div id="mEditorForFontSizePixels" class="mt-2 input-group">\n          <span class="sTranslatable input-group-text">Pixels</span>\n          <input id="mEditorForFontSizePixelsSlider" class="input-range"  type="range"  step="1" value="10" min="6" max="49">\n        </div--\x3e\n\t\t\t\n        <div class="sTranslatable mt-2">Demo</div>\n\t\t\t\t<div class="border border-dark p-1" id="mEditorForFontDemo">\n            Lorem ipsum dolor sit amet, consectetur adipiscing elit. \n            Phasellus imperdiet, nulla et dictum interdum, nisi lorem \n            egestas odio, vitae scelerisque enim ligula venenatis dolor.\n        </div>\n        \n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<span class="flex flex-grow input-group input-group-sm mt-1"> \n\t\t\t\t  <span class="sTranslatable input-group-text">Value</span> \n\t\t\t\t\t   <input id="mEditorForFontValue"  type="text" class="flex flex-grow form-control"   \n\t\t\t\t\t\t placeholder="<Type in or click on an option>" aria-label="Value"   \n\t\t\t\t\t\t value=""> \n\t\t\t\t\t <button id= "mEditorForFontCancelButton" class="sTranslatable btn btn-outline-secondary" type="button">Cancel</button>\n\t\t\t\t\t <button id= "mEditorForFontOkButton"     class="sTranslatable btn btn-outline-primary "  type="button">OK</button> \n\t\t\t\t </span>\n\n\t\t\t</div>\n\t\t</div>\n\t</div>\t\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var n,a=new bootstrap.Modal(document.getElementById("mEditorForFontModal"));function o(){const e=$("#mEditorForFontFamily option:selected").text(),n=$("#mEditorForFontStyle option:selected").val();var a="medium";const o=$("#mEditorForFontSize option:selected").val();if("pixels"==o){var i=$("#mEditorForFontSizeInput").val();0==i.trim().length&&(a=i+"px")}else a=o;const s=n+" "+a+" "+t.scapeQuotes(e);$("#mEditorForFontValue").val(t.addQuotes(s))}return $("#mEditorForFontLogo").attr("src",sMainEjsLogo),e.show=function(e,o,i){n=i,$("#mEditorForFontTitle").text(sMainResources.getString(e)),(o=t.removeQuotes(o)).trim().length>0&&($("#mEditorForFontInput").val(o),$("#mEditorForFontValue").val(t.addQuotes(o))),a.show()},$("#mEditorForFontFamily").change((t=>{const e=$("#mEditorForFontFamily option:selected").text();$("#mEditorForFontDemo").css("font-family",e),o()})),$("#mEditorForFontStyle").change((t=>{var e=$("#mEditorForFontStyle option:selected").val().split(" ");$("#mEditorForFontDemo").css("font-style",e[0]),$("#mEditorForFontDemo").css("font-weight",e[1]),o()})),$("#mEditorForFontSize").change((t=>{const e=$("#mEditorForFontSize option:selected").val();if("pixels"==e){$("#mEditorForFontSizeInput").removeClass("d-none");var n=$("#mEditorForFontSizeInput").val();return 0==n.trim().length?$("#mEditorForFontDemo").css("font-size",""):$("#mEditorForFontDemo").css("font-size",n.trim()+"px"),void o()}$("#mEditorForFontSizeInput").addClass("d-none"),"default"==e?$("#mEditorForFontDemo").css("font-size",""):$("#mEditorForFontDemo").css("font-size",e),o()})),$("#mEditorForFontSizeInput").change((t=>{var e=$("#mEditorForFontSizeInput").val();0==e.trim().length?$("#mEditorForFontDemo").css("font-size",""):$("#mEditorForFontDemo").css("font-size",e.trim()+"px"),o()})),$("#mEditorForFontValue").change((t=>{a.hide(),n($("#mEditorForFontValue").val().trim())})),$("#mEditorForFontOkButton").click((t=>{a.hide(),n($("#mEditorForFontValue").val().trim())})),$("#mEditorForFontCancelButton").click((t=>{a.hide()})),e},(WebEJS_TOOLS=WebEJS_TOOLS||{}).sTabbedPanelSingleton=null,WebEJS_TOOLS.tabbedPanel=function(){if(null!=WebEJS_TOOLS.sTabbedPanelSingleton)return WebEJS_TOOLS.sTabbedPanelSingleton;var t={};function e(t,e){$(t+" .cPageDiv").each((function(){e<0&&(e=$(this).data("hash")),$(this).data("hash")==e?$(this).removeClass("d-none"):$(this).addClass("d-none")})),$(t+" .sPageEditButton").each((function(){$(this).closest(".cPageTabButton").data("hash")==e?$(this).removeClass("d-none"):$(this).addClass("d-none")}))}function n(t,n){t.hasClass("cPageMenuItem")||t.closest(".cPageTabButton").find(".sPageEditButton").first().hasClass("d-none")&&e(n,t.closest(".cPageTabButton").data("hash"))}function a(t,e){const n=t.closest(".cPageTabButton").data("hash");p(e,t.data("action"),n,t.data("type"))}function o(t,e,n,a){const o=t.getKeyword();return'<li class="nav-item" role="presentation"><button class="cPageTabButton nav-link '+a.active+'" type="button"  role="tab" data-bs-toggle="tab"  data-hash='+e+' data-name="'+n.Name+'" data-active='+n.Active+" data-internal="+n.Internal+' data-type="'+n.Type+'" id="m'+o+"PageTab_"+e+'"  data-bs-target="#m'+o+"Page_"+e+'"  aria-controls="m'+o+"Page_"+e+'"  aria-selected="'+a.aria+'"><span class="dropdown"><i class="sPageEditButton dropdown bi bi-file-code '+a.display+'"  id="m'+o+"PageTabIcon_"+e+'" type="button" data-bs-toggle="dropdown" aria-expanded="false"></i><ul class="dropdown-menu" aria-labelledby="m'+o+"PageTabIcon_"+e+'"><li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageNew"  data-type="'+t.getDefaultPageType()+'" >Create a new page</li>'+(t.isPageSecondType?'<li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageNew"  data-type="'+t.getSecondType()+'">'+t.getSecondTypeLabel()+"</li>":"")+'<li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageEdit">Rename/Move this page</li><li><hr class="dropdown-divider"></li>'+("DESCRIPTION_EDITOR"==t.getDefaultPageType()?'<li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageToggleInternal">Tag/Untag as Internal</li>':"")+'<li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageToggle">Enable/Disable this page</li><li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageDelete">Remove this page</li></ul></span><span class="cPageTabButtonLabel">'+n.Name+"</span></button></li>"}function i(t,e,n,a,o){const i=t.getKeyword();var s=t.pageCommentBuilder?'<div class="sCommentPanel d-flex flex-column" style="flex-basis:0;flex-grow: 0">'+t.pageCommentBuilder(e,n)+"</div>":"";return'<div class="cPageDiv tab-pane fade col-12 h-100 d-flex flex-column '+o+'" role="tabpanel"  data-hash='+e+' id="m'+i+"Page_"+e+'"  aria-labelledby="m'+i+"PageTab_"+e+'"><div class="sModelBorderedPanel tabContent d-flex flex-column" style="flex-grow:1">'+t.pageMainBuilder(e,n,a)+"</div>"+s+"</div>"}function s(t,e){const n=$(t.getMainPanelSelector()+" .cPageTabButton");var a=null;return n.each((function(){if($(this).data("hash")==e)return a=$(this),!1})),a}function l(t,e){const n=s(t,e);return n?n.closest("li"):null}function r(t){var e=t.data("name");t.data("internal")&&(e+=" (I)"),t.data("active")||(e+=" (D)");t.children(".cPageTabButtonLabel").first().text(e)}function c(e,n,a){const o=t.getDivPageByHash(e,n);o.attr("disabled",a),o.find("*").attr("disabled",a),e.disablePage&&e.disablePage(n,a)}function d(e,s){const r=s.relative_hash,c=r>=0?l(e,r):null;var d,u;const p=s.copy_hash>=0?e.getPageObject(s.copy_hash):null,m={Name:s.name,Active:!0,Internal:"false",Type:s.type};if(null==c){const n={disabled:"",active:" active show ",display:"",aria:"true"};d=$(o(e,s.hash,m,n)),u=$(i(e,s.hash,null,s.type," show active ")),$(e.getMainPanelSelector()).html(t.panelHTML(e,null)),$(e.getMainPanelSelector()+" .cPageTabs").append(d)}else{const t={disabled:"",active:"",display:" d-none ",aria:"false"};d=$(o(e,s.hash,m,t)),u=$(i(e,s.hash,p,s.type,"d-none")),"before"==s.relative_position?d.insertBefore(c):d.insertAfter(c)}$(e.getMainPanelSelector()+" .cAllPagesDivs").append(u),e.pageInitialization(u,p),d.on("click"," .cPageTabButton",(t=>{n($(t.target),e.getMainPanelSelector())})),d.on("click"," .cPageMenuItem",(t=>{a($(t.target),e)})),d.find(".cPageTabButton").trigger("click"),sMainGUI.setChanged()}function u(t,e){if(function(t,e,n){$(t.getMainPanelSelector()+" .cPageTabButton").each((function(){if($(this).data("hash")==e)return $(this).data("name",n),r($(this)),!1}))}(t,e.hash,e.name),"as_is"!=e.relative_position){const n=l(t,e.hash),a=l(t,e.relative_hash);"before"==e.relative_position?n.insertBefore(a):n.insertAfter(a),t.reportableChange&&t.reportableChange("page relocated")}}function p(e,n,a,o){switch(n){case"PageNew":m(e,a,d,{type:o,edition:!1});break;case"PageEdit":m(e,a,u,{edition:!0});break;case"PageDelete":sMainConfirmationForm.show(t.getPageDivNameByHash(e,a),"Do you really want to delete this page?","Delete",(function(){!function(e,n){const a=l(e,n),o=t.getDivPageByHash(e,n),i=a.index();var s=null;$(e.getMainPanelSelector()+" .cAllPagesDivs").children().length>1&&(s=i>0?a.prev():a.next()),e.pageDeleted&&e.pageDeleted(o),a.remove(),o.remove(),s?s.find(".cPageTabButton").trigger("click"):e.setNoPages(),e.reportableChange&&e.reportableChange("page deleted")}(e,a)}));break;case"PageToggle":!function(t,e){const n=s(t,e);var a=!n.data("active");n.data("active",a),c(t,e,!a),r(n),t.reportableChange&&t.reportableChange("page enabled/disabled")}(e,a);break;case"PageToggleInternal":!function(t,e){$(t.getMainPanelSelector()+" .cPageTabButton").each((function(){if($(this).data("hash")==e)return $(this).data("internal")?$(this).data("internal",!1):$(this).data("internal",!0),r($(this)),!1})),t.reportableChange&&t.reportableChange("page tagged/untagged internal")}(e,a)}}function m(e,n,a,o){const i=$(e.getMainPanelSelector()+" .cPageTabButton"),s=t.getDivPageByHash(e,n),l=o.edition?-1:function(t){var e=0;return $(t.getMainPanelSelector()+" .cPageTabButton").each((function(){e=Math.max(e,$(this).data("hash"))})),e+1}(e);var r="",c=s&&!o.edition;if(c){if(e.isPageSecondType){const t=o.type==e.getSecondType();c=t==e.isPageSecondType(s)}c&&(r='<div class="form-check mb-3"><input class="form-check-input" type="checkbox" value=""  name="mMainPageModalCopy" id="mMainPageModalCopy"><label class="form-check-label" for="mMainPageModalCopy">'+sMainResources.getString("Copy existing page")+"</label></div>")}const d='<div class="input-group mb-3 mt-3"><span class="input-group-text" id="mMainPageModalNameLabel">'+sMainResources.getString("Name")+'</span><input type="text" class="form-control" id="mMainPageModalNameField" '+(o.edition?'value="'+t.getPageDivNameByHash(e,n)+'" ':'value="'+sMainResources.getString(e.getPageName())+" "+l+'" ')+'placeholder="Page name here" aria-label="Page name" aria-describedby="mMainPageModalNameLabel"></div>'+r+function(t,e,n){if(0==t.length)return"";if(n&&1==t.length)return"";var a='<div class="mb-3"><label class="form-label">'+sMainResources.getString("Place it")+'</label><div class="input-group-text" id="mMainPageModalLocation">'+(n?'<span class="form-check form-check-inline"><input class="form-check-input" type="radio" checked  name="mMainPageModalLocationOptions" id="mMainPageModalLocationAsIs" value="as_is"><label class="form-check-label" for="mMainPageModalLocationAsIs">'+sMainResources.getString("As is")+"</label></span>":"")+'<span class="form-check form-check-inline"><input class="form-check-input" type="radio"  name="mMainPageModalLocationOptions" id="mMainPageModalLocationBefore" value="before"><label class="form-check-label" for="mMainPageModalLocationBefore">'+sMainResources.getString("Before")+'</label></span><span class="form-check form-check-inline"><input class="form-check-input" type="radio" '+(n?"":" checked ")+' name="mMainPageModalLocationOptions" id="mMainPageModalLocationAfter" value="after"><label class="form-check-label" for="mMainPageModalLocationAfter">'+sMainResources.getString("After")+'</label></span><select class="form-select" id="mMainPageModalLocationList">',o=!0;return t.each((function(){const t=$(this).data("hash");n?t!=e&&(a+='<option value="'+t+'"'+(o?" selected":"")+">"+$(this).data("name")+"</option>",o=!1):a+='<option value="'+t+'"'+(t==e?" selected":"")+">"+$(this).data("name")+"</option>"})),a+="</select></div></div>"}(i,n,o.edition),u='<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable "><div class="modal-content"><div class="modal-header bg-light text-dark">'+sMainGUI.getWebEJSLogoImg()+'<h5 class="text-primary modal-title">'+sMainResources.getString(o.edition?"Edit page":"Create page")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body">'+d+'</div><div class="modal-footer"><button type="button" class="btn btn-secondary me-auto" data-action="Close">'+sMainResources.getString("Cancel")+'</button><button type="button" class="btn btn-primary"   data-action="Apply">'+sMainResources.getString("OK")+"</button></div></div></div>";$("#mMainPageModal").html(u);var p=new bootstrap.Modal(document.getElementById("mMainPageModal"));$("#mMainPageModal .modal-content button").click((function(t){const s=t.currentTarget.dataset.action;if(s)switch(s){case"Close":default:p.hide();break;case"Apply":p.hide(),o.name=$("#mMainPageModalNameField").val();var r=$("input[name=mMainPageModalLocationOptions]:checked");o.relative_position=r.length>0?r.val():"as_is",i.length>0?o.relative_hash=$("#mMainPageModalLocationList option:selected").val():o.relative_hash=-1,o.hash=o.edition?n:l,o.copy_hash=c&&$("#mMainPageModalCopy").is(":checked")?n:-1,a(e,o)}})),p.show()}return t.initPanel=function(o,i){const s=o.getMainPanelSelector();null==i||i.length<=0?$(s+" .sPanelNoPageBtn").on("click",(t=>{const e=$(t.target).closest(".sPanelNoPageBtn").data("type");p(o,"PageNew",-1,e)})):($(s+" .cPageDiv").each((function(){o.pageInitialization($(this),t.findUserPage($(this),i))})),$(s+" .cPageTabButton").on("click",(t=>{n($(t.target),s)})),$(s+" .cPageMenuItem").on("click",(t=>{a($(t.target),o)})),$(s+" .cPageTabButton").each((function(){const t=$(this).data("hash");c(o,t,!$(this).data("active")),r($(this))})),e(s,-1))},t.panelHTML=function(t,e){var n='<ul class="cPageTabs nav nav-pills justify-content-center" role="tablist" style="flex-grow:0; flex-basis:0;">';if(e)for(var a in e){var s=e[a],l=0==a?{active:" active ",display:"",aria:"true"}:{active:"",display:" d-none ",aria:"false"};const i=1*a+1;e[a].gui_hash=i,n+=o(t,i,s,l)}if(n+='</ul><div class="cAllPagesDivs tab-content d-flex flex-column" style="flex-grow:1;">',e)for(var a in e){const o=0==a?" show active ":"d-none";n+=i(t,1*a+1,e[a],e[a].Type,o)}return n+="</div>"},t.getAllPagesDetectedFiles=function(e){var n=[],a=t.getAllPagesHashList(e);for(var o in a){var i=a[o];n.push(...e.getPageDetectedFiles(i))}return n},t.getAllPagesObject=function(e){var n=[],a=t.getAllPagesHashList(e);for(var o in a){var i=a[o];n.push(e.getPageObject(i))}return n},t.getAllPagesHashList=function(t){var e=[];return $(t.getMainPanelSelector()+" .cPageTabButton").each((function(){e.push($(this).data("hash"))})),e},t.getAllPagesDivList=function(t){return $(t.getMainPanelSelector()+" .cPageDiv")},t.getPagesCount=function(t){return $(t.getMainPanelSelector()+" .cPageDiv").length},t.getDivPageByHash=function(t,e){var n=null;return $(t.getMainPanelSelector()+" .cPageDiv").each((function(){if($(this).data("hash")==e)return n=$(this),!1})),n},t.getPageDivNameByHash=function(t,e){var n="Unnamed";return $(t.getMainPanelSelector()+" .cPageTabButton").each((function(){if($(this).data("hash")==e)return n=$(this).data("name"),!1})),n},t.getPageDivName=function(e,n){return t.getPageDivNameByHash(e,t.getPageDivHash(n))},t.getPageDivHash=function(t){return t.data("hash")},t.findUserPage=function(e,n){return function(t,e){for(var n in t)if(t[n].gui_hash==e)return t[n];return null}(n,t.getPageDivHash(e))},t.getPageObject=function(e,n){const a=s(e,n);t.getDivPageByHash(e,n);return{Name:a.data("name"),Active:a.data("active")?"true":"false",Internal:a.data("internal")?"true":"false",Type:a.data("type")}},t.initializeCodeEditor=function(t,e,n,a){var o=ace.edit(t);return o.setTheme("ace/theme/xcode"),o.session.setMode("ace/mode/javascript"),o.resize(),o.on("blur",n),o.setValue(e,-1),o.clearSelection(),o},t.isPageDisabled=function(t,e){return e.attr("disabled")},WebEJS_TOOLS.sTabbedPanelSingleton=t,t},(WebEJS_TOOLS=WebEJS_TOOLS||{}).tablePanel=function(t){var e={},n=0,a=[],o=[];function i(e,a){n++;const i=s(e)+"_Row_"+n;return o.push([e,i,a]),'<tr class="cTableTr" data-hash="'+n+'"><td><input type="checkbox"/></td>'+t.getTableRowHTML(e,n,i)+"</tr>"}function s(e){return"m"+t.getKeyword()+"_Table_"+e}function l(t){return $("#"+s(t)+"_Body")}e.processRowsToSet=function(){for(var e=0;e<o.length;e++){var n=o[e];t.setTableRow(n[0],n[1],n[2])}o=[]},e.getRows=function(t){return $("#"+s(t)+"_Body .cTableTr")},e.getTableHTML=function(e,n,a){const o=s(e);0==a.length&&a.push(t.getTableEmptyRow());for(var l='<table id="'+o+'" class="table table-sm small">'+function(t,e){for(var n='<thead class="table-primary"><tr><th scope="col"><div class="dropdown"><button type="button" class="btn btn-link text-decoration-none dropdown-toggle" id="'+t+'_MenuButton" style="padding:0px 5px 0px 0px; border:0px; " data-bs-toggle="dropdown"aria-expanded="false"></button><ul class="dropdown-menu cTablePanelMenu" data-target="variables" aria-labelledby="'+t+'_MenuButton"><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="InsertBefore">Insert before</li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="InsertAfter" >Insert after</li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="MoveUp"      >Move up</li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="MoveDown"    >Move down</li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="Cut"         >Cut</li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="Copy"        >Copy</li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="Paste"       >Paste</li></ul></div></th>',a=0;a<e.length;a++){const t=e[a];n+="class"in t?'<th class="sTranslatable '+t.class+'" scope="col">'+t.name+"</th>":'<th class="sTranslatable" scope="col">'+t.name+"</th>"}return n+"</tr></thead>"}(o,n)+'<tbody id="'+o+'_Body">',r=0;r<a.length;r++)l+=i(e,a[r]);return l+="</tbody></table>"},e.getTableRows=function(n,a){var o=[];return e.getRows(n).each((function(){const e=$(this).children();var n=t.getTableRowObject(e);a&&(n._tr_=$(this)),o.push(n)})),o};function r(a,o,s){const r=t.getTableEmptyRow(),c=l(a);var d=$(i(a,r));if(c.children().length<=0)c.append(d);else{const t=e.getRows(a);s?d.insertBefore(t.eq(o)):o>=0?d.insertAfter(t.eq(o)):c.append(d)}e.processRowsToSet(),t.tableRowInitialization(a,n,d),t.nonReportableChange("Empty row added")}function c(n,a,o){var i=null;const s=e.getRows(n);o?s.each((function(){a.includes($(this).index())?null!=i&&$(this).insertBefore(i):i=$(this)})):$(s.get().reverse()).each((function(){a.includes($(this).index())?null!=i&&$(this).insertAfter(i):i=$(this)})),t.reportableChange("Raw orders changed in page "+n)}function d(n,o,i){a=[];var s=[];e.getRows(n).each((function(){o.includes($(this).index())&&(a.push(t.getTableRowObject($(this).children())),i&&s.push($(this)))})),s.length>0&&function(e,n){for(var a=0;a<n.length;a++){const o=n[a];t.rowRemoved&&t.rowRemoved(e,o.data("hash")),o.remove()}t.reportableChange("Rows removed in page "+e)}(n,s)}return e.getText=function(t,e){return t[e].firstChild.value},e.setText=function(t,e,n){return t[e].firstChild.value=n},e.findRowTDArrayByHash=function(t,n){var a=null;return e.getRows(t).each((function(){if($(this).data("hash")==n)return a=$(this).children(),!1})),a},e.highlightRows=function(t,n){e.getRows(t).each((function(){$(this).data("hash")==n?$(this).css("background","lightGrey"):$(this).css("background","white")}))},e.removeWarnings=function(t){e.getRows(t).removeClass("bg-warning")},e.tableInitialization=function(o){e.getRows(o).each((function(){t.tableRowInitialization(o,$(this).data("hash"),$(this))})),$("#"+s(o)).find(".cTablePanelMenuItem").on("click",(s=>{!function(o,s,u){switch(console.log("Action "+s+" on page "+o+". Selection = "),console.log(u),s){case"InsertBefore":var p=0;u.length>0&&(p=u[0]),r(o,p,!0);break;case"InsertAfter":p=-1;u.length>0&&(p=u[u.length-1]),r(o,p,!1);break;case"MoveUp":c(o,u,!0);break;case"MoveDown":c(o,u,!1);break;case"Cut":d(o,u,!0);break;case"Copy":d(o,u,!1);break;case"Paste":!function(o,s){if(a.length<=0)return;var r=null;if(e.getRows(o).each((function(){s.includes($(this).index())&&(r=$(this))})),null==r){const e=l(o);for(var c=0;c<a.length;c++){var d=$(i(o,a[c]));e.append(d),t.tableRowInitialization(o,n,d)}}else for(c=0;c<a.length;c++){(d=$(i(o,a[c]))).insertAfter(r),t.tableRowInitialization(o,n,d),r=d}e.processRowsToSet(),t.reportableChange("Rows pasted in page "+o)}(o,u)}}(o,$(s.target).data("action"),function(t){var n=[];return e.getRows(t).each((function(){$(this).children()[0].firstChild.checked&&n.push($(this).index())})),n}(o))})),e.processRowsToSet()},e.appendEmptyRow=function(a){const o=t.getTableEmptyRow(),s=$(i(a,o));l(a).append(s),e.processRowsToSet(),t.tableRowInitialization(a,n,s)},e},(WebEJS_TOOLS=WebEJS_TOOLS||{}).sTextSingleton=null,WebEJS_TOOLS.textTools=function(){if(null!=WebEJS_TOOLS.sTextSingleton)return WebEJS_TOOLS.sTextSingleton;var t={};function e(t){var e=t.name.trim(),n=t.value.trim();if(e.length>0){var a=e.indexOf("[");if(a>0){if(just_name=e.substring(0,a),n.length<=0)return just_name+" = []";if(name_end=e.substring(a+1),(a=name_end.indexOf("]"))<=0)return"{ __i=0; "+just_name+" = []; "+just_name+"[__i] = "+n+" }";var o=name_end.substring(0,a).trim();if(o.length<=0)return"{ __i=0; "+just_name+" = []; "+just_name+"[__i] = "+n+" }";return"{ "+o+"=0; "+just_name+" = []; "+just_name+"["+o+"] = "+n+" }"}return n.length>0?e+" = "+n:e+" = undefined"}return n.length>0?n:""}function n(t,e,n){try{return t.appendCode(n),t.run(),!0}catch(t){return sMainGUI.println("INTERPRETER ERROR IN "+e.name+" = "+e.value+" : "+t.message),!1}}t.isValidFilename=function(t){return/^[a-zA-Z0-9._-]+$/.test(t)},t.sanitizeFilename=function(t){const e={"":"a","":"e","":"i","":"o","":"u","":"A","":"E","":"I","":"O","":"U","":"n","":"N","":"u","":"U"};return t=(t=t.split("").map((t=>e[t]||t)).join("")).replace(/[^a-zA-Z0-9._-]/g,"_")},t.toValidVariableName=function(t){var e=t.replace(/[^a-zA-Z0-9_$]/g,"_");/^[0-9]/.test(e)&&(e="notThis_"+e);return["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with","yield"].includes(e)&&(e="notThis_"+e),e},t.removeQuotes=function(t){for(;t.startsWith('"');)t=t.substring(1);for(;t.endsWith('"');)t=t.substring(0,t.length-1);return t},t.addQuotes=function(t){return t.startsWith('"')||(t='"'+t),t.endsWith('"')||(t+='"'),t},t.scapeQuotes=function(t){return t.replaceAll('"','\\"')},t.getCustomMethods=function(t,e){var n=[];const a=esprima.parseScript(e);if(console.log(a),!a.body)return n;for(var o in a.body){var i=a.body[o];if("FunctionDeclaration"==i.type){var s="";for(var l in i.params){s+=", "+i.params[l].name}s.startsWith(",")&&(s=s.substring(1).trim());const e=i.id.name+"("+s+")",a="// "+sMainResources.getString("Declared in page")+" "+t;n.push({name:e,description:a})}}return n};const a=void 0!==navigator&&navigator.userAgent.match(/iPhone|iPad|iPod|Android|BlackBerry|Opera Mini|IEMobile/i);return t.checkCode=function(t){var o=new Interpreter("_i=0;");for(var i in o.appendCode("_isPlaying = false;"),o.appendCode("_isPaused = true;"),o.appendCode("_isEPub = false;"),o.appendCode("_isMobile = "+a),t){const a=t[i];try{var s=a.name.trim();if(s.length>0){var l=s.indexOf("[");if(l>0&&(s=s.substring(0,l)),o.appendCode("typeof "+s+' === "undefined"'),o.run(),0==o.value){a.run_ok=!1;continue}}const t=e(a);a.run_ok=!(t.length>0)||n(o,a,t)}catch(t){a.run_ok=!1}}return t},WebEJS_TOOLS.sTextSingleton=t,t};